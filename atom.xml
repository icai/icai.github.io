<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[æ³›å‰ç«¯å¼€å‘]]></title>
  <link href="http://blog.w3cub.com/atom.xml" rel="self"/>
  <link href="http://blog.w3cub.com/"/>
  <updated>2020-05-22T01:24:06+00:00</updated>
  <id>http://blog.w3cub.com/</id>
  <author>
    <name><![CDATA[Terry Cai]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[mysql function procedure trigger to generate serial number]]></title>
    <link href="http://blog.w3cub.com/blog/2020/03/24/mysql-function-procedure-to-generate-serial-number/"/>
    <updated>2020-03-24T14:27:44+00:00</updated>
    <id>http://blog.w3cub.com/blog/2020/03/24/mysql-function-procedure-to-generate-serial-number</id>
    <content type="html"><![CDATA[<p>Today, we show some useful mysql code about procedure, function and trigger.</p>

<h2 id="1-generate-serial-number-by-table-name-using-function">1. generate serial number by table name using <code>function</code></h2>

<p>rule: prefix + timestr + sequence number</p>

<!--more -->

<pre><code class="language-sql">
DROP function IF EXISTS nextNo;

delimiter ;; 

CREATE function nextNo(tableType char(20)) returns char(20) 
reads sql data
commit 'è¡¨å•å·'
begin 
    declare prefix char(2);
    -- declare table_prefix char(3);
    -- set table_prefix = 'bs_';
    select prefix=
        case tableType
            when 'role' then 'ro'
        end

    declare timestr INT;

    SET timestr = round(date_format(now(),'%Y%m%d%H%m%s') * 1.72); 
    -- len 14

	declare lastval int; 
	select lastval = 
        case  tableType
            when 'role' then (select right(max(role_no), 4) from `bs_role`)
        end
	if lastval is null set lastval = prefix + '0001';
	return prefix + timestr + right('000' + convert(varchar(10),lastval + 1),4)
end
;;
delimiter ;


select nextNo('role');

</code></pre>

<h2 id="2-generate-sequence-number-using-procedure">2. generate sequence number using <code>procedure</code></h2>

<p>rule:  timestr + ordersn</p>

<pre><code class="language-sql">
DROP PROCEDURE IF EXISTS usp_seqnum;
delimiter ;; 
CREATE PROCEDURE usp_seqnum()
    reads sql data
    comment 'åºåˆ—å·'
BEGIN
    -- å®šä¹‰å˜é‡å¹¶è·å–ç›¸å…³å€¼
    DECLARE v_cnt INT;
    DECLARE v_timestr INT;
    SET v_timestr = DATE_FORMAT(NOW(),'%Y%m%d');
    SELECT ROUND(RAND()*100,0)+1 INTO v_cnt;
    -- æ–°å»ºè¡¨
    DROP TABLE IF EXISTS im_orderseq;
    CREATE TABLE  im_orderseq(
        timestr NVARCHAR(8) NOT NULL ,
        ordersn INT(3)
    );
    START TRANSACTION;
		-- æ›´æ–°è¡¨çš„æœ€å€¼
		UPDATE im_orderseq SET ordersn = ordersn + v_cnt WHERE timestr = v_timestr;
		IF ROW_COUNT() = 0 THEN
			-- æ’å…¥æ•°æ®
			INSERT INTO im_orderseq(timestr,ordersn) VALUES(v_timestr,v_cnt);
		END IF;
		SELECT CONCAT(v_timestr,LPAD(ordersn,7,0))AS ordersn
		FROM im_orderseq WHERE timestr = v_timestr;
    COMMIT;
END;
;; 
delimiter ;


CALL usp_seqnum();
SELECT * FROM im_orderseq;

</code></pre>

<h2 id="3-tree-data-using-function-or-procedure">3. tree data using <code>function</code> or <code>PROCEDURE</code></h2>

<p>first, initialize table structure and insert demo data.</p>

<pre><code class="language-sql">DROP TABLE IF EXISTS `tree_node`;
CREATE TABLE `tree_node`(
	`id` INT   COMMENT "ç™»å½•æ—¥å¿—ID"  ,
    `pid` INT NULL,
    `name` VARCHAR(5),
    `sort` INT NULL,
	PRIMARY KEY (`id`)
	
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ ‘å½¢ç»“æ„è¡¨';

insert into tree_node values(1,0,"A",0);
insert into tree_node values(7,0,"G",2);
insert into tree_node values(2,1,"B",3);
insert into tree_node values(3,1,"C",4);
insert into tree_node values(4,1,"D",5);
insert into tree_node values(5,4,"E",6);
insert into tree_node values(6,4,"F",7);

insert into tree_node values(8,7,"H",8);
insert into tree_node values(9,7,"I",9);
insert into tree_node values(10,7,"J",10);
insert into tree_node values(11,10,"K",11);
insert into tree_node values(12,10,"L",12);
insert into tree_node values(13,11,"M",13);
insert into tree_node values(14,11,"N",14);


</code></pre>

<p>get all the children ids by parent id</p>

<pre><code class="language-sql">DROP function IF EXISTS getTreeChild;
delimiter ;; 
CREATE function getTreeChild( rootid int) RETURNS VARCHAR(5000)
COMMENT 'æ ‘å½¢èŠ‚ç‚¹ID'  
reads sql data
BEGIN
	DECLARE sTemp VARCHAR(200);  
	DECLARE sTempChd VARCHAR(200);  
	SET sTemp = '$';
	SET sTempChd = cast(rootid as char);  
	WHILE sTempChd is not NULL DO  
		SET sTemp = concat(sTemp,',',sTempChd);  
		SELECT group_concat(id) INTO sTempChd FROM tree_node where find_in_set(pid,sTempChd)&gt;0;  
	END WHILE;  
	return sTemp;  
END
;;

delimiter ;  

-- -----------------------------------------

select getTreeChild(0)

</code></pre>

<p>get tree order data</p>

<pre><code class="language-sql">  
DROP PROCEDURE IF EXISTS `createChildLst`;  
delimiter ;;  
CREATE PROCEDURE `createChildLst`(IN pidin INT,IN nDepth INT)  
COMMENT 'å…¥å£è¿‡ç¨‹'  
BEGIN  
    DECLARE done INT DEFAULT 0;  
    DECLARE b INT;  
    DECLARE cur1 CURSOR FOR SELECT id FROM tree_node where pid=pidin order by sort;  
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1; 
      
    OPEN cur1;  
  
    FETCH cur1 INTO b;  
    INSERT INTO tmpLst VALUES (NULL,pidin,nDepth,done);  
      
    WHILE done=0 DO  
         CALL createChildLst(b,nDepth+1);  
         
         FETCH cur1 INTO b;  
           
    END WHILE;  
  
    CLOSE cur1;  
 END  
 ;;  
delimiter ;  
  
-- ----------------------------  
--  Procedure structure for `showChildLst`  
-- ----------------------------  
DROP PROCEDURE IF EXISTS `showChildLst`;  
delimiter ;;  
CREATE PROCEDURE `showChildLst`(IN pid INT)  
    COMMENT 'é€’å½’è¿‡ç¨‹'  
BEGIN  
    CREATE TEMPORARY TABLE IF NOT EXISTS tmpLst(sno int primary key auto_increment,id int,depth int,isLeaf int);  
    DELETE FROM tmpLst;  
  
    CALL createChildLst(pid,0);  
    select tmpLst.*,tree_node.* from tmpLst,tree_node where tmpLst.id=tree_node.id order by tmpLst.sno;  
END  
 ;;  
delimiter ;  

-- ----------------------------------------

set max_sp_recursion_depth=255;  
call showChildLst(1);  


</code></pre>

<h2 id="4-can-i-use-a-function-for-a-default-value-in-mysql">4. Can I use a function for a default value in MySql?</h2>

<p><a href="https://stackoverflow.com/questions/270309/can-i-use-a-function-for-a-default-value-in-mysql">question link</a></p>

<pre><code class="language-sql">create table app_users
(
    app_user_id smallint(6) not null auto_increment primary key,
    api_key     char(36) not null default uuid()
);

</code></pre>

<p>use <code>Trigger</code></p>

<pre><code class="language-sql">CREATE TRIGGER before_insert_app_users
BEFORE INSERT ON app_users
FOR EACH ROW
  IF new.api_key IS NULL
  THEN
    SET new.api_key = uuid();
  END IF;
</code></pre>
<p>You still have to update previously existing rows, like this:</p>

<pre><code class="language-sql">
UPDATE app_users SET api_key = (SELECT uuid());
</code></pre>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://stackoverflow.com/questions/270309/can-i-use-a-function-for-a-default-value-in-mysql">Can I use a function for a default value in MySql?</a></li>
  <li><a href="https://www.tutorialspoint.com/What-are-the-advantages-and-disadvantages-of-using-MySQL-stored-procedures">What are the advantages and disadvantages of using MySQL stored procedures?</a></li>
  <li><a href="https://dzone.com/articles/why-mysql-stored-procedures-functions-and-triggers">Why MySQL Stored Procedures, Functions, and Triggers Are Bad for Performance</a></li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[group_concat scences to be used]]></title>
    <link href="http://blog.w3cub.com/blog/2020/03/13/group-concat-scences-to-be-used/"/>
    <updated>2020-03-13T07:44:47+00:00</updated>
    <id>http://blog.w3cub.com/blog/2020/03/13/group-concat-scences-to-be-used</id>
    <content type="html"><![CDATA[<p>group_concat åªèƒ½ä¸groupbyè¿ç”¨ï¼Œåˆ†ç»„æŸ¥è¯¢å¸¸ç”¨åœºæ™¯</p>

<p>åœºæ™¯ä¸€ï¼š</p>

<p>ç”¨æˆ·è§’è‰²å…³ç³»ï¼Œ ç”¨æˆ·è¡¨ï¼Œè§’è‰²è¡¨ï¼Œç”¨æˆ·è§’è‰²è¡¨ã€‚ ç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªè§’è‰²ã€‚æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·å¹¶é™„å¸¦å‡ºä»–ä»¬æ‰€å±çš„è§’è‰²ã€‚</p>

<p>åœºæ™¯äºŒï¼š</p>

<p>æ–‡ç« æ ‡ç­¾å…³ç³»ï¼Œæ–‡ç« è¡¨ï¼Œæ ‡ç­¾è¡¨ï¼Œæ–‡ç« æ ‡ç­¾å…³ç³»è¡¨ã€‚æŸ¥è¯¢æ‰€æœ‰æ–‡ç« å¹¶é™„å¸¦å‡ºä»–ä»¬æ‰€å±çš„æ ‡ç­¾ã€‚</p>

<!--more -->

<p>ä¸‹é¢ä»¥åœºæ™¯ä¸€ä¸¾ä¾‹</p>

<p>åˆ›å»ºç”¨æˆ·è¡¨</p>

<pre><code class="language-sql">CREATE TABLE `bs_user` (
  `id` char(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `user_name` varchar(20) NOT NULL,
  `password` varchar(32) NOT NULL,
  `name` varchar(40) NOT NULL,
  `mail` varchar(40) DEFAULT NULL,
  `tel` varchar(11) DEFAULT NULL,
  `sex` varchar(1) DEFAULT NULL,
  `birthday` date DEFAULT NULL,
  `created_at` datetime NOT NULL,
  `modified_at` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
</code></pre>

<p>åˆ›å»ºè§’è‰²è¡¨</p>

<pre><code class="language-sql">CREATE TABLE `bs_role` (
  `role_id` char(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `role_name` varchar(10) NOT NULL,
  `description` varchar(100) DEFAULT NULL,
  `creator_id` char(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL,
  `created_at` datetime NOT NULL,
  `modified_id` char(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL,
  `modified_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `is_del` int(1) DEFAULT '0',
  PRIMARY KEY (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
</code></pre>

<p>åˆ›å»ºç”¨æˆ·è§’è‰²å…³ç³»è¡¨</p>

<pre><code class="language-sql">CREATE TABLE `bs_user_role` (
  `user_id` char(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `role_id` char(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `created_at` datetime NOT NULL,
  `modified_at` datetime NOT NULL,
  PRIMARY KEY (`user_id`,`role_id`),
  KEY `role_id` (`role_id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
</code></pre>

<h2 id="æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·å¹¶é™„å¸¦å‡ºä»–ä»¬æ‰€å±çš„è§’è‰²">æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·å¹¶é™„å¸¦å‡ºä»–ä»¬æ‰€å±çš„è§’è‰²</h2>

<p>åˆ†è§£</p>

<ul>
  <li>æŸ¥è¯¢ æ‰€æœ‰ç”¨æˆ·</li>
  <li>æŸ¥è¯¢ æ‰€æœ‰ç”¨æˆ·è§’è‰²</li>
  <li>è”åˆ</li>
</ul>

<pre><code class="language-sql">select a.id as user_id, a.user_name, a.name, 
    group_concat(s.role_id) AS role_id, 
    group_concat(s.role_name) AS role_name, 
    group_concat(s.description) AS description from bs_user a
left outer join (
	select  b.user_id user_id, b.role_id role_id, c.role_name role_name, c.description description from bs_user_role b  
	left  join bs_role c on b.role_id=c.role_id
 ) AS s on s.user_id = a.id
where a.is_del=0
group by user_id
order by created_at desc limit 0, 10;
</code></pre>

<p>ç»“æœ</p>

<p><img src="http://blog.w3cub.com/assets/posts/mysql/group_concat-a2f9d87821e17b3df49f6bb5ccc7f9f17f8d9c46feb92c747456b56754d9f64c.png" alt="Result" /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æµ…è°ˆæœåŠ¡ç«¯æ¸²æŸ“(SSR)çš„å‡ ç§å½¢å¼]]></title>
    <link href="http://blog.w3cub.com/blog/2019/07/01/ssr-types/"/>
    <updated>2019-07-01T08:48:43+00:00</updated>
    <id>http://blog.w3cub.com/blog/2019/07/01/ssr-types</id>
    <content type="html"><![CDATA[<p>åœ¨å¥½ä¹…å¥½ä¹…ä¹‹å‰ï¼Œå‰ç«¯çš„æ¦‚å¿µæ˜¯æ¨¡ç³Šçš„ã€‚å‰ç«¯å°±æ˜¯é¡µé¢ä»”ï¼Œåˆ‡å›¾ä»”ã€‚å‰ç«¯çš„ä»»åŠ¡å°±æ˜¯æŠŠhtmlè·Ÿjså†™å¥½ï¼Œç„¶åä¸¢ç»™åç«¯å¥—æ•°æ®ã€‚åŸºæœ¬ä¼ ç»Ÿçš„MVCï¼Œsmarty Viewã€‚</p>
<pre><code>assign-&gt;('data', $data)
</code></pre>
<p>è¿™äº›ä¹Ÿç»™åç«¯åšäº†ã€‚æˆ–è€…å‰ç«¯å°±ä¸¢ç»™UIï¼ˆç¾å·¥ï¼‰åšï¼Œå‰ç«¯æ˜¯ä¸å­˜åœ¨çš„ã€‚</p>

<!--more -->

<p>[[back] -&gt;[view]]-&gt; [front end]</p>

<p>ä½†æ˜¯éšç€ç§»åŠ¨ç«¯çš„å…´èµ·ï¼Œå¼€å§‹æµè¡Œå‰ååˆ†ç¦»ã€‚</p>

<p>åç«¯æ¸²æŸ“æ¨¡ç‰ˆçš„è¿™ä¸€å±‚å°±ç»™çœç•¥æ‰äº†.<br />
å˜æˆå‰ååˆ†ç¦»ã€‚å…¶å®æ‰€è°“çš„åç«¯æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯æ¸²æŸ“é¦–å±å¹•ã€‚<br />
[back] -&gt;-&gt; [front and view]</p>

<p>ä½†æ˜¯åˆå› ä¸ºå‰ååˆ†ç¦»å¯¹æœç´¢å¼•æ“çˆ¬è™«ä¸å¤ªå‹å¥½ã€‚æƒ³å½“å¹´ï¼Œåšç½‘ç«™çš„äººéƒ½ååˆ†åœ¨æ„ä¸€ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯Alexaæ’åï¼Œåè€…å›½å†…çš„ç™¾åº¦æ’åï¼Œcnzzæ’åç­‰ç­‰ã€‚æ¯•ç«Ÿé‚£ä¸ªæ—¶å€™é£å¤´çš„äººéƒ½ä¼šçœ‹ä¸€ä¸‹ä½ çš„ç½‘ç«™alexaæ˜¯å¤šå°‘ã€‚å…¶å®è¿™ç§æŒ‡æ ‡å°±æ˜¯ååº”äº†ä¸€ä¸ªç½‘ç«™çš„æ´»è·ƒåº¦ã€‚ä¸å¦‚è¯´ï¼Œä½ è¯´ä½ çš„ç½‘ç«™æœ‰å‡ ç™¾ä¸‡ç”¨æˆ·ï¼Œä½†æ˜¯åˆ«äººæŸ¥äº†ä¸€ä¸‹è¿™ç§æ’åï¼Œå°½ç„¶å‡ åƒä¸‡ï¼Œæœç´¢å¼•æ“æ”¶å½•å‡ ä¹æ²¡æœ‰ã€‚è¿™æ ·åšä½ è®¤ä¸ºä¼šæœ‰ä¿¡æœåŠ›å—ï¼Ÿ</p>

<p>å½“ç„¶SEOéœ€æ±‚å¤§éƒ¨åˆ†é¢å‘Cç«¯çš„ã€‚<strong>é¢å‘åå°ç®¡ç†ç³»ç»Ÿ</strong>çš„å½“ç„¶å°±æ²¡æœ‰é‚£ä¹ˆåœ¨ä¹äº†ã€‚</p>

<p>ä¸ºäº†è§£å†³SPA  bad SEO é—®é¢˜ã€‚ä¾‹å¦‚åå°æœåŠ¡å™¨æ‹¦æˆªæ‹¦æˆªç‰¹å®šçˆ¬è™«è¿›è¡ŒSEO hackï¼Œæ‰¹é‡æäº¤Sitemap ç­‰ç­‰çš„æ‰‹æ®µã€‚ç®€å•çš„è¯´ï¼Œä½ æƒ³å‘Šè¯‰æœç´¢å¼•æ“é“¾æ¥ï¼Œç„¶åçˆ¬è™«è·³è¿›æ¥ï¼Œè¿›è¡Œç›¸åº”çš„SEO hack æŠ•é£Ÿæ—¶æ¸²æŸ“ã€‚</p>

<p><strong>æˆ‘ä»¬æŠŠè¿™ç§å½¢å¼å«åš å‰ååˆ†ç¦» + åç«¯è¾…åŠ©ï¼ˆSPA hackå›æ»šï¼‰ã€‚</strong></p>

<p>ä½†æ˜¯éšç€nodeï¼Œbabelçš„å¿«é€Ÿå‘å±•ï¼Œæµè§ˆå™¨å¿«é€Ÿè¿­ä»£ï¼Œå‰ç«¯å·¥ä½œå¤©å¤©è°ƒè¯•å…¼å®¹çš„æ—¶ä»£è¿‡å»äº†ã€‚å˜æˆäº†åç«¯æœåŠ¡å™¨ + å‰ç«¯æœåŠ¡å™¨è¿™ç§æ¶æ„ã€‚[back server] -&gt;-&gt; [[view-server]front server]ã€‚<br />
å‰ç«¯çš„åœ°ä½é‡è¦å¤šäº†ã€‚åŒæ„è¿™ä¸ªæ¦‚å¿µäºæ˜¯è¢«æå‡ºäº†ã€‚å½“æ—¶å‰ç«¯ä»¬å°±è®¾æƒ³ <strong>åç«¯æ¸²æŸ“è·Ÿå‰ç«¯å¼‚æ­¥æ¸²æŸ“å¯ä»¥é‡ç”¨</strong>ã€‚æ¯”å¦‚ä¸€ä¸ªå¾ªç¯çš„åˆ—è¡¨ï¼Œé‡Œé¢çš„item æ¨¡ç‰ˆå¯ä»¥è¢«å‰ç«¯é‡ç”¨ã€‚åˆ°åæ¥ï¼Œéšç€ react vue ç­‰æ¡†æ¶å¼€å§‹æµè¡Œï¼Œnextjsè¯ç”Ÿäº†ã€‚è¿™ä¸ªé˜¶æ®µï¼Œä¸»è¦æ˜¯SPAçš„æ”¹è¿›ã€‚nodeæœåŠ¡å™¨æŠŠSEOéœ€è¦çš„åŠŸèƒ½éƒ½åšäº†ã€‚<br />
æ—¢ç„¶nodeå¯ä»¥å†™serverå±‚ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸å¯ä»¥åç«¯ä¹Ÿç”¨nodeå‘¢ã€‚å½“ç„¶è¿™ç”¨ä»€ä¹ˆè¯­è¨€å†™åç«¯ï¼Œå¹¶ä¸å½±å“å‰ç«¯ã€‚</p>

<p><strong>æˆ‘ä»¬æŠŠè¿™ä¸ªå½¢å¼ç§°åšï¼ŒSPA + SSRå‰ç«¯æ¸²æŸ“ã€‚</strong></p>

<p>æ—¢ç„¶å¯ä»¥SSRå‰ç«¯æ¸²æŸ“ï¼Œä¸ºä»€ä¹ˆä¸å¯ä»¥åç«¯æ¸²æŸ“å‘¢ï¼å½“ç„¶æœåŠ¡å™¨çš„æƒåˆ©å°±åªå‰©ä¸‹äº† nodeã€‚<br />
åˆå¼€å§‹ åç«¯çš„ Route -&gt; Controller -&gt; Model-&gt; View.<br />
è¿™æ—¶å€™çš„ View å°±å˜æˆäº†react æˆ–è€… vue. å…¶å®å°±æŠŠå½“å¹´çš„åç«¯æ¨¡ç‰ˆæ›¿æ¢æˆäº† å‰ç«¯æ¡†æ¶æ¨¡ç‰ˆï¼Œmodelè¾“å‡ºçš„æ•°æ®å°±å˜æˆ Viewçš„propæˆ–è€…data å˜é‡ã€‚</p>

<p><strong>æˆ‘ä»¬æŠŠè¿™ç§å½¢å¼ç§°ä¸º  SSRåç«¯æ¸²æŸ“ã€‚</strong></p>

<p>åˆ°å¤´æ¥ï¼Œä½ ä¼šå‘ç°ï¼Œèµ°äº†ä¸€åœˆï¼Œåˆå›åˆ°äº†åŸç‚¹ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[javascriptæ··æ·†ä¸è§£æ··æ·†çš„é‚£äº›äº‹å„¿]]></title>
    <link href="http://blog.w3cub.com/blog/2019/04/01/js-confusion/"/>
    <updated>2019-04-01T05:48:43+00:00</updated>
    <id>http://blog.w3cub.com/blog/2019/04/01/js-confusion</id>
    <content type="html"><![CDATA[<p>åƒè½¯ä»¶åŠ å¯†ä¸è§£å¯†ä¸€æ ·ï¼Œjavascriptçš„æ··æ·†ä¸è§£æ··æ·†åŒå±äºåŒä¸€ä¸ªèŒƒç•´ã€‚é“é«˜ä¸€å°ºï¼Œé­”é«˜ä¸€ä¸ˆã€‚æ²¡æœ‰æ°¸æ’çš„é»‘ï¼Œä¹Ÿæ²¡æœ‰æ°¸æ’çš„ç™½ã€‚ä¸€åˆ‡éƒ½æ˜¯èµ„æœ¬å¸‚åœºé©±åŠ¨è¡Œä¸ºï¼Œç°åœ¨éƒ½æµè¡Œä½ èƒ½ä¸ºäººè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œè¿™ä¸ªæ¦‚å¿µã€‚é‚£ä¹ˆå¸‚åœºç©¶ç«Ÿèƒ½å®¹çº³å¤šå°‘ä¸ªèƒ½è§£å†³è¿™ç§é—®é¢˜çš„åˆ©ç›Šè€…ã€‚JSæ²¡æœ‰ç§˜å¯†ã€‚</p>

<p>å…¶å®æœ¬äººä¸èµæˆjavascriptè¿›è¡Œhashæ··æ·†å¤„ç†ï¼Œä¸€æ‹–æ…¢è¿è¡Œæ—¶é€Ÿåº¦ï¼ŒäºŒä½“ç§¯å¤§ã€‚JSä»£ç å‰ç«¯å¯è·å–ï¼Œå¤©ç”Ÿèµ‹äºˆâ€œå¼€æºâ€å±æ€§ï¼Œéƒ½å¯ä»¥åœ¨chrome devToolsä¸‹æŸ¥çœ‹ã€‚JSéå‹ç¼©æ€§æ··æ·†å®Œå…¨è¿æ³•å‰ç«¯ä¼˜åŒ–å‡†åˆ™ã€‚</p>

<!-- more -->

<p>ç›®å‰ç½‘ç»œä¸Šå¯ä»¥æœç´¢çš„JSæ··æ·†å·¥å…·ä¸å¤–ä¹ä»¥ä¸‹å‡ ç§ï¼š</p>

<p><a href="http://blog.w3cub.com/tools/jspacker/">evalæ··æ·†</a>ï¼Œä¹Ÿæ˜¯æœ€æ—©JSå‡ºç°çš„æ··æ·†åŠ å¯†ï¼Œæ®è¯´ç¬¬ä¸€å¤©å°±è¢«ç ´è§£ï¼Œä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼Œalertä¸€ä¸‹å°±å¯ä»¥ç ´è§£äº†ã€‚è¿™ç§æ–¹æ³•ä»å‡ºç”Ÿçš„é‚£å¤©å°±å¤±å»äº†æ„ä¹‰ã€‚å…¶å®JSåŠ å¯†ï¼ˆæ··æ·†ï¼‰æ˜¯ç›¸å¯¹äºå¯è¯»æ€§è€Œè¨€çš„ï¼Œå…¶å®çœŸæ­£æœ‰æ„ä¹‰çš„å°±æ˜¯å‹ç¼©å‹æ··æ·†uglifyè¿™ä¸€ç±»ï¼Œå³å¯å‡å°‘ä½“é‡ï¼Œä¹Ÿå¯å‡å°‘å¯è¯»æ€§ã€‚</p>

<p>ä½†æ˜¯ï¼Œä¹Ÿä¸èƒ½æ’é™¤éƒ¨åˆ†å•†ä¸šæºä»£ç ä½¿ç”¨hashç±»å‹æ··æ·†æºä»£ç ï¼Œæ¯”å¦‚ miniui ä½¿ç”¨çš„<a href="https://sourceforge.net/projects/jsintegration/files/tools/_%20JSA-20071021/">JSAåŠ å¯†</a>, fundebugä½¿ç”¨çš„<a href="https://obfuscator.io/">javascript-obfuscator</a>ã€‚</p>

<p>ä¸‹é¢é€šè¿‡ä»£ç æ¥è¯´æ˜ JSAåŠ å¯† å’Œ javascript-obfuscator çš„åŒºåˆ«ï¼š</p>

<p>è¦æ··æ·†çš„ä»£ç ï¼š</p>

<pre><code class="language-js">function logG(message) {
  console.log('\x1b[32m%s\x1b[0m', message); 
}
function logR(message) {
  console.log('\x1b[41m%s\x1b[0m', message); 
}
logG('logR');
logR('logG');

</code></pre>

<p>é€šè¿‡<a href="https://sourceforge.net/projects/jsintegration/files/tools/_%20JSA-20071021/">JSAåŠ å¯†</a>æ··æ·†åç”Ÿæˆçš„ä»£ç </p>

<pre><code>function o00($){console.log("\x1b[32m%s\x1b[0m",$)}function o01($){console.log("\x1b[41m%s\x1b[0m",$)}o00("logR");o01("logG")

</code></pre>
<p>ç„¶åå†<a href="https://beautifier.io/">beautifier</a>ä¸€ä¸‹ï¼š</p>

<pre><code class="language-js">function o00($) {
  console.log("\x1b[32m%s\x1b[0m", $)
}

function o01($) {
  console.log("\x1b[41m%s\x1b[0m", $)
}
o00("logR");
o01("logG")

</code></pre>

<p>å¯ä»¥å‘ç°ï¼Œå…¶å®æ²¡æœ‰åšä»€ä¹ˆä»€ä¹ˆä¿®æ”¹ï¼Œåªæ˜¯åšäº†ä¸€äº›å˜é‡æ›¿æ¢ã€‚æƒ³è¿˜åŸä¹Ÿæ¯”è¾ƒç®€å•çš„ã€‚è¿™é‡Œå°±ä¸æ‹¿å®ƒæ¥åšä»£è¡¨ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆäººç”¨ã€‚</p>

<p>é€šè¿‡<a href="https://obfuscator.io/">javascript-obfuscator</a>æ··æ·†åç”Ÿæˆçš„ä»£ç </p>

<pre><code class="language-js">var _0xd6ac=['[41m%s[0m','logG','log'];(function(_0x203a66,_0x6dd4f4){var _0x3c5c81=function(_0x4f427c){while(--_0x4f427c){_0x203a66['push'](_0x203a66['shift']());}};_0x3c5c81(++_0x6dd4f4);}(_0xd6ac,0x6e));var _0x5b26=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=_0xd6ac[_0x2d8f05];return _0x4d74cb;};function logG(_0x4f1daa){console[_0x5b26('0x0')]('[32m%s[0m',_0x4f1daa);}function logR(_0x38b325){console[_0x5b26('0x0')](_0x5b26('0x1'),_0x38b325);}logG('logR');logR(_0x5b26('0x2'));

</code></pre>

<p>å†<a href="https://beautifier.io/">beautifier</a>ä¸€ä¸‹ï¼š</p>

<pre><code class="language-js">var _0xd6ac = ['[41m%s[0m', 'logG', 'log'];
(function(_0x203a66, _0x6dd4f4) {
  var _0x3c5c81 = function(_0x4f427c) {
    while (--_0x4f427c) {
      _0x203a66['push'](_0x203a66['shift']());
    }
  };
  _0x3c5c81(++_0x6dd4f4);
}(_0xd6ac, 0x6e));
var _0x5b26 = function(_0x2d8f05, _0x4b81bb) {
  _0x2d8f05 = _0x2d8f05 - 0x0;
  var _0x4d74cb = _0xd6ac[_0x2d8f05];
  return _0x4d74cb;
};

function logG(_0x4f1daa) {
  console[_0x5b26('0x0')]('[32m%s[0m', _0x4f1daa);
}

function logR(_0x38b325) {
  console[_0x5b26('0x0')](_0x5b26('0x1'), _0x38b325);
}
logG('logR');
logR(_0x5b26('0x2'));
</code></pre>

<p>è¿™ä¸ªå¤æ‚å¾—å¤šï¼Œä½†æ˜¯åˆ†æä¸€ä¸‹ä½ ä¼šå‘ç°ï¼Œå…¶å®å¤šäº†ä¸€ä¸ªå­—å…¸ï¼Œæ‰€æœ‰æ–¹æ³•å˜é‡ï¼Œéƒ½æœ‰å¯èƒ½å­˜åœ¨å­—å…¸ä¸­ï¼Œè°ƒç”¨æ—¶å…ˆè°ƒç”¨å­—å…¸è¿˜åŸæ–¹æ³•åå˜é‡å†æ‰§è¡Œã€‚<br />
å…¶å®å…¥å£éƒ½æ˜¯å˜é‡çš„è§„åˆ™ã€‚</p>

<p>å­—å…¸å‡½æ•°ï¼š</p>

<pre><code class="language-js">var _0xd6ac = ['[41m%s[0m', 'logG', 'log'];
(function(_0x203a66, _0x6dd4f4) {
  var _0x3c5c81 = function(_0x4f427c) {
    while (--_0x4f427c) {
      _0x203a66['push'](_0x203a66['shift']());
    }
  };
  _0x3c5c81(++_0x6dd4f4);
}(_0xd6ac, 0x6e));
var _0x5b26 = function(_0x2d8f05, _0x4b81bb) {
  _0x2d8f05 = _0x2d8f05 - 0x0;
  var _0x4d74cb = _0xd6ac[_0x2d8f05];
  return _0x4d74cb;
};

</code></pre>

<p>é€šè¿‡ä»¥ä¸Šå‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠJSæ··æ·†å½’ç»“ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ evalç±»å‹ï¼Œhashç±»å‹ï¼Œå‹ç¼©ç±»å‹ã€‚è€Œå‹ç¼©ç±»å‹ï¼Œæ˜¯ç›®å‰å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„å¸¸ç”¨å·¥å…·ï¼Œä»¥<a href="https://www.npmjs.com/package/uglify-js">uglify</a>ä¸ºä»£è¡¨ã€‚</p>

<p>å¸¸ç”¨çš„å‰ç«¯å‹ç¼©ä¼˜åŒ–å·¥å…·ï¼š</p>

<p>JavaScript:</p>
<ul>
  <li><a href="https://github.com/babel/minify">babel-minify</a></li>
  <li><a href="https://github.com/terser-js/terser">terser</a></li>
  <li><a href="https://github.com/mishoo/UglifyJS2">uglify-js</a></li>
  <li><a href="https://github.com/mishoo/UglifyJS2/tree/harmony">uglify-es</a></li>
  <li><a href="https://www.npmjs.com/package/google-closure-compiler">Google Closure Compiler</a></li>
  <li><a href="http://yui.github.io/yuicompressor/">YUI Compressor</a></li>
</ul>

<p>CSS:</p>
<ul>
  <li><a href="https://github.com/postcss/postcss">PostCSS</a></li>
  <li><a href="https://github.com/jakubpawlowicz/clean-css">clean-css</a></li>
  <li><a href="https://github.com/css/csso">CSSO</a></li>
  <li><a href="http://yui.github.io/yuicompressor/">YUI Compressor</a></li>
</ul>

<p>HTML:</p>
<ul>
  <li><a href="https://www.npmjs.com/package/html-minifier">html-minifier</a></li>
</ul>

<p>ä»å·¥å…·æµ(workflow) æ¥çœ‹ï¼Œä¸è®ºæ˜¯ webpack è¿˜æ˜¯ gulp ï¼Œç›®å‰javascriptæœ€æµè¡Œå·¥å…·è¿˜æ˜¯uglifyã€‚</p>

<p>ç›¸åº”çš„è§£æ··æ·†å·¥å…·ï¼š</p>

<ul>
  <li>
    <p>evalå¯¹åº”çš„è§£æ··æ·†å·¥å…·, éšä¾¿ç™¾åº¦éƒ½å¯ä»¥æœç´¢åˆ°ï¼Œå¦‚<a href="http://blog.w3cub.com/tools/jspacker/">jspacker</a></p>
  </li>
  <li>
    <p>JSAå¯¹åº”çš„è§£æ··æ·†å·¥å…·<a href="https://github.com/jscck/unjsa">unjsa</a></p>
  </li>
  <li>
    <p><a href="https://obfuscator.io/">javascript-obfuscator</a>å¯¹åº”çš„è§£æ··æ·†å·¥å…·<a href="https://github.com/jscck/crack.js">crack.js</a></p>
  </li>
  <li>
    <p>å‹ç¼©ç±»å‹uglifyå¯¹åº”çš„å·¥å…·<a href="https://github.com/eth-sri/UnuglifyJS">UnuglifyJS</a>ï¼Œåœ¨çº¿ç‰ˆ<a href="http://www.jsnice.org/">jsnice</a></p>
  </li>
</ul>

<p>è§£æ··æ·†ç­–ç•¥å…¶å®æ˜¯ä¾æ®ç”Ÿæˆä»£ç è§„å¾‹ç¼–å†™ï¼Œä¸å¤–ä¹è§‚å¯Ÿç‰¹å¾åˆ†æï¼Œå†è§‚å¯Ÿç‰¹å¾åˆ†æï¼Œä¸æ–­è°ƒæ•´ã€‚éƒ½æ˜¯æ‰‹åŠçœ¼è§åŠŸå¤«ã€‚</p>

<p>éƒ½æ²¡æœ‰ä»€ä¹ˆéš¾åº¦å¯è¨€ï¼Œæœ‰çš„å°±æ˜¯è€æ€§ã€‚æ¯”å¦‚<a href="https://obfuscator.io/">javascript-obfuscator</a>å¯¹åº”çš„è§£æ··æ·†å·¥å…·å¯ä»¥<br />
åˆ†è§£ä¸ºNå› å­é—®é¢˜ï¼š</p>

<p>å¦‚ä½•æŸ¥è¯¢functionçš„ä½œç”¨åŸŸï¼Ÿ<br />
é¢„æ‰§è¡Œå˜é‡æ›¿æ¢å¯èƒ½å­˜åœ¨ç±»å‹ï¼Ÿ<br />
â€¦</p>

<p>å¦‚ï¼š</p>

<pre><code class="language-js">var _0xd6ac = ['[41m%s[0m', 'logG', 'log'];
(function(_0x203a66, _0x6dd4f4) {
  var _0x3c5c81 = function(_0x4f427c) {
    while (--_0x4f427c) {
      _0x203a66['push'](_0x203a66['shift']());
    }
  };
  _0x3c5c81(++_0x6dd4f4);
}(_0xd6ac, 0x6e));
var _0x5b26 = function(_0x2d8f05, _0x4b81bb) {
  _0x2d8f05 = _0x2d8f05 - 0x0;
  var _0x4d74cb = _0xd6ac[_0x2d8f05];
  return _0x4d74cb;
};

function logG(_0x4f1daa) {
  console[_0x5b26('0x0')]('[32m%s[0m', _0x4f1daa);
}

function logR(_0x38b325) {
  console[_0x5b26('0x0')](_0x5b26('0x1'), _0x38b325);
}
logG('logR');
logR(_0x5b26('0x2'));
</code></pre>

<p>è¦è¿˜åŸæˆ</p>

<pre><code class="language-js">function logG(message) {
  console.log('\x1b[32m%s\x1b[0m', message); 
}
function logR(message) {
  console.log('\x1b[41m%s\x1b[0m', message); 
}
logG('logR');
logR('logG');

</code></pre>
<p>ç¬¬ä¸€æ­¥ä½ æ€»å¾—çŸ¥é“å­—å…¸å‡½æ•°ï¼Œç„¶åæ‰§è¡Œå­—å…¸å‡½æ•° <code>_0x5b26('0x0')</code> è¿˜åŸæˆ <code>log</code>.</p>

<p>é‚£ä¹ˆå°±å¥½åŠäº†ï¼Œå†™ä»£ç çš„äº‹ã€‚<br />
å¦‚ https://github.com/jscck/crack.js/blob/master/crack.js</p>

<p>è¿˜åŸåï¼Œå¦‚ä½•é‡æ„ä»£ç ï¼Œé‚£ä¹ˆä½ è¿˜å¾—çŸ¥é“ä»£ç ç”Ÿæˆä¹‹å‰æ˜¯é€šè¿‡ä»€ä¹ˆå·¥å…·æ‰“åŒ…çš„webpack? è¿˜æ˜¯ï¼Ÿ</p>

<p>å¦‚webpack çš„å„ç§å°è£…å¤´å’Œå°¾<br />
https://webpack.js.org/configuration/output/#expose-a-variable</p>

<pre><code class="language-js">(function webpackUniversalModuleDefinition(root, factory) {
  if(typeof exports === 'object' &amp;&amp; typeof module === 'object')
    module.exports = factory();
  else if(typeof define === 'function' &amp;&amp; define.amd)
    define([], factory);
  else if(typeof exports === 'object')
    exports['MyLibrary'] = factory();
  else
    root['MyLibrary'] = factory();
})(typeof self !== 'undefined' ? self : this, function() {
  return _entry_return_;
});
</code></pre>

<p>å‡å¦‚å†æ·±å…¥ä¸€ç‚¹ï¼Œå¯èƒ½ä¼šæ¶‰åŠåˆ°JSè¯­æ³•è§£é‡Šå™¨, ASTæŠ½è±¡è¯­æ³•æ ‘</p>

<p>ç›®å‰æ¶‰åŠåˆ° JSè¯­æ³•è§£é‡Šå™¨, ASTæŠ½è±¡è¯­æ³•æ ‘çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p>

<p><a href="https://prepack.io/">prepack</a>, <a href="http://esprima.org/">esprima</a>, <a href="https://babeljs.io/">babel</a></p>

<p>æˆ–è€…å¯ä»¥é˜…è¯»ã€Šç¼–ç¨‹è¯­è¨€å®ç°æ¨¡å¼ã€‹ï¼Œæ¶‰åŠåˆ° <a href="https://github.com/antlr/antlr4">antlr4</a>ã€‚</p>

<p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡esprimaç­‰å·¥å…·æ¥åšè§£æ··æ·†ï¼Œåªæ˜¯å·¥ä½œé‡å¤§ä¸€ç‚¹ï¼Œå€¼ä¸å€¼çš„é—®é¢˜ã€‚</p>

<p>å¯¹äºæœªæ¥ï¼ŒJSå•†ä¸šæºç åŠ å¯†çš„æ–¹å‘å¯èƒ½<a href="https://webassembly.org/">webassembly</a>ï¼Œå…ˆåœ¨æœåŠ¡ç«¯ç¼–è¯‘æˆwasmï¼Œæºç å°±èƒ½çœŸæ­£çš„é—­æºã€‚</p>

<p>æœ‰äººçš„åœ°æ–¹å°±æœ‰è·¯ï¼Œæœ‰æ··æ·†çš„åœ°æ–¹å°±æœ‰è§£æ··æ·†ï¼Œç›®å‰æœºå™¨å­¦ä¹ ç¼–ç¨‹å“åº”çš„è§£æ··æ·†å·¥å…·ä¹Ÿåšçš„ç›¸å½“å‡ºè‰²ï¼Œæ¯”å¦‚</p>

<p><a href="16"><img src="https://www.sri.inf.ethz.ch/assets/images/sri-logo.svg" alt="Secure, Reliable, and Intelligent Systems Lab" width="136" /></a></p>

<p>Machine Learning for Programming äº§å“<br />
<a href="17">nice2predict</a>ï¼Œ<a href="9">jsnice</a> â€¦<br />
æŸ¥çœ‹ https://www.sri.inf.ethz.ch/research/plml</p>

<h2 id="æ‹“å±•å‚è€ƒ">æ‹“å±•å‚è€ƒ</h2>

<h3 id="astæŠ½è±¡è¯­æ³•æ ‘">ASTæŠ½è±¡è¯­æ³•æ ‘</h3>

<p>ä¸ºä»€ä¹ˆé¢å¤–è¯´ä¸€ä¸‹ASTæŠ½è±¡è¯­æ³•æ ‘ï¼Œå› ä¸ºä½ å¯ä»¥ input-&gt; ast -&gt; output Anythingã€‚</p>

<p>æ¯”å¦‚ä½ jsxè½¬æ¢å°ç¨‹åºæ¨¡ç‰ˆè¯­æ³•ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç”¨reactè¯­æ³•æ¥å†™å°ç¨‹åºï¼Œå¦‚Taroã€‚<br />
mpvue, wepy, postcss â€¦â€¦ è¿™äº›éƒ½æ˜¯é€šè¿‡ASTè¿›è¡Œæ„å»ºè½¬æ¢çš„å·¥å…·ï¼Œes6 -&gt; es5, babel éƒ½æ˜¯ä½¿ç”¨ASTã€‚</p>

<p>ASTæŠ½è±¡è¯­æ³•æ ‘å¤§è‡´æµç¨‹ï¼š</p>

<p>Input ç”Ÿæˆ AST tree</p>

<p>ç„¶åé€šè¿‡ASTç±»å‹æ–­è¨€è¿›è¡Œç›¸åº”çš„è½¬æ¢</p>

<p>http://esprima.org/demo/parse.html</p>

<h3 id="åç¼–è¯‘å·¥å…·å…¨é›†">åç¼–è¯‘å·¥å…·å…¨é›†</h3>

<p>å°ç¨‹åº</p>

<p>https://github.com/qwerty472123/wxappUnpacker</p>

<p><code>æ¨è.Netã€C# é€†å‘åç¼–è¯‘å››å¤§å·¥å…·åˆ©å™¨</code></p>

<p>https://www.cnblogs.com/ldc218/p/8945892.html</p>

<p>2018å¹´æ”¯æŒjava8çš„Javaåç¼–è¯‘å·¥å…·æ±‡æ€»<br />
https://blog.csdn.net/yannqi/article/details/80847354</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Docker Composeå…¥é—¨]]></title>
    <link href="http://blog.w3cub.com/blog/2018/12/23/docker-compose-gettingstarted/"/>
    <updated>2018-12-23T05:48:43+00:00</updated>
    <id>http://blog.w3cub.com/blog/2018/12/23/docker-compose-gettingstarted</id>
    <content type="html"><![CDATA[<pre><code>é¢„è®¡é˜…è¯»æ—¶é—´ï¼š10åˆ†é’Ÿ
</code></pre>

<p>åœ¨æ­¤é¡µé¢ä¸Šï¼Œæ‚¨å°†æ„å»ºä¸€ä¸ªåœ¨Docker Composeä¸Šè¿è¡Œçš„ç®€å•Python Webåº”ç”¨ç¨‹åºã€‚è¯¥åº”ç”¨ç¨‹åºä½¿ç”¨Flaskæ¡†æ¶å¹¶åœ¨Redisä¸­ç»´æŠ¤ä¸€ä¸ªå‘½ä¸­è®¡æ•°å™¨ã€‚è™½ç„¶è¯¥ç¤ºä¾‹ä½¿ç”¨Pythonï¼Œä½†å³ä½¿æ‚¨ä¸ç†Ÿæ‚‰å®ƒï¼Œæ­¤å¤„æ¼”ç¤ºçš„æ¦‚å¿µä¹Ÿåº”è¯¥æ˜¯å¯ä»¥ç†è§£çš„ã€‚</p>

<h2 id="é¢„å…ˆå‡†å¤‡">é¢„å…ˆå‡†å¤‡</h2>

<p>ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº† <a href="https://docs.docker.com/install/">Docker Engine</a> å’Œ <a href="https://docs.docker.com/compose/install/">Docker Compose</a>. æ‚¨ä¸éœ€è¦å®‰è£…Pythonæˆ–Redisï¼Œå› ä¸ºä¸¤è€…éƒ½æ˜¯ç”±Dockeré•œåƒæä¾›çš„ã€‚</p>

<!-- more -->

<h2 id="ç¬¬ä¸€æ­¥-setup">ç¬¬ä¸€æ­¥: Setup</h2>

<p>å®šä¹‰åº”ç”¨ç¨‹åºä¾èµ–(dependencies).</p>

<ol>
  <li>
    <p>ä¸ºé¡¹ç›®åˆ›å»ºä¸€ä¸ªç›®å½•:</p>

    <pre><code>$ mkdir composetest
$ cd composetest
</code></pre>
  </li>
  <li>
    <p>åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code>app.py</code>çš„æ–‡ä»¶å¹¶ç²˜è´´å¦‚ä¸‹:</p>
  </li>
</ol>

<pre><code class="language-python">import time

import redis
from flask import Flask

app = Flask(__name__)
cache = redis.Redis(host='redis', port=6379)

def get_hit_count():
    retries = 5
    while True:
        try:
            return cache.incr('hits')
        except redis.exceptions.ConnectionError as exc:
            if retries == 0:
                raise exc
            retries -= 1
            time.sleep(0.5)

@app.route('/')
def hello():
    count = get_hit_count()
    return 'Hello World! I have been seen {} times.\n'.format(count)

if __name__ == "__main__":
    app.run(host="0.0.0.0", debug=True)
</code></pre>

<p>In this example, <code>redis</code> is the hostname of the redis container on the applicationâ€™s network. We use the default port for Redis, <code>6379</code>.</p>

<blockquote>
  <p>Handling transient errors</p>

  <p>Note the way the <code>get_hit_count</code> function is written. This basic retry loop lets us attempt our request multiple times if the redis service is not available. This is useful at startup while the application comes online, but also makes our application more resilient if the Redis service needs to be restarted anytime during the appâ€™s lifetime. In a cluster, this also helps handling momentary connection drops between nodes.</p>
</blockquote>

<ol>
  <li>
    <p>åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºå¦ä¸€ä¸ªåä¸º<code>requirements.txt</code>çš„æ–‡ä»¶å¹¶ç²˜è´´å¦‚ä¸‹:</p>

    <pre><code>flask
redis
</code></pre>
  </li>
</ol>

<h2 id="ç¬¬äºŒæ­¥-åˆ›å»ºä¸€ä¸ªdockerfile">ç¬¬äºŒæ­¥: åˆ›å»ºä¸€ä¸ªDockerfile</h2>

<p>åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæ‚¨å°†ç¼–å†™ä¸€ä¸ªæ„å»ºåŒ…å«Pythonåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼ŒåŒ…æ‹¬Pythonæœ¬èº«çš„Dockeré•œåƒçš„Dockerfileã€‚</p>

<p>åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>Dockerfile</code>çš„æ–‡ä»¶å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š</p>

<pre><code>FROM python:3.4-alpine
ADD . /code
WORKDIR /code
RUN pip install -r requirements.txt
CMD ["python", "app.py"]
</code></pre>

<p>è¿™é‡Œå‘Šè¯‰Dockerè¦åšä»€ä¹ˆ:</p>

<ul>
  <li>Build an image starting with the Python 3.4 image.</li>
  <li>Add the current directory <code>.</code> into the path <code>/code</code> in the image.</li>
  <li>Set the working directory to <code>/code</code>.</li>
  <li>Install the Python dependencies.</li>
  <li>Set the default command for the container to <code>python app.py</code>.</li>
</ul>

<p>æ›´å¤šå…³äºå¦‚ä½•ç¼–å†™Dockerfilesçš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ <a href="https://docs.docker.com/engine/tutorials/dockerimages/#building-an-image-from-a-dockerfile">Docker user guide</a> å’Œ <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a>.</p>

<h2 id="ç¬¬ä¸‰æ­¥-åœ¨composeæ–‡ä»¶ä¸­å®šä¹‰æœåŠ¡">ç¬¬ä¸‰æ­¥: åœ¨Composeæ–‡ä»¶ä¸­å®šä¹‰æœåŠ¡</h2>

<p>åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code>docker-compose.yml</code>çš„æ–‡ä»¶å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:</p>
<pre><code class="language-yaml">version: '3'
services:
  web:
    build: .
    ports:
     - "5000:5000"
  redis:
    image: "redis:alpine"

</code></pre>

<p>è¿™Composeæ–‡ä»¶å®šä¹‰äº†ä¸¤ä¸ªæœåŠ¡, <code>web</code> and <code>redis</code>. The <code>web</code> service:</p>

<ul>
  <li>Uses an image thatâ€™s built from the <code>Dockerfile</code> in the current directory.</li>
  <li>Forwards the exposed port 5000 on the container to port 5000 on the host machine. We use the default port for the Flask web server, <code>5000</code>.</li>
</ul>

<p>The <code>redis</code> service uses a public <a href="https://registry.hub.docker.com/_/redis/">Redis</a> image pulled from the Docker Hub registry.</p>

<h2 id="ç¬¬å››æ­¥-ä½¿ç”¨composeæ„å»ºå’Œè¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åº">ç¬¬å››æ­¥: ä½¿ç”¨Composeæ„å»ºå’Œè¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åº</h2>

<ol>
  <li>ä»é¡¹ç›®ç›®å½•ä¸­ï¼Œè¿è¡Œ<code>docker-compose up</code>å¯åŠ¨åº”ç”¨ç¨‹åº.</li>
</ol>

<pre><code class="language-bash">$ docker-compose up
Creating network "composetest_default" with the default driver
Creating composetest_web_1 ...
Creating composetest_redis_1 ...
Creating composetest_web_1
Creating composetest_redis_1 ... done
Attaching to composetest_web_1, composetest_redis_1
web_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
redis_1  | 1:C 17 Aug 22:11:10.480 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
redis_1  | 1:C 17 Aug 22:11:10.480 # Redis version=4.0.1, bits=64, commit=00000000, modified=0, pid=1, just started
redis_1  | 1:C 17 Aug 22:11:10.480 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
web_1    |  * Restarting with stat
redis_1  | 1:M 17 Aug 22:11:10.483 * Running mode=standalone, port=6379.
redis_1  | 1:M 17 Aug 22:11:10.483 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
web_1    |  * Debugger is active!
redis_1  | 1:M 17 Aug 22:11:10.483 # Server initialized
redis_1  | 1:M 17 Aug 22:11:10.483 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.
web_1    |  * Debugger PIN: 330-787-903
redis_1  | 1:M 17 Aug 22:11:10.483 * Ready to accept connections
</code></pre>

<p>Composeæ‹‰å–Redisé•œåƒï¼Œä¸ºæ‚¨çš„ä»£ç æ„å»ºé•œåƒï¼Œå¹¶å¯åŠ¨æ‚¨å®šä¹‰çš„æœåŠ¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç åœ¨æ„å»ºæ—¶é™æ€å¤åˆ¶åˆ°æ˜ åƒä¸­ã€‚</p>

<ol>
  <li>
    <p>åœ¨æµè§ˆå™¨è¾“å…¥ <code>http://0.0.0.0:5000/</code> æŸ¥çœ‹åº”ç”¨è¿è¡Œæƒ…å†µ.</p>

    <p>If youâ€™re using Docker natively on Linux, Docker for Mac, or Docker for Windows, then the web app should now be listening on port 5000 on your Docker daemon host. Point your web browser to <code>http://localhost:5000</code> to find the <code>Hello World</code>message. If this doesnâ€™t resolve, you can also try <code>http://0.0.0.0:5000</code>.</p>

    <p>If youâ€™re using Docker Machine on a Mac or Windows, use <code>docker-machine ip MACHINE_VM</code> to get the IP address of your Docker host. Then, open <code>http://MACHINE_VM_IP:5000</code> in a browser.</p>

    <p>You should see a message in your browser saying:</p>

    <pre><code>Hello World! I have been seen 1 times.
</code></pre>

    <p><img src="https://docs.docker.com/compose/images/quick-hello-world-1.png" alt="hello world in browser" /></p>
  </li>
  <li>
    <p>åˆ·æ–°ç½‘é¡µ.</p>

    <p>The number should increment.</p>

    <pre><code>Hello World! I have been seen 2 times.
</code></pre>

    <p><img src="https://docs.docker.com/compose/images/quick-hello-world-2.png" alt="hello world in browser" /></p>
  </li>
  <li>
    <p>åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œç„¶åé”®å…¥<code>docker image ls</code>åˆ—å‡ºæœ¬åœ°é•œåƒ.</p>

    <p>Listing images at this point should return <code>redis</code> and <code>web</code>.</p>

    <pre><code>$ docker image ls
REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE
composetest_web         latest              e2c21aa48cc1        4 minutes ago       93.8MB
python                  3.4-alpine          84e6077c7ab6        7 days ago          82.5MB
redis                   alpine              9d8fa9aa0e5b        3 weeks ago         27.5MB
</code></pre>

    <p>You can inspect images with <code>docker inspect &lt;tag or id&gt;</code>.</p>
  </li>
  <li>
    <p>é€šè¿‡åœ¨å¦ä¸€ä¸ªç»ˆç«¯åœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œ<code>docker-compose down</code>, æˆ–è€…åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºçš„ç»ˆç«¯ä¸­æŒ‰CTRL + C æ¥åœæ­¢åº”ç”¨ç¨‹åº.</p>
  </li>
</ol>

<h2 id="ç¬¬äº”æ­¥-ç¼–è¾‘composeæ–‡ä»¶ä»¥æ·»åŠ ç»‘å®šè£…è½½">ç¬¬äº”æ­¥: ç¼–è¾‘Composeæ–‡ä»¶ä»¥æ·»åŠ ç»‘å®šè£…è½½</h2>

<p>ç¼–è¾‘é¡¹ç›®ç›®å½•ä¸­çš„<code>docker-compose.yml</code>ä¸º<code>web</code>æœåŠ¡æ·»åŠ  <a href="https://docs.docker.com/engine/admin/volumes/bind-mounts/">bind mount</a> :</p>
<pre><code class="language-yaml">version: '3'
services:
  web:
    build: .
    ports:
     - "5000:5000"
    volumes:
     - .:/code
  redis:
    image: "redis:alpine"

</code></pre>
<p>The new <code>volumes</code> key æŠŠé¡¹ç›®ç›®å½•ï¼ˆå½“å‰ç›®å½•ï¼‰æŒ‚è½½åˆ°å®¹å™¨å†…çš„<code>/ code</code>å…è®¸æ‚¨åŠ¨æ€ä¿®æ”¹ä»£ç ï¼Œè€Œæ— éœ€é‡å»ºæ˜ åƒ</p>

<h2 id="ç¬¬å…­æ­¥-ä½¿ç”¨compose-re-buildå¹¶è¿è¡Œåº”ç”¨ç¨‹åº">ç¬¬å…­æ­¥: ä½¿ç”¨Compose Re-buildå¹¶è¿è¡Œåº”ç”¨ç¨‹åº</h2>

<p>åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œé”®å…¥<code>docker-compose up</code>ä»¥ä½¿ç”¨æ›´æ–°çš„Composeæ–‡ä»¶æ„å»ºåº”ç”¨ç¨‹åºï¼Œç„¶åè¿è¡Œå®ƒã€‚</p>
<pre><code class="language-bash">$ docker-compose up
Creating network "composetest_default" with the default driver
Creating composetest_web_1 ...
Creating composetest_redis_1 ...
Creating composetest_web_1
Creating composetest_redis_1 ... done
Attaching to composetest_web_1, composetest_redis_1
web_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
...
</code></pre>

<p>Check the <code>Hello World</code> message in a web browser again, and refresh to see the count increment.</p>

<blockquote>
  <p>Shared folders, volumes, and bind mounts</p>

  <ul>
    <li>
      <p>If your project is outside of the <code>Users</code> directory (<code>cd ~</code>), then you need to share the drive or location of the Dockerfile and volume you are using. If you get runtime errors indicating an application file is not found, a volume mount is denied, or a service cannot start, try enabling file or drive sharing. Volume mounting requires shared drives for projects that live outside of <code>C:\Users</code> (Windows) or <code>/Users</code> (Mac), and is required for <em>any</em> project on Docker for Windows that uses <a href="https://docs.docker.com/docker-for-windows/#switch-between-windows-and-linux-containers-beta-feature">Linux containers</a>. For more information, see <a href="https://docs.docker.com/docker-for-windows/#shared-drives">Shared Drives</a> on Docker for Windows, <a href="https://docs.docker.com/docker-for-mac/#file-sharing">File sharing</a> on Docker for Mac, and the general examples on how to <a href="https://docs.docker.com/engine/tutorials/dockervolumes/">Manage data in containers</a>.</p>
    </li>
    <li>
      <p>If you are using Oracle VirtualBox on an older Windows OS, you might encounter an issue with shared folders as described in this <a href="https://www.virtualbox.org/ticket/14920">VB trouble ticket</a>. Newer Windows systems meet the requirements for <a href="https://docs.docker.com/docker-for-windows/install/">Docker for Windows</a> and do not need VirtualBox.</p>
    </li>
  </ul>
</blockquote>

<h2 id="ç¬¬ä¸ƒæ­¥-æ›´æ–°åº”ç”¨ç¨‹åº">ç¬¬ä¸ƒæ­¥: æ›´æ–°åº”ç”¨ç¨‹åº</h2>

<p>ç”±äºåº”ç”¨ç¨‹åºä»£ç ç°åœ¨ä½¿ç”¨å·å®‰è£…åˆ°å®¹å™¨ä¸­ï¼Œå› æ­¤æ‚¨å¯ä»¥æ›´æ”¹å…¶ä»£ç å¹¶ç«‹å³æŸ¥çœ‹æ›´æ”¹ï¼Œè€Œæ— éœ€é‡å»ºæ˜ åƒ.</p>

<ol>
  <li>
    <p>Change the greeting in <code>app.py</code> and save it. For example, change the <code>Hello World!</code> message to <code>Hello from Docker!</code>:</p>

    <pre><code>return 'Hello from Docker! I have been seen {} times.\n'.format(count)
</code></pre>
  </li>
  <li>
    <p>Refresh the app in your browser. The greeting should be updated, and the counter should still be incrementing.</p>

    <p><img src="https://docs.docker.com/compose/images/quick-hello-world-3.png" alt="hello world in browser" /></p>
  </li>
</ol>

<h2 id="ç¬¬å…«æ­¥-å°è¯•ä¸€äº›å…¶ä»–å‘½ä»¤">ç¬¬å…«æ­¥: å°è¯•ä¸€äº›å…¶ä»–å‘½ä»¤</h2>

<p>å¦‚æœä½ æƒ³åœ¨åå°è¿è¡Œä½ çš„æœåŠ¡, ä½ å¯ä»¥åœ¨<code>docker-compose up</code>å‘½ä»¤åé¢æ·»åŠ  <code>-d</code> (for â€œdetachedâ€ mode)ï¼Œä½¿ç”¨<code>docker-compose ps</code>æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å†…å®¹:</p>

<pre><code class="language-bash">$ docker-compose up -d
Starting composetest_redis_1...
Starting composetest_web_1...

$ docker-compose ps
Name                 Command            State       Ports
-------------------------------------------------------------------
composetest_redis_1   /usr/local/bin/run         Up
composetest_web_1     /bin/sh -c python app.py   Up      5000-&gt;5000/tcp
</code></pre>

<p><code>docker-compose run</code>å‘½ä»¤å…è®¸æ‚¨ä¸ºæœåŠ¡è¿è¡Œä¸€æ¬¡æ€§å‘½ä»¤ã€‚ä¾‹å¦‚ï¼ŒæŸ¥çœ‹<code>web</code>æœåŠ¡å¯ç”¨çš„ç¯å¢ƒå˜é‡:</p>

<pre><code>$ docker-compose run web env
</code></pre>

<p>å¯ä»¥é€šè¿‡<code>docker-compose --help</code>æŸ¥çœ‹æ›´å¤šå…¶ä»–å¯ç”¨å‘½ä»¤  . æ‚¨è¿˜å¯ä»¥ä¸ºbashå’Œzsh shellå®‰è£… <a href="https://docs.docker.com/compose/completion/">command completion</a>,ä»¥æŸ¥çœ‹å¯ç”¨çš„å‘½ä»¤.</p>

<p>å¦‚æœæ‚¨ä½¿ç”¨<code>docker-compose up -d</code>å¯åŠ¨Composeï¼Œè¯·åœ¨å®Œæˆååœæ­¢æœåŠ¡:</p>

<pre><code>$ docker-compose stop
</code></pre>

<p>æ‚¨å¯ä»¥ä½¿ç”¨<code>down</code>å‘½ä»¤å°†æ‰€æœ‰å†…å®¹æ”¾ä¸‹ï¼Œå®Œå…¨åˆ é™¤å®¹å™¨. ä¼ é€’<code>--volumes</code>ä¹Ÿå¯ä»¥åˆ é™¤Rediså®¹å™¨ä½¿ç”¨çš„æ•°æ®æŒ‚è½½:</p>

<pre><code>$ docker-compose down --volumes
</code></pre>

<p>åˆ°è¿™é‡Œ, æ‚¨å·²ç»äº†è§£äº†Composeå¦‚ä½•å·¥ä½œçš„åŸºç¡€çŸ¥è¯†.</p>

<h2 id="æ¥ä¸‹æ¥">æ¥ä¸‹æ¥</h2>

<ul>
  <li>Next, try the quick start guide for <a href="https://docs.docker.com/compose/django/">Django</a>, <a href="https://docs.docker.com/compose/rails/">Rails</a>, or <a href="https://docs.docker.com/samples/library/wordpress/">WordPress</a></li>
  <li><a href="https://docs.docker.com/compose/reference/">Explore the full list of Compose commands</a></li>
  <li><a href="https://docs.docker.com/compose/compose-file/">Compose configuration file reference</a></li>
  <li>
    <p>To learn more about volumes and bind mounts, see <a href="https://docs.docker.com/engine/admin/volumes/">Manage data in Docker</a></p>

    <p>documentation, docs, docker, compose, orchestration, containers</p>
  </li>
</ul>

<hr />

<p>Terry edit on <a href="http://markdown.w3cub.com/">markdownç¼–è¾‘</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å‰ç«¯é¢è¯•é¢˜ä¹‹ä»–ä»¬æƒ³é—®ä»€ä¹ˆï¼Ÿ]]></title>
    <link href="http://blog.w3cub.com/blog/2018/09/19/front-end-interview-questions-what-do-you-want-to-ask/"/>
    <updated>2018-09-19T14:55:43+00:00</updated>
    <id>http://blog.w3cub.com/blog/2018/09/19/front-end-interview-questions--what-do-you-want-to-ask</id>
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨æ‰¾å·¥ä½œé‡åˆ°å¾ˆå¤šå¥‡è‘©çš„é¢è¯•é—®é¢˜ï¼Ÿæ€ä¹ˆè¯´å‘¢ï¼Œå°±æ˜¯æ¯”è¾ƒä¹¦é¢æ€§çš„ï¼Œæ¯”è¾ƒå­¦æœ¯æ€§çš„é—®é¢˜ï¼Ÿ<br />
ä»Šå¤©å¤§å®¶åˆ†äº«ä¸€ä¸‹å§ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ç©¶ç«Ÿè¿™äº›é—®é¢˜ç©¶ç«Ÿåœ¨é—®ä»€ä¹ˆï¼Ÿè·Ÿæœ€ç»ˆåƒè¡¨è¾¾çš„æ˜¯ä»€ä¹ˆï¼Ÿ<br />
å¯¹äºé¢è¯•é¢˜ï¼ŒçœŸæ˜¯åƒç§‹å„å¼‚ï¼Œæœ‰äº›å…¬å¸å–œæ¬¢é—®åŸç†ï¼Œæœ‰äº›å…¬å¸ä¸ç®¡åŸç†ä»€ä¹ˆçš„ï¼Œç›´æ¥é‚£ä¸ªAPIæ€ä¹ˆæ€ä¹ˆç”¨ï¼</p>

<!-- more -->

<p>å›å½’æ­£é¢˜å§!</p>

<h2 id="1æµè§ˆå™¨è¾“å…¥urlåéƒ½å¹²äº†äº›ä»€ä¹ˆ">1ã€æµè§ˆå™¨è¾“å…¥urlåéƒ½å¹²äº†äº›ä»€ä¹ˆ?</h2>

<p>ä½ åªä¼šç­”ï¼šå»ºç«‹è¯·æ±‚ï¼Œæ¥æ”¶æ•°æ®ï¼Œdomæ¸²æŸ“ç­‰ã€‚é‚£ä¹ˆç™¾åº¦ä¸€ä¸‹åˆ«äººæ˜¯æ€ä¹ˆå†™ï¼Ÿ<br />
å…¶å®ä¹Ÿå·®ä¸å¤šåªæ˜¯åˆ†è§£çš„å¾ˆç»†ï¼ŒæŒ‰æˆ‘çš„ç†è§£è¯´ä¸€ä¸‹å§</p>

<p>1ï¼‰ å¦‚ä½•å»ºç«‹è¯·æ±‚ï¼Ÿå¼•ç”³å‡ºæ¥çš„HTTPåè®®çš„ç†è§£äº†ï¼Ÿ<br />
é‚£ä¹ˆHTTPåè®®å¦‚ä½•å·¥ä½œï¼Ÿ</p>

<p>ä¸€ä¸ªåŸºæœ¬HTTPç³»ç»Ÿæœ‰ä»€ä¹ˆç»„ä»¶æ„æˆï¼Ÿ</p>

<p><img width="418" alt="default" src="https://user-images.githubusercontent.com/1061012/45764276-f4866500-bc64-11e8-9825-49c9ac0efa2d.png" /></p>

<p>è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</p>

<p>[client/request] â€“[Proxy] â€“ [Proxy] â€“ [Proxy]â€“ [Server/response]</p>

<p>å…¶ä¸­Proxiesä¸­å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>

<ul>
  <li>caching (the cache can be public or private, like the browser cache)</li>
  <li>filtering (like an antivirus scan, parental controls, â€¦)</li>
  <li>load balancing (to allow multiple servers to serve the different requests)</li>
  <li>authentication (to control access to different resources)</li>
  <li>logging (allowing the storage of historical information)</li>
</ul>

<p>HTTPå¤§è‡´çš„æµç¨‹ï¼š</p>

<p>1ã€Open a TCP connection (å»ºç«‹TCPé“¾æ¥)</p>

<p>2ã€Send an HTTP message ï¼ˆå‘é€HTTPæ¶ˆæ¯ï¼‰</p>

<p>3ã€Read the response sent by the server ï¼ˆè¯»å–æœåŠ¡å™¨å“åº”ä¿¡æ¯ï¼‰</p>

<p>4ã€Close or reuse the connection for further requests.ï¼ˆå…³é—­æˆ–è€…é‡ç”¨é“¾æ¥ï¼‰</p>

<p><a href="https://docs.w3cub.com/http/overview/">https://docs.w3cub.com/http/overview/</a></p>

<p>2ï¼‰å¦‚ä½•æ¸²æŸ“é¡µé¢çš„ï¼Ÿ</p>

<p>ä»»ä½•æµè§ˆå™¨éƒ½åº”è¯¥æœ‰çš„7å¤§ç»„ä»¶</p>

<p><img src="https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/layers.png" alt="How Web Browswers Work 2" width="432" height="296" /></p>

<p>æ¶‰åŠåˆ°çš„è¦ç‚¹ï¼šDOM Tree, Html Parser, Css Parser, Layout, Painting, Css Box Modal(ç›’å­æ¨¡å‹), Positioning ç­‰ç­‰ï¼Œå¾ˆé•¿ä¸ä¸€ä¸€è¯´ï¼Œå¯ä»¥é˜…è¯»ä¸‹é¢é“¾æ¥ã€‚</p>

<p><a href="https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/">https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/</a></p>

<h2 id="2-eventloopçš„ç†è§£">2ã€ eventloopçš„ç†è§£ï¼Ÿ</h2>

<p>ä½ åªä¼šç­”ï¼šä½ æŒ‡çš„æ˜¯setTimeoutï¼Œä½œç”¨åŸŸï¼Œæ‰§è¡Œæœºåˆ¶ä¹‹ç±»çš„å—ï¼Ÿ</p>

<p>å…¶å®æƒ³é—®çš„æ˜¯æµè§ˆå™¨å•çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ setTimeoutåœ¨å½“å‰ä½œç”¨åŸŸæœ€åè°ƒç”¨åªæ˜¯ä¸€ä¸ªå­é›†</p>

<p><img src="https://mdn.mozillademos.org/files/4617/default.svg" alt="Stack, heap, queue" style="height: 270px; width: 294px;" /></p>

<p>alert å’Œ synchronous XHR ä¼šå µå¡æµè§ˆå™¨</p>

<p>eventLoop å¤§è‡´çš„æ‰§è¡Œé¡ºåº</p>

<pre><code class="language-js">while (eventLoop.waitForTask()) {
  const taskQueue = eventLoop.selectTaskQueue()
  if (taskQueue.hasNextTask()) {
    taskQueue.processNextTask()
  }

  const microtaskQueue = eventLoop.microTaskQueue
  while (microtaskQueue.hasNextMicrotask()) {
    microtaskQueue.processNextMicrotask()
  }

  if (shouldRender()) {
    applyScrollResizeAndCSS()
    runAnimationFrames()
    render()
  }
}

</code></pre>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop">https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop</a></p>

<p><a href="https://blog.risingstack.com/writing-a-javascript-framework-execution-timing-beyond-settimeout/">https://blog.risingstack.com/writing-a-javascript-framework-execution-timing-beyond-settimeout/</a></p>

<h2 id="3vue-æˆ–-react-diffç®—æ³•åŸç†çš„æœ‰äº†è§£è¿‡å—">3ã€Vue æˆ– react Diffç®—æ³•åŸç†çš„æœ‰äº†è§£è¿‡å—ï¼Ÿ</h2>

<p>è¿‡ç¨‹ï¼š</p>

<p>è·Ÿä¸Šä¸€æ¬¡ vircual dom diff åç”Ÿæˆè¯­æ³•æ ‘, ç„¶åpatchå›å» native dom.</p>

<p>çŠ¶æ€æœº -&gt; virtual dom(template) diff -&gt; ç”Ÿæˆ patch -&gt; native dom.</p>

<p>Vue virtual DOM patching ç®—æ³•æ˜¯åŸºäº https://github.com/snabbdom/snabbdom</p>

<p>diff ç®—æ³•å¤§è‡´ O(n3) -&gt; O(n) å¼•å…¥ä¸¤ä¸ªå‰ææ¡ä»¶ï¼šelements Types å’Œ collection key</p>

<p>React:</p>

<p>https://reactjs.org/docs/reconciliation.html</p>

<h2 id="4-vue-data-vuex-æˆ–è€…-react-state-redux-æ˜¯å¦‚ä½•å·¥ä½œçš„">4ã€ Vue data Vuex æˆ–è€… React state Redux æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>

<p>Vuex</p>

<p><img src="http://wx2.sinaimg.cn/large/50e0073dgy1fwg0bx3mo8j20jh0fbwef.jpg" alt="" /></p>

<p>Redux</p>

<p><img src="http://wx1.sinaimg.cn/large/50e0073dgy1fwuwvl12isg21400u0kjm.gif" alt="" /></p>

<p>Dva <br />
<img src="http://wx1.sinaimg.cn/mw690/50e0073dgy1fwg0c6xkgej218u0e4ju8.jpg" alt="" /></p>

<p>Redux-saga</p>

<p><img src="http://wx1.sinaimg.cn/mw690/50e0073dgy1fwg0hxxv3bj20u30f2q4e.jpg" alt="" /></p>

<p>-å®Œ-</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Complete NGINX Cookbook notes]]></title>
    <link href="http://blog.w3cub.com/blog/2018/09/19/complete-nginx-cookbook-notes/"/>
    <updated>2018-09-19T04:51:43+00:00</updated>
    <id>http://blog.w3cub.com/blog/2018/09/19/complete-nginx-cookbook-notes</id>
    <content type="html"><![CDATA[<p>Complete NGINX Cookbook é¦–å…ˆè¿™æœ¬è¯´æ˜¯å¯ä»¥å…è´¹ä¸‹è½½çš„ã€‚</p>

<p>https://www.nginx.com/resources/library/complete-nginx-cookbook/</p>

<p>æ­£é¢˜</p>

<p>æˆ‘ä»¬éƒ½æ¸…æ¥š Oâ€™Reilly Cookbook ç±»å‹çš„ä¹¦ç±çš„é£æ ¼ï¼Œä¸»è¦è¡Œæ–‡é£æ ¼éƒ½æ˜¯æå‡ºé—®é¢˜ï¼Œç»™å‡ºç­”æ¡ˆå¹¶è§£å†³é—®é¢˜ã€‚</p>

<p>è¿™æœ¬è¯´ä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†è®²è§£ï¼š</p>

<ul>
  <li>Part I: Load Balancing and HTTP Cachingï¼ˆè´Ÿè½½å¹³è¡¡å’ŒHTTPç¼“å­˜ï¼‰</li>
  <li>Part II: Security and Access ï¼ˆå®‰å…¨å’Œè®¿é—®ï¼‰</li>
  <li>Part III: Deployment and Operations ï¼ˆéƒ¨ç½²å’Œè¿è¥ï¼‰</li>
</ul>

<p>æœ€å¸¸ç”¨åˆ°çš„å½“ç„¶æ˜¯ç¬¬ä¸€ç« ï¼Œè´Ÿè½½å‡è¡¡ï¼›åä¸€ç« ï¼Œè®¿é—®æ§åˆ¶ï¼Œå¦‚ä½•è®¾ç½®è·¨åŸŸï¼›åä¸‰ç« ï¼Œhttpsé…ç½®ç­‰ã€‚<br />
ç›¸å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œæˆ‘ä»¬æ›´å¤šçš„åªéœ€è¦äº†è§£ç¬¬ä¸€éƒ¨åˆ†ã€‚ç¬¬ä¸‰éƒ¨åˆ†å¯¹äºå¼€å‘è€…æ²¡æœ‰ä»€ä¹ˆå¿…è¦ï¼Œæ‰€ä»¥å°±æ²¡æœ‰è®°å½•ï¼Œæœ‰éœ€è¦çš„å¯ä»¥è‡ªè¡Œé˜…è¯»ã€‚</p>

<!-- more -->

<ul>
  <li>ç¬¬ä¸€éƒ¨åˆ†ï¼š</li>
</ul>

<h2 id="ç¬¬ä¸€ç« -high-performance-load-balancing-é«˜æ€§èƒ½è´Ÿè½½å‡è¡¡">ç¬¬ä¸€ç«  High-Performance Load Balancing ï¼ˆé«˜æ€§èƒ½è´Ÿè½½å‡è¡¡ï¼‰</h2>

<p>1.1 HTTP Load Balancingï¼ˆhttpè´Ÿè½½å‡è¡¡ï¼‰</p>

<pre><code>upstream backend {
    server 10.10.12.45:80 weight=1;
    server app.example.com:80 weight=2;
}
server {
    location / {
        proxy_pass http://backend;
    }
}

</code></pre>
<p>ä½ æŠŠå½“å‰è¯·æ±‚è´Ÿè½½åˆ°å¤šä¸ªserverä¸Šï¼ŒåŒæ—¶serverå¯ä»¥æŒ‡å®šæƒé‡ï¼ˆweightï¼‰ã€‚</p>

<p>æ›´å¤šé…ç½®å¯ä»¥è®¿é—® https://docs.w3cub.com/nginx/stream/ngx_stream_upstream_module/#upstream</p>

<p>1.2 TCP Load Balancing ï¼ˆTCPè´Ÿè½½å‡è¡¡ï¼‰</p>

<pre><code>stream {
    upstream mysql_read {
        server read1.example.com:3306 weight=5;
        server read2.example.com:3306;
        server 10.10.12.34:3306 backup;
    }
    server {
        listen 3306;
        proxy_pass mysql_read;
    }
}
</code></pre>

<p>1.3 Load-Balancing Methods ï¼ˆè´Ÿè½½å‡è¡¡æ–¹æ³•ï¼‰</p>

<p>The following load-balancing methods are available for upstream HTTP, TCP, and UDP pools:</p>

<p>äº”ç§æ–¹æ³•ï¼ˆæŒ‡ä»¤åç§°ï¼‰ï¼š</p>

<p>Round robin ï¼ˆ weight=xï¼‰<br />
Least connections ï¼ˆleast_connï¼‰<br />
Least time ï¼ˆleast_timeï¼‰<br />
Generic hash ï¼ˆhashï¼‰<br />
IP hash ï¼ˆip_hashï¼‰</p>

<p>é˜…è¯»ï¼š https://docs.w3cub.com/nginx/stream/ngx_stream_upstream_module/</p>

<p>1.4 Connection Limiting ï¼ˆè¿æ¥æ•°é™åˆ¶ï¼‰</p>

<pre><code>upstream backend {
    zone backends 64k;
    queue 750 timeout=30s;
    server webserver1.example.com max_conns=25;
    server webserver2.example.com max_conns=15;
}

</code></pre>

<h2 id="ç¬¬äºŒç« -intelligent-session-persistence--æ™ºèƒ½ä¼šè¯æŒä¹…æ€§">ç¬¬äºŒç«  Intelligent Session Persistence  ï¼ˆæ™ºèƒ½ä¼šè¯æŒä¹…æ€§ï¼‰</h2>

<p>2.1 Sticky Cookie ï¼ˆç²˜æ€§Cookieï¼‰</p>

<p>You need to bind a downstream client to an upstream server</p>

<p>sticky cookie æŒ‡ä»¤</p>

<pre><code>upstream backend {
    server backend1.example.com;
    server backend2.example.com;
    sticky cookie
           affinity
           expires=1h
           domain=.example.com
           httponly
           secure
           path=/;
}

</code></pre>

<p>2.2 Sticky Learn</p>

<p>You need to bind a downstream client to an upstream server by using an existing cookie.</p>

<p>sticky learn æŒ‡ä»¤</p>

<pre><code>upstream backend {
    server backend1.example.com:8080;
    server backend2.example.com:8081;
    sticky learn
            create=$upstream_cookie_cookiename
            lookup=$cookie_cookiename
            zone=client_sessions:2m;
}
</code></pre>

<p>2.3 Sticky Routing</p>

<p>æä¾›ä¸€ä¸ªæ˜ å°„ä¿®æ­£å¤„ç†</p>

<pre><code>map $cookie_jsessionid $route_cookie {
    ~.+\.(?P&lt;route&gt;\w+)$ $route;
}
map $request_uri $route_uri {
    ~jsessionid=.+\.(?P&lt;route&gt;\w+)$ $route;
}
upstream backend {
    server backend1.example.com route=a;
    server backend2.example.com route=b;
    sticky route $route_cookie $route_uri;
}
</code></pre>

<p>2.4 Connection Draining</p>

<p>You need to gracefully remove servers for maintenance or other reasons while still serving sessions.</p>

<pre><code>curl 'http://localhost/upstream_conf?upstream=backend&amp;id=1&amp;drain=1'
</code></pre>

<h2 id="ç¬¬äº”ç« -massively-scalable-content-caching-å¤§è§„æ¨¡å¯æ‰©å±•çš„å†…å®¹ç¼“å­˜">ç¬¬äº”ç«  Massively Scalable Content Caching ï¼ˆå¤§è§„æ¨¡å¯æ‰©å±•çš„å†…å®¹ç¼“å­˜ï¼‰</h2>

<p>5.1 Caching Zones ï¼ˆç¼“å­˜åŒºï¼‰</p>

<p>You need to cache content and need to define where the cache is stored.</p>

<p>Use the proxy_cache_path directive to define shared memory cache<br />
zones and a location for the content:</p>

<pre><code>proxy_cache_path /var/nginx/cache
                keys_zone=CACHE:60m
                levels=1:2
                inactive=3h
                max_size=20g;
proxy_cache CACHE;
</code></pre>

<p>5.2 Caching Hash Keys</p>

<p>You need to control how your content is cached and looked up.</p>

<p>Use the proxy_cache_key directive, along with variables to define<br />
what constitutes a cache hit or miss:</p>

<pre><code>proxy_cache_key "$host$request_uri $cookie_user";
</code></pre>

<p>5.3 Cache Bypass</p>

<p>Use the proxy_cache_bypass directive with a nonempty or nonzero<br />
value. One way to do this is by setting a variable within location<br />
blocks that you do not want cached to equal 1:</p>

<pre><code>proxy_cache_bypass $http_cache_bypass;

</code></pre>

<p>The configuration tells NGINX to bypass the cache if the HTTP<br />
request header named cache_bypass is set to any value that is not 0.</p>

<p>5.4 Cache Performance (æ€§èƒ½)</p>

<pre><code>location ~* \.(css|js)$ {
  expires 1y;
  add_header Cache-Control "public";
}
</code></pre>

<p>5.5 Purging ï¼ˆï¼‰</p>

<pre><code>map $request_method $purge_method {
    PURGE 1;
    default 0;
}
server {
    ...
    location / {
        ...
        proxy_cache_purge $purge_method;
    }
}

</code></pre>

<hr />

<p>Part II: Security and Accessï¼ˆå®‰å…¨å’Œè®¿é—®ï¼‰</p>

<h2 id="ç¬¬åä¸€ç« -controlling-access">ç¬¬åä¸€ç«  Controlling Access</h2>

<p>11.1 Access Based on IP Address</p>

<p>æ ¹æ®å®¢æˆ·ç«¯IPè®¾å®šè®¿é—®æƒé™</p>

<pre><code>location /admin/ {
    deny 10.0.0.1;
    allow 10.0.0.0/20;
    allow 2001:0db8::/32;
    deny all;
}

</code></pre>

<p>11.2 Allowing Cross-Origin Resource Sharing</p>

<p>è·¨åŸŸèµ„æºå…±äº«, è¿™é‡Œçš„OPTIONS å¤„ç†å¯ä»¥å‚è€ƒ</p>

<pre><code>map $request_method $cors_method {
    OPTIONS 11;
    GET 1;
    POST 1;
    default 0;
}
server {
    ...
    location / {
        if ($cors_method ~ '1') {
            add_header 'Access-Control-Allow-Methods' 
            'GET,POST,OPTIONS';
            add_header 'Access-Control-Allow-Origin'
            '*.example.com';
            add_header 'Access-Control-Allow-Headers'
            'DNT,
            Keep-Alive,
            User-Agent,
            If-Modified-Since,
            Cache-Control,
            Content-Type';
        }
        if ($cors_method = '11') {
            add_header 'Access-Control-Max-Age' 1728000;
            add_header 'Content-Type' 'text/plain; charset=UTF-8';
            add_header 'Content-Length' 0;
            return 204;
        }
    }
}

</code></pre>

<h2 id="ç¬¬åäºŒç« -limiting-use-é™åˆ¶ä½¿ç”¨">ç¬¬åäºŒç«  Limiting Use ï¼ˆé™åˆ¶ä½¿ç”¨ï¼‰</h2>

<p>12.1 Limiting Connections <br />
é™åˆ¶è¿æ¥æ•°</p>

<p>You need to limit the number of connections based on a <code>predefined key</code>, such as the clientâ€™s IP address.</p>

<p>limit_conn æŒ‡ä»¤</p>

<pre><code>http {
    limit_conn_zone $binary_remote_addr zone=limitbyaddr:10m;
    limit_conn_status 429;
    ...
    server {
        ...
        limit_conn limitbyaddr 40;
        ...
    }
}
</code></pre>

<p>This configuration creates a shared memory zone named limit <br />
byaddr. The predefined key used is the clientâ€™s IP address in binary<br />
form. The size of the shared memory zone is set to 10 megaâ€<br />
bytes. The limit_conn directive takes two parameters: a<br />
limit_conn_zone name, and the number of connections allowed.<br />
The limit_conn_status sets the response when the connections are<br />
limited to a status of 429, indicating too many<br />
requests. The limit_conn and limit_conn_status directives are<br />
valid in the HTTP, server, and location context.</p>

<p>12.2 Limiting Rate</p>

<p>é¢‘ç‡</p>

<pre><code>http {
    limit_req_zone $binary_remote_addr
        zone=limitbyaddr:10m rate=1r/s;
    limit_req_status 429;
    ...
    server {
        ...
        limit_req zone=limitbyaddr burst=10 nodelay;
        ...
    }
}

</code></pre>

<p>12.3 Limiting Bandwidth</p>

<p>å¸¦å®½é™åˆ¶ï¼Œ è‡ªåŠ¨é™é€Ÿ</p>

<pre><code>location /download/ {
    limit_rate_after 10m;
    limit_rate 1m;
}
</code></pre>

<h2 id="ç¬¬åä¸‰ç« -encrypting">ç¬¬åä¸‰ç«  Encrypting</h2>

<p>13.1 Client-Side Encryption</p>

<p>You need to encrypt traffic between your NGINX server and the client.</p>

<p>åŠ å¯†ä¼ è¾“ï¼ŒSSL modules such as  the <code>ngx_http_ssl_module</code> or <code>ngx_stream_ssl_module</code></p>

<pre><code>http { # All directives used below are also valid in stream
    server {
        listen 8433 ssl;
        ssl_protocols TLSv1.2;
        ssl_ciphers HIGH:!aNULL:!MD5;
        ssl_certificate /usr/local/nginx/conf/cert.pem;
        ssl_certificate_key /usr/local/nginx/conf/cert.key;
        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
    }
}

</code></pre>

<p>æ›´æ–°é˜…è¯»  <br />
https://docs.w3cub.com/nginx/http/ngx_http_ssl_module/#example   <br />
https://docs.w3cub.com/nginx/stream/ngx_stream_ssl_module/#example</p>

<p>13.2 Upstream Encryption</p>

<p>You need to encrypt traffic between NGINX and the upstream service <br />
and set specific negotiation rules for compliance regulations <br />
or if the upstream is outside of your secured network.</p>

<pre><code>location / {
    proxy_pass https://upstream.example.com;
    proxy_ssl_verify on;
    proxy_ssl_verify_depth 2;
    proxy_ssl_protocols TLSv1.2;
}
</code></pre>

<h2 id="ç¬¬åå››ç« -http-basic-authentication">ç¬¬åå››ç«  HTTP Basic Authentication</h2>

<p>åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œåˆ›å»ºå¯†ç æ–‡ä»¶ï¼Œ è®¾å®šnginx é…ç½®</p>

<p>14.1 Creating a User File</p>

<p>æ–‡ä»¶æ ¼å¼</p>

<pre><code># comment
name1:password1
name2:password2:comment
name3:password3

</code></pre>

<p>æˆ–è€…é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼ˆå…ˆå®‰è£…opensslï¼‰</p>

<pre><code>openssl passwd MyPassword1234
</code></pre>

<p>14.2 Using Basic Authentication</p>

<pre><code>location / {
    auth_basic "Private site";
    auth_basic_user_file conf.d/passwd;
}

</code></pre>

<h2 id="ç¬¬åäº”ç« -http-authentication-subrequests">ç¬¬åäº”ç«  HTTP Authentication Subrequests</h2>

<p>15.1 Authentication Subrequests</p>

<p>Use the http_auth_request_module to make a request to the<br />
authentication service to verify identity before serving the request:</p>

<pre><code>location /private/ {
    auth_request /auth;
    auth_request_set $auth_status $upstream_status;
}
location = /auth {
    internal;
    proxy_pass http://auth-server;
    proxy_pass_request_body off;
    proxy_set_header Content-Length "";
    proxy_set_header X-Original-URI $request_uri;
}
</code></pre>

<h2 id="ç¬¬åå…­ç« --secure-links">ç¬¬åå…­ç«   Secure Links</h2>

<p>16.1 Securing a Location</p>

<p>Use the secure link module and the secure_link_secret directive<br />
to restrict access to resources to users who have a secure link:</p>

<pre><code>location /resources {
    secure_link_secret mySecret;
    if ($secure_link = "") { return 403; }
    rewrite ^ /secured/$secure_link;
}
location /secured/ {
    internal;
    root /var/www;
}
</code></pre>

<p>16.2 Generating a Secure Link with a Secret (ç”Ÿæˆä¸€ä¸ªå®‰å…¨é“¾æ¥)</p>

<p>You need to generate a secure link from <code>your application</code> using a<br />
secret.</p>

<p>The <code>secure link module</code> in NGINX accepts the hex digest of an <code>md5</code><br />
hashed string, where the string is a concatenation of the URI path<br />
and the secret.</p>

<pre><code>echo -n 'index.htmlmySecret' | openssl md5 -hex

(stdin)= a53bee08a4bf0bbea978ddf736363a12
</code></pre>
<p>Pythonç¤ºä¾‹</p>

<pre><code class="language-py">import hashlib
hashlib.md5.(b'index.htmlmySecret').hexdigest()

'a53bee08a4bf0bbea978ddf736363a12
</code></pre>

<p>Now that we have this hash digest, we can use it in a URL. Our<br />
example will be for www.example.com making a request for the<br />
file <code>/var/www/secured/index.html</code> through our /resources location.<br />
Our full URL will be the following:</p>
<pre><code>www.example.com/resources/a53bee08a4bf0bbea978ddf736363a12/\
index.html
</code></pre>

<p>16.3 Securing a Location with an <code>Expire Date</code></p>

<pre><code>location /resources {
    root /var/www;
    secure_link $arg_md5,$arg_expires;
    secure_link_md5 "$secure_link_expires$uri$remote_addr
    mySecret";
    if ($secure_link = "") { return 403; }
    if ($secure_link = "0") { return 410; }
}
</code></pre>

<p>secure_link directive æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¿å­˜md5å“ˆå¸Œçš„å˜é‡ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¿å­˜é“¾æ¥çš„åˆ°æœŸæ—¶é—´ï¼ˆUnix epoch time formatï¼‰</p>

<p>16.4 Generating an Expiring Link</p>

<p>åˆ›å»ºä¸€ä¸ªæ—¶é—´æˆ³ï¼ˆUnix epoch time formatï¼‰</p>

<pre><code class="language-bash">date -d "2020-12-31 00:00" +%s --utc
# 1609372800
</code></pre>

<p>Next youâ€™ll need to concatenate your hash string to match the string<br />
configured with the secure_link_md5 directive. In this case, our<br />
string to be used will be 1293771600/resources/<br />
index.html127.0.0.1 mySecret. The md5 hash is a bit different<br />
than just a hex digest. Itâ€™s an md5 hash in binary format, base64 encoâ€<br />
ded, with plus signs (+) translated to hyphens (-), slashes (/) transâ€<br />
lated to underscores (_), and equal (=) signs removed. The following<br />
is an example on a Unix system:</p>

<pre><code class="language-bash"> echo -n '1609372800/resources/index.html127.0.0.1 mySecret' \
| openssl md5 -binary \
| openssl base64 \
| tr +/ -_ \
| tr -d =
# TG6ck3OpAttQ1d7jW3JOcw
</code></pre>

<p>Now that we have our hash, we can use it as an argument along with<br />
the expire date:</p>

<p>/resources/index.html?md5=TG6ck3OpAttQ1d7jW3JOcw&amp;expires=1609372800â€™</p>

<pre><code class="language-py">
from datetime import datetime, timedelta
from base64 import b64encode
import hashlib
# Set environment vars
resource = b'/resources/index.html'
remote_addr = b'127.0.0.1'
host = b'www.example.com'
mysecret = b'mySecret'
# Generate expire timestamp
now = datetime.utcnow()
expire_dt = now + timedelta(hours=1)
expire_epoch = str.encode(expire_dt.strftime('%s'))
# md5 hash the string
uncoded = expire_epoch + resource + remote_addr + mysecret
md5hashed = hashlib.md5(uncoded).digest()
# Base64 encode and transform the string
b64 = b64encode(md5hashed)
unpadded_b64url = b64.replace(b'+', b'-')\
    .replace(b'/', b'_')\
    .replace(b'=', b'')
# Format and generate the link
linkformat = "{}{}?md5={}?expires={}"
securelink = linkformat.format(
    host.decode(),
    resource.decode(),
    unpadded_b64url.decode(),
    expire_epoch.decode()
)
print(securelink)

</code></pre>

<h2 id="ç¬¬äºŒåç« -practical-security-tips">ç¬¬äºŒåç«  Practical Security Tips</h2>

<p>20.1 HTTPS Redirects</p>

<p><code>Use a rewrite to send all HTTP traffic to HTTPS:</code></p>

<pre><code>server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;
    return 301 https://$host$request_uri;
}
</code></pre>

<p>20.2 Redirecting to HTTPS Where SSL/TLS Is Terminated Before NGINX</p>

<pre><code>server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;
    if ($http_x_forwarded_proto = 'http') {
        return 301 https://$host$request_uri;
    }
}
</code></pre>

<p>This configuration is very much like HTTPS redirects. However, in<br />
this configuration weâ€™re only redirecting <code>if the header X-Forwarded-Proto</code> is equal to HTTP.</p>

<p>20.3 HTTP Strict Transport Security</p>

<p>You need to instruct browsers to <code>never</code> send requests over HTTP</p>

<p>Use the HTTP Strict Transport Security (HSTS) enhancement by<br />
setting the Strict-Transport-Security header:</p>

<pre><code>add_header Strict-Transport-Security max-age=31536000;

</code></pre>

<p>This configuration sets the Strict-Transport-Security header to a<br />
max age of a year. This will instruct the browser to always do an<br />
internal redirect when HTTP requests are attempted to this domain,<br />
so that <code>all requests will be made over HTTPS</code>.</p>

<p>20.4 Satisfying Any Number of Security Methods</p>

<p>Use the satisfy directive</p>

<pre><code>location / {
    satisfy any;
    allow 192.168.1.0/24;
    deny all;
    auth_basic "closed site";
    auth_basic_user_file conf/htpasswd;
}
</code></pre>

<p>æœ¬æ–‡ï¼š <a href="https://github.com/icai/nginxcooking">https://github.com/icai/nginxcooking</a></p>

<p>-EOF-</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to properly uninstall Service Workerï¼Ÿ]]></title>
    <link href="http://blog.w3cub.com/blog/2018/06/01/how-to-properly-uninstall-service-worker/"/>
    <updated>2018-06-01T15:10:43+00:00</updated>
    <id>http://blog.w3cub.com/blog/2018/06/01/how-to-properly-uninstall-service-worker</id>
    <content type="html"><![CDATA[<p>å¦‚ä½•æ­£ç¡®åœ°å¸è½½Service Workerï¼Ÿ</p>

<p>ä»¥ä¸‹é“¾æ¥ï¼Œ Google Developers Service Workerå·¥ä½œåŸç†ï¼š<br />
https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#updates</p>

<p>ä½†æ˜¯å‡å¦‚æŸä¸€å¤©ä½ ç½‘ç«™ä¸éœ€è¦ Service Workerï¼Œå¦‚ä½•æ­£ç¡®åœ°å¸è½½å‘¢ï¼Ÿ</p>

<p>ä»¥ä¸‹ä»¥ create-react-app ä¸ºä¾‹å­:</p>

<!-- more -->

<ul>
  <li>åƒä¸‡ä¸è¦ç›´æ¥ä»æœåŠ¡å™¨å¹²æ‰ service-worker.js ï¼ˆsw.jsï¼‰ï¼Œæˆ–è€…å»æ‰ sw-precache-webpack-plugin æ’ä»¶ç›´æ¥buildã€‚</li>
</ul>

<ol>
  <li>å‡å¦‚ä½ æœåŠ¡å™¨æ˜¯å¢é‡æ›´æ–°çš„ï¼Œ<br />
<img src="https://user-images.githubusercontent.com/1061012/40846563-8b73ce96-65ec-11e8-8781-e374c38c77ba.png" alt="image" /></li>
</ol>

<p>é‚£ä¹ˆä½ çš„æœåŠ¡å™¨æ–‡ä»¶service-worker.jsæ°¸è¿œéƒ½åœ¨ï¼Œå‡å¦‚ç”¨æˆ·ä¹‹å‰è®¿é—®äº†ä½ çš„ç½‘ç«™ï¼Œå¹¶ä¸”ç”¨æˆ·ä¸æ¸…ç¼“å­˜çš„è¯ï¼Œcacheå°±æ°¸è¿œéƒ½åœ¨äº†ï¼Œä½ æ€ä¹ˆæ›´æ–°ï¼Œç”¨æˆ·è¿˜æ˜¯è®¿é—®æ—§çš„ç‰ˆæœ¬ã€‚</p>

<ol>
  <li>ä½ è¯´æŠŠä½ æœåŠ¡å™¨çš„ service-worker.js å¹²æ‰ï¼Œé‚£ä¹ˆå‡å¦‚ç”¨æˆ·ä¹‹å‰è®¿é—®è¿‡å‘¢ï¼Ÿæœ¬åœ°æœ‰ä¸€ä»½service-worker.jsï¼Œé‚£ä¹ˆæŒ‰ç…§service-workerå·¥ä½œåŸç†ï¼Œæœ¬åœ°ä¸€ç›´ç”Ÿæ•ˆï¼Œä¸ç®¡ä½ ç½‘ç«™æ€ä¹ˆæ›´æ–°ï¼Œç”¨æˆ·çœ‹åˆ°çš„ä¾æ—§æ˜¯æ—§çš„å†…å®¹ã€‚</li>
</ol>

<p>service-worker.js</p>

<pre><code class="language-js">
'use strict';

var precacheConfig = [
["/index.html","a16310808c31e9e89b8d72aa2ddb058c"],
["/plugin.dll.0cf858ac.js","7268282b6a4415b541c4658c1478febc"],
["/vendor.dll.830d2c27.js","097dfeec5dda4f277752cb36b5d548ee"]
];
var cacheName = 'sw-precache-v3-sw-precache-webpack-plugin-' + (self.registration ? self.registration.scope : '');


var ignoreUrlParametersMatching = [/^utm_/];



var addDirectoryIndex = function (originalUrl, index) {
    var url = new URL(originalUrl);
    if (url.pathname.slice(-1) === '/') {
      url.pathname += index;
    }
    return url.toString();
  };

var cleanResponse = function (originalResponse) {
    // If this is not a redirected response, then we don't have to do anything.
    if (!originalResponse.redirected) {
      return Promise.resolve(originalResponse);
    }

    // Firefox 50 and below doesn't support the Response.body stream, so we may
    // need to read the entire body to memory as a Blob.
    var bodyPromise = 'body' in originalResponse ?
      Promise.resolve(originalResponse.body) :
      originalResponse.blob();

    return bodyPromise.then(function(body) {
      // new Response() is happy when passed either a stream or a Blob.
      return new Response(body, {
        headers: originalResponse.headers,
        status: originalResponse.status,
        statusText: originalResponse.statusText
      });
    });
  };

var createCacheKey = function (originalUrl, paramName, paramValue,
                           dontCacheBustUrlsMatching) {
    // Create a new URL object to avoid modifying originalUrl.
    var url = new URL(originalUrl);

    // If dontCacheBustUrlsMatching is not set, or if we don't have a match,
    // then add in the extra cache-busting URL parameter.
    if (!dontCacheBustUrlsMatching ||
        !(url.pathname.match(dontCacheBustUrlsMatching))) {
      url.search += (url.search ? '&amp;' : '') +
        encodeURIComponent(paramName) + '=' + encodeURIComponent(paramValue);
    }

    return url.toString();
  };

var isPathWhitelisted = function (whitelist, absoluteUrlString) {
    // If the whitelist is empty, then consider all URLs to be whitelisted.
    if (whitelist.length === 0) {
      return true;
    }

    // Otherwise compare each path regex to the path of the URL passed in.
    var path = (new URL(absoluteUrlString)).pathname;
    return whitelist.some(function(whitelistedPathRegex) {
      return path.match(whitelistedPathRegex);
    });
  };

var stripIgnoredUrlParameters = function (originalUrl,
    ignoreUrlParametersMatching) {
    var url = new URL(originalUrl);
    // Remove the hash; see https://github.com/GoogleChrome/sw-precache/issues/290
    url.hash = '';

    url.search = url.search.slice(1) // Exclude initial '?'
      .split('&amp;') // Split into an array of 'key=value' strings
      .map(function(kv) {
        return kv.split('='); // Split each 'key=value' string into a [key, value] array
      })
      .filter(function(kv) {
        return ignoreUrlParametersMatching.every(function(ignoredRegex) {
          return !ignoredRegex.test(kv[0]); // Return true iff the key doesn't match any of the regexes.
        });
      })
      .map(function(kv) {
        return kv.join('='); // Join each [key, value] array into a 'key=value' string
      })
      .join('&amp;'); // Join the array of 'key=value' strings into a string with '&amp;' in between each

    return url.toString();
  };


var hashParamName = '_sw-precache';
var urlsToCacheKeys = new Map(
  precacheConfig.map(function(item) {
    var relativeUrl = item[0];
    var hash = item[1];
    var absoluteUrl = new URL(relativeUrl, self.location);
    var cacheKey = createCacheKey(absoluteUrl, hashParamName, hash, /\.\w{8}\./);
    return [absoluteUrl.toString(), cacheKey];
  })
);

function setOfCachedUrls(cache) {
  return cache.keys().then(function(requests) {
    return requests.map(function(request) {
      return request.url;
    });
  }).then(function(urls) {
    return new Set(urls);
  });
}

self.addEventListener('install', function(event) {
  event.waitUntil(
    caches.open(cacheName).then(function(cache) {
      return setOfCachedUrls(cache).then(function(cachedUrls) {
        return Promise.all(
          Array.from(urlsToCacheKeys.values()).map(function(cacheKey) {
            // If we don't have a key matching url in the cache already, add it.
            if (!cachedUrls.has(cacheKey)) {
              var request = new Request(cacheKey, {credentials: 'same-origin'});
              return fetch(request).then(function(response) {
                // Bail out of installation unless we get back a 200 OK for
                // every request.
                if (!response.ok) {
                  throw new Error('Request for ' + cacheKey + ' returned a ' +
                    'response with status ' + response.status);
                }

                return cleanResponse(response).then(function(responseToCache) {
                  return cache.put(cacheKey, responseToCache);
                });
              });
            }
          })
        );
      });
    }).then(function() {
      
      // Force the SW to transition from installing -&gt; active state
      return self.skipWaiting();
      
    })
  );
});

self.addEventListener('activate', function(event) {
  var setOfExpectedUrls = new Set(urlsToCacheKeys.values());

  event.waitUntil(
    caches.open(cacheName).then(function(cache) {
      return cache.keys().then(function(existingRequests) {
        return Promise.all(
          existingRequests.map(function(existingRequest) {
            if (!setOfExpectedUrls.has(existingRequest.url)) {
              return cache.delete(existingRequest);
            }
          })
        );
      });
    }).then(function() {
      
      return self.clients.claim();
      
    })
  );
});


self.addEventListener('fetch', function(event) {
  if (event.request.method === 'GET') {
    // Should we call event.respondWith() inside this fetch event handler?
    // This needs to be determined synchronously, which will give other fetch
    // handlers a chance to handle the request if need be.
    var shouldRespond;

    // First, remove all the ignored parameters and hash fragment, and see if we
    // have that URL in our cache. If so, great! shouldRespond will be true.
    var url = stripIgnoredUrlParameters(event.request.url, ignoreUrlParametersMatching);
    shouldRespond = urlsToCacheKeys.has(url);

    // If shouldRespond is false, check again, this time with 'index.html'
    // (or whatever the directoryIndex option is set to) at the end.
    var directoryIndex = 'index.html';
    if (!shouldRespond &amp;&amp; directoryIndex) {
      url = addDirectoryIndex(url, directoryIndex);
      shouldRespond = urlsToCacheKeys.has(url);
    }

    // If shouldRespond is still false, check to see if this is a navigation
    // request, and if so, whether the URL matches navigateFallbackWhitelist.
    var navigateFallback = '/index.html';
    if (!shouldRespond &amp;&amp;
        navigateFallback &amp;&amp;
        (event.request.mode === 'navigate') &amp;&amp;
        isPathWhitelisted(["^(?!\\/__).*"], event.request.url)) {
      url = new URL(navigateFallback, self.location).toString();
      shouldRespond = urlsToCacheKeys.has(url);
    }

    // If shouldRespond was set to true at any point, then call
    // event.respondWith(), using the appropriate cache key.
    if (shouldRespond) {
      event.respondWith(
        caches.open(cacheName).then(function(cache) {
          return cache.match(urlsToCacheKeys.get(url)).then(function(response) {
            if (response) {
              return response;
            }
            throw Error('The cached response that was expected is missing.');
          });
        }).catch(function(e) {
          // Fall back to just fetch()ing the request if some unexpected error
          // prevented the cached response from being valid.
          console.warn('Couldn\'t serve response for "%s" from cache: %O', event.request.url, e);
          return fetch(event.request);
        })
      );
    }
  }
});

</code></pre>

<p>index.js å…¥å£æ–‡ä»¶</p>

<p>https://github.com/facebook/create-react-app/blob/next/packages/react-scripts/template/src/index.js</p>

<pre><code class="language-js">import React from 'react';
import ReactDOM from 'react-dom';
import './index.css';
import App from './App';
import * as serviceWorker from './serviceWorker';

ReactDOM.render(&lt;App /&gt;, document.getElementById('root'));

// If you want your app to work offline and load faster, you can change
// unregister() to register() below. Note this comes with some pitfalls.
// Learn more about service workers: http://bit.ly/CRA-PWA
serviceWorker.unregister();
//----vs-----
serviceWorker.register({
    onUpdate: async (registration) =&gt; {
        await registration.update();
        message.info("ç½‘ç«™æ›´æ–°å®Œæˆ, è¯·åˆ·æ–°é¡µé¢: " + moment().format('YYYY-MM-DD HH:mm:ss'), 0.5, () =&gt; {
            window.location.reload();
        });
    },
    onSuccess: () =&gt; {}
});



</code></pre>

<p>å‡å¦‚ä½ å¼•å…¥äº†serviceWorkeræ–‡ä»¶, å¹¶å‘å¸ƒäº†ï¼Œ</p>

<p>https://github.com/facebook/create-react-app/blob/next/packages/react-scripts/template/src/serviceWorker.js</p>

<h3 id="æ­£ç¡®åšæ³•æ˜¯">æ­£ç¡®åšæ³•æ˜¯ï¼š</h3>
<p><code>serviceWorker.register();</code> æ”¹æˆ <code>serviceWorker.unregister();</code> <br />
ä½†æ˜¯åŒæ—¶åƒä¸‡è¦è®°ä½ è¦ä¿ç•™  sw-precache-webpack-plugin å»åšwebpack æ„å»ºï¼ˆç›®çš„æ˜¯ä¸ºäº†ç”Ÿæˆæ–°çš„service-worker.jsï¼Œè§¦å‘æ›´æ–°)ã€‚æŒ‰ç…§äººçš„<strong>æ—¢å®šæ€ç»´</strong>ï¼Œæ—¢ç„¶ä¸è¦äº†ï¼Œé‚£ä¹ˆå½“ç„¶è¦ç§»é™¤ã€‚</p>

<p>å‡å¦‚ç§»é™¤äº†  sw-precache-webpack-plugin,  ä½ æ€ä¹ˆ ç”Ÿæˆæ–°ç‰ˆæœ¬çš„ service-worker.jsï¼Œè¿˜æœ‰ï¼Œæ²¡æœ‰æ–°ç‰ˆæœ¬ service-worker.js åˆæ€ä¹ˆä¼šæ›´æ–°ä½ çš„ä»£ç äº†ï¼Œè¿™é‡Œä¼¼ä¹å‡ºç°<strong>åŒé‡é™·é˜±</strong>ï¼Œä½†æ˜¯å½“ä½ ç†è§£äº†service-worker.js ç”Ÿå‘½å‘¨æœŸåŸç†åï¼Œä¸€åˆ‡éƒ½å¯ä»¥ç†è§£ã€‚</p>

<h3 id="æœ€åæ€»ç»“">æœ€åæ€»ç»“ï¼š</h3>
<p>åœ¨å…¥å£åŠ å…¥:</p>

<p>serviceWorker.unregister();</p>

<p>service-worker.js æ–‡ä»¶ ä¾æ—§éœ€è¦æ›´æ–°ã€‚</p>

<p>å‡å¦‚çœŸçš„ä¸æƒ³å¼•å…¥ sw-precache-webpack-plugin åšwebpackæ„å»ºçš„è¯ï¼Œè¯·æŠŠæœåŠ¡å™¨ä¸Šé¢çš„<br />
service-worker.js  <code>precacheConfig</code> æ¸…ç©º</p>
<pre><code class="language-js">var precacheConfig = [
];
</code></pre>

<p>https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#opting-out-of-caching</p>

<p>If you would prefer not to enable service workers prior to your initial production deployment, then remove the call to registerServiceWorker() from src/index.js.</p>

<p>If you had previously enabled service workers in your production deployment and have decided that you would like to disable them for all your existing users, you can swap out the call to registerServiceWorker() in src/index.js first by modifying the service worker import:</p>
<pre><code>import { unregister } from './registerServiceWorker';
</code></pre>

<p>and then call unregister() instead. After the user visits a page that has unregister(), the service worker will be uninstalled. Note that depending on how /service-worker.js is served, it may take up to 24 hours for the cache to be invalidated.</p>

<p>create-react-app æç¤ºçš„æµ‹è¯•æœåŠ¡å™¨<br />
<img src="https://user-images.githubusercontent.com/1061012/40872668-b5ae9a72-6684-11e8-9d37-ba7d3fed427e.png" alt="image" /><br />
å¯¹service-worker.jsä¼šæœ‰HTTPç¼“å­˜ï¼Œéƒ¨ç½²ç®€å•nginx æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•</p>

<pre><code class="language-conf">    server {
       listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

       location / {
           root   D:\yourproject\build;
           index  index.html index.htm;
           # proxy_no_cache 1;
           add_header Cache-Control "no-cache";
           try_files $uri $uri/ /index.html;
       }

       location /service\-worker\.js {
            expires -1;
            add_header Pragma "no-cache";
       }
    }

</code></pre>

<pre><code>serviceWorker.register({
    onUpdate: async (registration) =&gt; {
        await registration.update(); // è¿™é‡Œå¾ˆé‡è¦
        message.info("ç½‘ç«™æ›´æ–°å®Œæˆ, è¯·åˆ·æ–°é¡µé¢: " + moment().format('YYYY-MM-DD HH:mm:ss'), 0.5, () =&gt; {
            window.location.reload();
        });
    },
    onSuccess: () =&gt; {}
});

</code></pre>

<h3 id="å»¶ä¼¸é˜…è¯»">å»¶ä¼¸é˜…è¯»ï¼š</h3>

<p>https://lavas.baidu.com/guide/v2/advanced/service-worker#%E6%B3%A8%E5%86%8C-service-worker-%E6%89%A9%E5%B1%95<br />
æ³¨å†Œ Service Worker (æ‰©å±•)</p>

<p>æç¤ºï¼šè¿™éƒ¨åˆ†å†…å®¹ç”± Lavas å†…éƒ¨å¤„ç†ï¼Œå¹¶ä¸éœ€è¦å¼€å‘è€…è¿›è¡Œå‚ä¸ï¼Œä»…ä»…ä½œä¸ºè§£ç­”å¼€å‘è€…ç–‘é—®çš„æ‰©å±•é˜…è¯»å­˜åœ¨ã€‚</p>

<p>Service Worker ç¼–å†™å®Œæˆåï¼Œè¿˜éœ€è¦è¿›è¡Œæ³¨å†Œæ‰èƒ½çœŸæ­£ç”Ÿæ•ˆã€‚å¸¸è§„çš„æ³¨å†Œä»£ç èƒ½å¤Ÿåœ¨å„ç±» Service Worker æ•™ç¨‹æˆ–æ–‡ç« ä¸­æ‰¾åˆ°ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªä¸å¾—ä¸è€ƒè™‘çš„é—®é¢˜ï¼Œä½¿å¾—æˆ‘ä»¬å¿…é¡»å¯¹æ³¨å†Œä»£ç è¿›è¡Œä¸€äº›æ”¹åŠ¨ï¼Œé‚£å°±æ˜¯ Service Worker æ›´æ–° çš„é—®é¢˜ã€‚</p>

<p>https://github.com/lavas-project/sw-register-webpack-plugin</p>

<p>ç¦»çº¿æŒ‡å—<br />
https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-falling-back-to-network</p>

<p>å‡å¦‚ç†Ÿæ‚‰Service Worker ç¼“å­˜æœºåˆ¶çš„è¯ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦å¸è½½å‘¢ ï¼Ÿ</p>

<p>æœ¬æ–‡ ï¼š https://github.com/icai/icai.github.io/issues/1</p>

<p>-EOF-</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ã€Šhtml5æ•°æ®æ¨é€åº”ç”¨å¼€å‘ã€‹è¯»ä¹¦æ‘˜è¦]]></title>
    <link href="http://blog.w3cub.com/blog/2017/08/06/sse-data-push-note/"/>
    <updated>2017-08-06T09:18:14+00:00</updated>
    <id>http://blog.w3cub.com/blog/2017/08/06/sse-data-push-note</id>
    <content type="html"><![CDATA[<p>ä¹¦å¾ˆè–„ï¼Œåœ¨å›¾ä¹¦é¦†ç„äº†ä¸€ä¸‹ï¼ŒçŸ¥è¯†ç‚¹ä¸å¤šã€‚<br />
åŸºæœ¬ä¸Šç¬¬äºŒç« åŸºæœ¬è®²å®Œï¼Œå…¶ä»–è®²è§£éƒ½æ˜¯ä¸€äº›æ“¦è¾¹çš„ï¼Œå…¼å®¹æ€§ï¼Œå®‰å…¨æ€§ï¼Œâ€¦â€¦<br />
å¯ä»¥æ€»ç»“ä¸ºå¦‚ä¸‹ï¼š</p>

<!-- more -->

<p>ã€ŠData Push Apps with HTML5 SSEã€‹ è¯»ä¹¦æ‘˜è¦</p>

<h2 id="æ‘˜è¦">æ‘˜è¦</h2>

<ul>
  <li>EventSourceæ–¹æ³• new EventSource(â€œurlâ€);</li>
  <li>MIMEç±»å‹text/event-stream</li>
  <li>æ•°æ®ä¼ è¾“æ ¼å¼â€data:â€ + new Date().toISOString() + â€œ\n\nâ€;</li>
</ul>

<h2 id="sseç¤ºä¾‹">SSEç¤ºä¾‹</h2>

<pre><code class="language-html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Basic SSE Example&lt;/title&gt;
&lt;script src="//code.jquery.com/jquery-1.11.0.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;pre id="x"&gt;Initializing...&lt;/pre&gt;
&lt;script&gt;
    var es = new EventSource("basic_sse.php");
    es.addEventListener("message", function(e){
        $("#x").append("\n" + e.data);
    },false);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<pre><code class="language-javascript">var http = require("http"),
    fs = require("fs");
var port = parseInt(process.argv[2] || 1234);
http.createServer(function(request, response) {
    console.log("Client connected:" + request.url);
    if (request.url != "/sse") {
        fs.readFile("basic_sse.html", function(err, file) {
            response.writeHead(200, { 'Content-Type': 'text/html' });
            var s = file.toString(); //file is a buffer
            s = s.replace("basic_sse.php", "sse");
            response.end(s);
        });
        return;
    }
    //Below is to handle SSE request. It never returns.
    response.writeHead(200, { "Content-Type": "text/event-stream" });
    var timer = setInterval(function() {
        var content = "data:" + new Date().toISOString() + "\n\n";
        var b = response.write(content);
        if (!b) console.log("Data got queued in memory (content=" + content + ")");
        else console.log("Flushed! (content=" + content + ")");
    }, 1000);
    request.connection.on("close", function() {
        response.end();
        clearInterval(timer);
        console.log("Client closed connection. Aborting.");
    });
}).listen(port);
console.log("Server running at http://localhost:" + port);
</code></pre>

<h2 id="å…¼å®¹æ€§">å…¼å®¹æ€§</h2>

<p>startEventSource()</p>

<ul>
  <li>Basically all Firefox and Chromea</li>
  <li>Desktop Safari 5.0+</li>
  <li>iOS Safari 4.0+</li>
  <li>Android 4.4+ (earlier where Chrome is default browser)</li>
  <li>Chrome for Android (all versions)</li>
  <li>Firefox for Android (all versions)</li>
  <li>Opera since 11.0</li>
  <li>Opera Mobile since 11.1</li>
  <li>BlackBerry since 7.0</li>
</ul>

<p>startXHR()</p>

<ul>
  <li>IE10+</li>
  <li>Firefox 3.6 (and earlier)</li>
  <li>Safari 3.x</li>
  <li>Android 4.1 to 4.3 (unless Chrome is default browser)</li>
  <li>Android 3.x</li>
</ul>

<p>startIframe()</p>

<ul>
  <li>IE8</li>
  <li>IE9</li>
</ul>

<p>~~startLongpoll()</p>
<ul>
  <li>IE6</li>
  <li>IE7</li>
  <li>Android 2.x</li>
  <li>Anything else not in the preceding list that has Ajax support<br />
~~</li>
</ul>

<p>~~(none)</p>
<ul>
  <li>Any browser with JavaScript disabled<br />
~~</li>
</ul>

<p>~~a Technically since Firefox 6 and Chrome 6, but they have been auto-updating since Firefox 4, and Chrome since it came out<br />
of beta, so you can reasonably expect no one is still using versions that do not support SSE.<br />
~~</p>

<p>ä¹¦æœ¬ä»£ç ï¼Œä¹¦æœ¬ä»£ç ï¼Œä¹¦æœ¬ä»£ç ã€‚</p>

<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>

<ul>
  <li><a href="https://github.com/DarrenCook/ssebook">ä¹¦æœ¬ä»£ç </a></li>
  <li><a href="https://caniuse.com/#feat=eventsource">eventsourceæµè§ˆå™¨æ”¯æŒ</a></li>
  <li><a href="https://www.w3.org/TR/eventsource/">https://www.w3.org/TR/eventsource/</a></li>
  <li><a href="https://html.spec.whatwg.org/multipage/server-sent-events.html">HTML Living Standard: Server-sent events</a></li>
  <li><a href="https://github.com/Yaffle/EventSource">a polyfill for http://www.w3.org/TR/eventsource/</a></li>
</ul>

<h2 id="å…¶ä»–å‚è€ƒ">å…¶ä»–å‚è€ƒ</h2>

<ul>
  <li><a href="https://www.ibm.com/developerworks/library/wa-http-server-push-with-websocket-sse/">HTTP server push with WebSocket and SSE</a></li>
  <li><a href="https://www.zhihu.com/question/27498235">Ajaxé•¿è½®è¯¢ä¸æœåŠ¡å™¨æ¨çš„é•¿è¿æ¥çš„åŒºåˆ«æ˜¯ï¼Ÿ</a></li>
  <li><a href="http://goeasy.io/cn/demos">å•†ä¸šåŒ–ç¤ºä¾‹</a></li>
</ul>

<p>-EOF-</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ¯æ—¥ä¸€ç‚¹ç‚¹ä¹‹scrapy]]></title>
    <link href="http://blog.w3cub.com/blog/2017/06/20/today-you-should-know-scrapy/"/>
    <updated>2017-06-20T15:19:58+00:00</updated>
    <id>http://blog.w3cub.com/blog/2017/06/20/today-you-should-know-scrapy</id>
    <content type="html"><![CDATA[<p>Scrapy æ˜¯ä»€ä¹ˆï¼Ÿ</p>

<p>Scrapyæ˜¯ä¸€ä¸ªåŸºäºPythonçš„é«˜çº§çˆ¬è™«æ¡†æ¶ï¼Œåªéœ€è¦ç®€å•çš„é…ç½®å°±å¯ä»¥å®ç°ä½ å¤§å¤§çš„éœ€æ±‚ã€‚</p>

<p>ä¸ºä»€ä¹ˆè¦ä»‹ç»Scrapyï¼Œå†…å®¹æ—¶ä»£äº†ï¼Œæ²¡æœ‰å†…å®¹å†å¥½çœ‹çš„ç½‘ç«™ï¼Œé‚£åˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p>

<!-- more -->

<p>å¯¹ä¸å¯¹ï¼Ÿå¯¹å¯¹å¯¹ã€‚</p>

<p>å­¦ä¹ scrapyæœ‰ä»€ä¹ˆéœ€æ±‚å—ï¼Ÿ</p>

<p>pythonæ˜¯åŸºäºpythonè¯­è¨€çš„ï¼Œé‚£ä¹ˆè‡ªç„¶ä½ è¦æ‡‚ä¸€äº›pythonçš„åŸºç¡€å•¦ï¼</p>

<p>è¿˜æœ‰ç®€å•çš„xpathè¯­æ³•æˆ–ç±»ä¼¼äºjQueryé€‰æ‹©å™¨è¯­æ³•ï¼Œä¸€è¾¹ç”¨ä¸€è¾¹å­¦ä¹Ÿå¯ä»¥çš„ã€‚</p>

<p>å»ºè®®åœ¨Linuxæˆ–è€…Macä¸‹è¿›è¡Œå­¦ä¹ ï¼ŒWindowsä¸‹å¯èƒ½ä¼šé‡åˆ°å„ç§å…¥é—¨çº§çš„é—®é¢˜ã€‚ä¾‹å¦‚å®‰è£…è¿‡ç¨‹ä¸­æŠ¥é”™ï¼Œç¼ºå°‘è¿™ä¸ªï¼Œé‚£ä¸ªçš„é—®é¢˜ã€‚</p>

<p>åªéœ€è¦å‡†å¤‡ä¸€æ ·ä¸œè¥¿ï¼Œå°±æ˜¯å®˜æ–¹æ–‡æ¡£ https://docs.scrapy.org/en/latest/</p>

<p>å¯ä»¥ä¸€è¾¹çœ‹ï¼Œä¸€è¾¹å®è·µã€‚</p>

<h3 id="å®‰è£…">å®‰è£…</h3>

<pre><code class="language-bash">pip install Scrapy

</code></pre>

<p>å®˜æ–¹æ¨èä½ å®‰è£…pythonè™šæ‹Ÿç¯å¢ƒè¿›è¡Œ Scrapyï¼Œä¸è£…ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼ è™šæ‹Ÿç¯å¢ƒä¼šè™šæ‹ŸIPä¹ˆï¼Ÿ ä¸ä¼šï¼Œä¸æ˜¯è¿™ä¸€å›äº‹</p>

<pre><code class="language-bash">pip install virtualenv

</code></pre>

<p>æ¥ç€æ¥æ¥è¯»ä¸€ä¸‹å®˜æ–¹æ•™ç¨‹ï¼š</p>

<p>https://docs.scrapy.org/en/latest/intro/tutorial.html</p>

<pre><code class="language-bash">scrapy startproject é¡¹ç›®åå­—

</code></pre>

<p>A: å‡å¦‚ä½ æƒ³çŸ¥é“parseæ¥ç€ä¼šå¹²ä»€ä¹ˆï¼Œparseé‡Œé¢èƒ½å¹²ä»€ä¹ˆï¼Œæˆ‘è§‰å¾—ä½ å»äº†è§£ä¸€ä¸‹Scrapyçš„é’©å­å‡½æ•°ï¼Œä»¥åŠæ•´ä½“æ¶æ„ã€‚</p>

<p>B: å‡å¦‚ä½ å¯¹yieldè¯­æ³•ä¸æ˜¯å¾ˆäº†è§£çš„ï¼Œå¯ä»¥å»ç†è§£ä¸€ä¸‹yieldè¯­æ³•ï¼ˆpythonåŸºç¡€ï¼‰ã€‚</p>

<p>å…¥é—¨æ˜¯å¾ˆå¿«çš„ã€‚</p>

<p>å‡å¦‚ä½ æ„Ÿå…´è¶£ï¼Œæ¥ç€ä½ å¯èƒ½ä¼šæå‡ºä¸€äº›é—®é¢˜ï¼š</p>

<p>æ¯”å¦‚ï¼Œæ€ä¹ˆåœ¨ä¸€ä¸ªé¡µé¢æŠ“å–å¤šæ¡ï¼Ÿæ€ä¹ˆå»é‡ï¼Ÿç­‰ç­‰</p>

<p>ä¸ºä»€ä¹ˆä¼šä»‹ç»Scrapyï¼Ÿ</p>

<p>å…¶å®Scrapyä¸å•åªæ˜¯ä¸€ä¸ªçˆ¬è™«æ¡†æ¶ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„Pythonå…¥é—¨å­¦ä¹ é¡¹ç›®ï¼Œå‡è®¾ä½ æ€ä¹ˆä¼šPythonã€‚</p>

<p>-EOF-</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä½ å¥½2017]]></title>
    <link href="http://blog.w3cub.com/blog/2017/01/02/hello-2017/"/>
    <updated>2017-01-02T08:27:08+00:00</updated>
    <id>http://blog.w3cub.com/blog/2017/01/02/hello-2017</id>
    <content type="html"><![CDATA[<p>2017å¹´ï¼Œèµ·åºŠçš„ç¬¬ä¸€å¤©ï¼Œæœ‹å‹åœˆé‡Œé¢çš„éƒ½æ˜¯å›°éš¾ç¾¤ä¼—ã€‚è°¢è°¢ä¸»å¸­å…³å¿ƒçš„è°ƒä¾ƒã€‚</p>

<p>2016çš„è®¡åˆ’å®Œæˆäº†å¤šå°‘ï¼Œå°ç›®æ ‡è¿˜æ˜¯æœ‰çš„ï¼Œå¤©é©¬è¡Œç©ºçš„å°±åˆ«è°ˆäº†ã€‚è¯¥å†™çš„å†™äº†ï¼Œå¤´è„‘å‘çƒ­èƒ½æŠ˜è…¾åˆ°2,3ç‚¹ã€‚</p>

<!-- more -->

<p>2016çœ‹äº†å¾ˆå¤šç”µè§†ï¼Œçœ‹äº†å¾ˆå¤šæ—¶æ”¿æ–°é—»ï¼ŒæŠŠå°æ¹¾å¤§é€‰å…¨ç¨‹ç›´æ’­éƒ½çœ‹äº†ï¼Œä½ æ‡‚çš„ã€‚</p>

<p>2016å¹´åº•ç¦»å¼€äº†å·¥ä½œä¸‰å¹´çš„<a href="https://www.thecn.com/aboutus">TheCN</a>ï¼ˆCourseNetworkingï¼‰ï¼Œç»“æŸäº†â€Changing the Way the World Learnsâ€ï¼Œä¹Ÿæ˜¯æˆ‘å·¥ä½œäº”å¹´é‡Œé¢æœ€é•¿çš„ä¸€ä»½å·¥ä½œã€‚æ²¡äº‹å‘¨äº”å°±æºœå›å®¶ï¼Œå¯èƒ½è¿™ä¹Ÿæ˜¯åœ¨TheCNå·¥ä½œçš„ç‰¹æ®Šè®°å¿†ã€‚   <br />
2016å¹´æ²¡æœ‰è¿‡å¤šçš„ç•™å¿µä¸æ€€å¿µï¼Œå‚åŠ äº†å‡ åœºå©šç¤¼ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸­å­¦åŒå­¦ã€‚<br />
ç¿»å¼€å¾®åšï¼Œçœ‹ä¸€çœ‹2016çš„è‡ªå·±éƒ½å¹²äº†ä»€ä¹ˆï¼Œéƒ½æ˜¯éƒ½æ˜¯æ—¶äº‹ä¹‹ç±»çš„è§‚ç‚¹ï¼Œå¾®åšå¹¶æ²¡æœ‰è¿‡å¤šçš„ç§éšä¸œè¥¿ï¼Œå†ç¿»å¼€QQç©ºé—´ä¹Ÿæ²¡æœ‰è®°å½•å¤ªå¤šç‰¹åˆ«çš„ï¼Œå¹³æ·¡çš„2016ï¼Œè¿˜æ˜¯å‘ç”Ÿäº†ä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…ï¼Œæˆ‘æ²¡æœ‰è®°å½•ã€‚å›å»å‚åŠ åŒå­¦åŒå­¦çš„å©šç¤¼ï¼ŒåŒå­¦è¯´ï¼Œæ€ä¹ˆä½ è¿˜æ˜¯è·Ÿä»¥å‰ä¸€æ¨¡ä¸€æ ·ï¼Œå¥½åƒä¸€ç‚¹éƒ½æ²¡æœ‰å˜åŒ–ã€‚å¥½åƒä¹Ÿæ˜¯ï¼Œé™¤äº†ç˜¦äº†å‡ æ–¤ï¼Œå¥½åƒçœŸçš„æ²¡æœ‰å¤šå¤§å˜åŒ–ã€‚<br />
å†ç¿»çœ‹Githubçœ‹çœ‹ï¼Œ2013å°±æƒ³å†™çš„chromeæ’ä»¶ï¼Œç»ˆäºåœ¨2016å†™äº†ï¼Œè¿˜æœ‰ä¸€å †åŸºäºå…¬å¸éœ€æ±‚çš„å¼€æºæ‰©å±•ã€‚</p>

<p>å›æƒ³èµ·ï¼Œè¿™äº›å¹´ä»äº‹å‰ç«¯å·¥ä½œï¼Œå¤´ä¸€ä¸¤å¹´ï¼Œé‚£äº›äººè¿˜åœ¨ç‚«è€€IE6,IE7 bugï¼Œæœ¬è´¨ä¸Šæ˜¯æ¸…é›¶äº†ã€‚å‰©ä¸‹çš„ç»éªŒéƒ½æ˜¯è‡ªå·±å¹³æ—¶é˜…è¯»å¼€æºä»£ç ç§¯ç´¯çš„ã€‚kissy, ueditor, jQuery, Backbone, underscore, requriejsâ€¦â€¦ æ„Ÿè°¢è¿™äº›ä¼˜ç§€çš„å¼€æºä»£ç ã€‚</p>

<p>å½“åˆ«äººé—®Angularï¼Œreactï¼Œvueï¼Œgulpï¼Œ webpackâ€¦â€¦ ä½ æ‡‚ä¹ˆçš„æ—¶å€™ï¼Œè¿˜å¥½æˆ‘è¿˜æ²¡æœ‰æ‰é˜Ÿã€‚ ä¼šç‚¹å§ã€‚</p>

<p>2016åç«¯è¯­è¨€å†™çš„æ€ä¹ˆæ ·äº†ï¼Œæœ‰ç”¨çš„éƒ½å­¦äº†ï¼Œéƒ½æ˜¯ä¸€è¾¹åšä¸€è¾¹å­¦ã€‚rubyï¼Œpython, php â€¦â€¦ ç”¨è®°å¾—ï¼Œä¸ç”¨å°±å¿˜è®° â€¦â€¦</p>

<p>æˆ–è®¸è¿™æ˜¯ä»Šå¹´çš„ç›®æ ‡ï¼Œâ€œä»Šå¹´è¦ä¸è¦å»æ‹¿ä¸ªè½¯ä»¶ä¸“åˆ©è‘—ä½œæƒï¼Œ2017â€ï¼Œè¯´ç™½å°±æ˜¯ç»™è‡ªå·±ä¸€ä¸ªå­¦ä¹ çš„å‚¬åŒ–å‰‚ã€‚<br />
ä¸çŸ¥é“èƒ½ä¸èƒ½å®Œæˆï¼Œä½†æ˜¯å½“å¼€å§‹äº†ï¼Œå°±æ„å‘³ç€æ”¶è·ã€‚ä¸å…¶è¯´æ˜¯2017å¹´çš„ç›®æ ‡ï¼Œä¸å¦‚è¯´æ˜¯æ²¡æœ‰å®Œæˆè®¡åˆ’ã€‚</p>

<p>2016å¥½åƒå†™åšå®¢çš„æ¬¡æ•°è¶Šæ¥è¶Šå°‘äº†ï¼ŒGreaderé˜…è¯»ä¹ æƒ¯ä¹Ÿå°‘äº†, åè€Œå°è±¡ç¬”è®°çš„æ”¶è—å¤šäº†ã€‚</p>

<p>2016è¿‡äº†ï¼Œ ä¸€ç›´æƒ³å»æ—…æ¸¸ï¼Œå¯æƒœç¼ºå°‘æ¸¸ä¼´ã€‚è¾èŒçš„æ—¶å€™ï¼ŒåŒäº‹è¯´ï¼Œå»ä¸ªæ—…æ¸¸å…ˆå§ã€‚æˆ‘ä¹Ÿæƒ³ï¼Œå»å“ªé‡Œå¥½å‘¢ï¼Œæƒ³ä¸åˆ°ï¼Œæ²¡æœ‰æ¸¸ä¼´ã€‚</p>

<p>2016,2017èƒ½ä¸ºä½ åšçš„ä»€ä¹ˆå‘¢ï¼æ€¥ä¸äº†â€¦â€¦ æ¯æ¬¡éƒ½æƒ³å‹¤ç‚¹å†™blogï¼Œå¯æƒœæ€»ä¸èƒ½åšæŒï¼Œä¸€æ˜¯æƒ³ä¸åˆ°æƒ³å†™çš„å†…å®¹ï¼ŒäºŒæˆ–è®¸ä¸èƒ½å‡ºå£æˆæ–‡ï¼Œæ–‡ç¬”ç©ºæ´ï¼Œæ”¾å¼ƒäº†ã€‚</p>

<p>å›åˆ°å®¶é‡Œçœ‹è§é‚£æœ¬ã€Šç½‘é¡µè®¾è®¡ä¸‰å‰‘å®¢8ã€‹ï¼Œè¿˜æœ‰é‚£ä¸€ç®±é«˜é«˜çš„ç”µè„‘çˆ±å¥½è€…ï¼Œè¿˜æœ‰é‚£äº›å¹´å¤©å¤©æŠ˜è…¾Ghostçš„æ—¥å­ï¼Œè¿™äº›å¹´èµ°æ¥ï¼ŒçœŸçš„ä¸å®¹æ˜“ã€‚ä»¥å‰åŒäº‹è¯´ï¼Œè¿™å°±å«åšé’æ˜¥ã€‚</p>

<p>å¯èƒ½å§ï¼Œå¯èƒ½è¿™äº›å«é’æ˜¥ã€‚</p>

<p>2017ç»™è‡ªå·±çš„ç”Ÿæ´»ä½œæ¯å®šä¸ªç›®æ ‡å§ï¼ŒåŒå­¦è¯´éƒ½æˆ‘ç˜¦äº†ï¼Œå¯èƒ½ä½œæ¯ä¸è§„å¾‹å§ã€‚è¿™å‡ å¹´çœ‹è§äº†ç¦»åˆ«çš„ç¦»åˆ«ï¼Œä½é™¢çš„ä½é™¢ã€‚</p>

<p>ç»™è‡ªå·±ç”Ÿæ´»ä¸€ä¸ªå°ç›®æ ‡å§ï¼šå®šæœŸé¥®é£Ÿï¼Œå¢è‚¥ï¼Œå®šæœŸè¿åŠ¨ï¼Œå®šæ—¶ç¡çœ ã€‚</p>

<p>ä¸çŸ¥ä¸è§‰ï¼ŒçœŸæ­£å·¥ä½œå·²ç»æ­¥å…¥äº†ç¬¬å…­ä¸ªå¹´å¤´äº†ã€‚</p>

<p>2017ç»§ç»­æ‹¥æŠ±å˜åŒ–ï¼Œæ‹¥æŠ±ç”Ÿæ´»å§ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¤šå½©çŸ¥ä¹å‘å¸ƒå•¦]]></title>
    <link href="http://blog.w3cub.com/blog/2016/07/25/cozhihu-release/"/>
    <updated>2016-07-25T14:10:46+00:00</updated>
    <id>http://blog.w3cub.com/blog/2016/07/25/cozhihu-release</id>
    <content type="html"><![CDATA[<p>cozhihu(å¤šå½©çŸ¥ä¹)å‘å¸ƒå•¦ï¼</p>

<blockquote>
  <p>cozhihuæ˜¯ä¸€æ¬¾çŸ¥ä¹çš®è‚¤chromeæ‰©å±•åº”ç”¨ã€‚</p>
</blockquote>

<p>å¤šå½©çŸ¥ä¹ååˆ†é€‚åˆgeekçŸ¥ä¹ç”¨æˆ·ã€‚éšæ—¶éšåœ°åˆ·çŸ¥ä¹ï¼Œä¿æŠ¤çœ¼ç›ä¸¤ä¸è¯¯ã€‚</p>

<!-- more -->

<h4 id="å®‰è£…">å®‰è£…</h4>
<p><a href="https://chrome.google.com/webstore/detail/oaoadbdcnpjngbdopghepdhlmlbdkgpb"><img width="300px" class="only" src="http://ww3.sinaimg.cn/large/5fd37818jw1eq7bx4bc4ej20c0038mx9.jpg" /></a></p>

<p>æˆ–è€…åˆ°å®˜ç½‘ <a href="http://cozhihu.w3cub.com/">http://cozhihu.w3cub.com/</a>è¿›è¡Œå®‰è£…ã€‚</p>

<h3 id="ç‰¹è‰²">ç‰¹è‰²</h3>

<ul>
  <li>æ”¯æŒåŠ¨æ€é¢„è§ˆé¢œè‰²</li>
  <li>è¶…è¿‡25ç§é¢œè‰²ä¸»é¢˜å¯ä¾›é€‰æ‹©ï¼ŒåŒ…å«å¤œé—´æ¨¡å¼</li>
  <li>å¤šç”¨é€”çš„é­”æœ¯å›¾æ ‡</li>
  <li>æ–‡å­—é˜´å½±ï¼ˆå¯é€‰ï¼‰</li>
</ul>

<h3 id="é¢„è§ˆ">é¢„è§ˆ</h3>

<p><img aria-hidden="true" src="https://lh3.googleusercontent.com/Q9-jyFEiolQrCY9WHREouUwbN4i5gcDGy-xw3xFbFii5Ea8S1ezuRM2IQwuLhCOYNZgntdqFcfI=s640-h400-e365-rw" width="640px" height="400px" /></p>

<h3 id="å¼€æºåè®®">å¼€æºåè®®</h3>

<p>Copyright (c) 2016 Terry Cai. Licensed under the MIT license.<br />
å¼€æºåœ°å€ï¼š<a href="https://github.com/icai/cozhihu">https://github.com/icai/cozhihu</a></p>

<p>åˆ·çŸ¥ä¹ï¼Œé˜²æ²‰è¿·å“¦ï¼</p>

<hr />

<blockquote>
  <p>cozhihu is a chrome extension for zhihu skins.</p>
</blockquote>

<h4 id="install">Install</h4>
<p><a href="https://chrome.google.com/webstore/detail/oaoadbdcnpjngbdopghepdhlmlbdkgpb"><img width="300px" class="only" src="http://ww3.sinaimg.cn/large/5fd37818jw1eq7bx4bc4ej20c0038mx9.jpg" /></a></p>

<h3 id="features">Features</h3>

<ul>
  <li>Dynamic preview the color style.</li>
  <li>A series of skin for you to choose including night mode.</li>
  <li>Magic browser action icon, website link for geek user.</li>
  <li>Text shadow for the site (optional)</li>
</ul>

<h3 id="preview">Preview</h3>

<p><img aria-hidden="true" src="https://lh3.googleusercontent.com/Q9-jyFEiolQrCY9WHREouUwbN4i5gcDGy-xw3xFbFii5Ea8S1ezuRM2IQwuLhCOYNZgntdqFcfI=s640-h400-e365-rw" width="640px" height="400px" /></p>

<p>If you like this, Give me star please:</p>

<iframe class="github-btn" src="https://ghbtns.com/github-btn.html?user=icai&amp;repo=cozhihu&amp;type=star&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[start your shell tour from a question]]></title>
    <link href="http://blog.w3cub.com/blog/2016/05/28/start-your-shell-tour-from-a-question/"/>
    <updated>2016-05-28T08:09:21+00:00</updated>
    <id>http://blog.w3cub.com/blog/2016/05/28/start-your-shell-tour-from-a-question</id>
    <content type="html"><![CDATA[<p>Learn bash shell, by interest or needed. what is your reason to learn the shell? I think the best reason is that what you need is what you learn.</p>

<p>A few days ago, I rewrite the project css to sass, so  I need to rename the css. So I brought out a question, how to â€œRename multiple files shellâ€? To people, solving problems with search engine is the method of least time. I am no exception, I encountered the same problem, and find out the answer in stackoverflow <a href="https://stackoverflow.com/questions/6911301/rename-multiple-files-shell">https://stackoverflow.com/questions/6911301/rename-multiple-files-shell</a>.</p>

<!--more-->

<pre><code>for file in linux_*.mp4 ; do mv "$file" "${file#linux_}" ; done
</code></pre>

<p>But this isnot for my question, so I need to modify this shell ,in order to suit for my situation. I also I found this solution in the comments on the question<a href="http://pubs.opengroup.org/onlinepubs/9699919799/">http://pubs.opengroup.org/onlinepubs/9699919799/</a>.And you may want to know about the <a href="https://en.wikipedia.org/wiki/POSIX">POSIX</a>.</p>

<p>After check the POSIX wiki, you know that. The Portable Operating System Interface (POSIX) is a family of standards specified by the IEEE Computer Society for maintaining compatibility between operating systems. POSIX defines the application programming interface (API), along with command line shells and utility interfaces, for software compatibility with variants of Unix and other operating systems.</p>

<p>But now, we should focus on solving my question. I review the stackoverflow question and the best answer.</p>

<p><strong>Q</strong>: I have multiple files in a directory, example: <code>linux_file1.mp4</code>, <code>linux_file2.mp4</code> and so on. How do I move these files, using shell, so that the names are <code>file1.mp4</code>, <code>file2.mp4</code> and so on. I have about 30 files that I want to move to the new name.</p>

<p><strong>A</strong>: <code>for file in linux_*.mp4 ; do mv "$file" "${file#linux_}" ; done</code></p>

<p>So I guess <code>${file#linux_}</code>  is remove <code>linux_</code> from the filename. As my guess, i am right, you can have a look at the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06_02">documentation</a>. I suggest that you should read the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html">documentation</a> at lest one time. And about the syntax of bash shell you can type the bash help in your terminal.</p>

<p>~$&gt;help</p>

<pre><code>GNU bashï¼Œç‰ˆæœ¬ 4.3.11(1)-release (x86_64-pc-linux-gnu)
è¿™äº› shell å‘½ä»¤æ˜¯å†…éƒ¨å®šä¹‰çš„ã€‚è¯·è¾“å…¥ `help' ä»¥è·å–ä¸€ä¸ªåˆ—è¡¨ã€‚
è¾“å…¥ `help åç§°' ä»¥å¾—åˆ°æœ‰å…³å‡½æ•°`åç§°'çš„æ›´å¤šä¿¡æ¯ã€‚
ä½¿ç”¨ `info bash' æ¥è·å¾—å…³äº shell çš„æ›´å¤šä¸€èˆ¬æ€§ä¿¡æ¯ã€‚
ä½¿ç”¨ `man -k' æˆ– `info' æ¥è·å–ä¸åœ¨åˆ—è¡¨ä¸­çš„å‘½ä»¤çš„æ›´å¤šä¿¡æ¯ã€‚

åç§°æ—è¾¹çš„æ˜Ÿå·(*)è¡¨ç¤ºè¯¥å‘½ä»¤è¢«ç¦ç”¨ã€‚

 job_spec [&amp;]                            history [-c] [-d åç§»é‡] [n] æˆ– history &gt;
 (( è¡¨è¾¾å¼ ))                               if å‘½ä»¤; then å‘½ä»¤; [ elif å‘½ä»¤; then å‘½ä»¤; &gt;
 . æ–‡ä»¶å [å‚æ•°]                              jobs [-lnprs] [ä»»åŠ¡å£°æ˜ ...] æˆ– jobs -x å‘½&gt;
 :                                       kill [-s ä¿¡å·å£°æ˜ | -n ä¿¡å·ç¼–å· | -ä¿¡å·å£°æ˜] è¿›ç¨‹å·&gt;
 [ å‚æ•°... ]                               let å‚æ•° [å‚æ•° ...]
 [[ è¡¨è¾¾å¼ ]]                               local [option] åç§°[=å€¼] ...
 alias [-p] [åç§°[=å€¼] ... ]                logout [n]
 bg [ä»»åŠ¡å£°æ˜ ...]                           mapfile [-n è®¡æ•°] [-O èµ·å§‹åºå·] [-s è®¡æ•°] [-&gt;
 bind [-lpsvPSVX] [-m keymap] [-f file&gt;  popd [-n] [+N | -N]
 break [n]                               printf [-v var] æ ¼å¼ [å‚æ•°]
 builtin [shell å†…å»º [å‚æ•° ...]]             pushd [-n] [+N | -N | ç›®å½•]
 caller [è¡¨è¾¾å¼]                            pwd [-LP]
 case è¯ in [æ¨¡å¼ [| æ¨¡å¼]...) å‘½ä»¤ ;;]... es&gt;         read [-ers] [-a æ•°ç»„] [-d åˆ†éš”ç¬¦] [-i ç¼“å†²åŒº&gt;
 cd [-L|[-P [-e]] [-@]] [dir]            readarray [-n è®¡æ•°] [-O èµ·å§‹åºå·] [-s è®¡æ•°] &gt;
 command [-pVv] å‘½ä»¤ [å‚æ•° ...]              readonly [-aAf] [åç§°[=å€¼] ...] æˆ– reado&gt;
 compgen [-abcdefgjksuv] [-o é€‰é¡¹]  [-A &gt;    return [n]
 complete [-abcdefgjksuv] [-pr] [-DE] &gt;  select NAME [in è¯è¯­ ... ;] do å‘½ä»¤; don&gt;
 compopt [-o|+o é€‰é¡¹] [-DE] [åç§° ...]       set [--abefhkmnptuvxBCHP] [-o é€‰é¡¹å] [&gt;
 continue [n]                            shift [n]
 coproc [åç§°] å‘½ä»¤ [é‡å®šå‘]                    shopt [-pqsu] [-o] [é€‰é¡¹å ...]
 declare [-aAfFgilnrtux] [-p] [name[=v&gt;  source æ–‡ä»¶å [å‚æ•°]
 dirs [-clpv] [+N] [-N]                  suspend [-f]
 disown [-h] [-ar] [ä»»åŠ¡å£°æ˜ ...]            test [è¡¨è¾¾å¼]
 echo [-neE] [å‚æ•° ...]                    time [-p] ç®¡é“
 enable [-a] [-dnps] [-f æ–‡ä»¶å] [åç§° ...]&gt;       times
 eval [å‚æ•° ...]                           trap [-lp] [[å‚æ•°] ä¿¡å·å£°æ˜ ...]
 exec [-cl] [-a åç§°] [å‘½ä»¤ [å‚æ•° ...]] [é‡å®šå‘&gt;        true
 exit [n]                                type [-afptP] åç§° [åç§° ...]
 export [-fn] [åç§°[=å€¼] ...] æˆ– export -p&gt;      typeset [-aAfFgilrtux] [-p] åç§°[=å€¼] .&gt;
 false                                   ulimit [-SHabcdefilmnpqrstuvxT] [lim&gt;
 fc [-e ç¼–è¾‘å™¨å] [-lnr] [èµ·å§‹] [ç»ˆç»“] æˆ– fc -s&gt;          umask [-p] [-S] [æ¨¡å¼]
 fg [ä»»åŠ¡å£°æ˜]                               unalias [-a] åç§° [åç§° ...]
 for åç§° [in è¯è¯­ ... ] ; do å‘½ä»¤; done        unset [-f] [-v] [-n] [name ...]
 for (( è¡¨è¾¾å¼1; è¡¨è¾¾å¼2; è¡¨è¾¾å¼3 )); do å‘½ä»¤; do&gt;           until å‘½ä»¤; do å‘½ä»¤; done
 function åç§° { å‘½ä»¤ ; } æˆ– name () { å‘½ä»¤ ;&gt;       variables - ä¸€äº› shell å˜é‡çš„åç§°å’Œå«ä¹‰
 getopts é€‰é¡¹å­—ç¬¦ä¸² åç§° [å‚æ•°]                   wait [-n] [id ...]
 hash [-lr] [-p è·¯å¾„å] [-dt] [åç§° ...]       while å‘½ä»¤; do å‘½ä»¤; done
 help [-dms] [æ¨¡å¼ ...]                    { å‘½ä»¤ ; }
</code></pre>

<p>Now, I brought out my question :</p>

<p><strong>Q</strong>: Rename the css suffix all current directory file <code>.css</code> to <code>.scss</code> and underscore the file prefix.</p>

<p><strong>A</strong>: <code>for file in *.css ; do mv "$file" "_${file%.css}.scss" ; done</code></p>

<p>About the syntax, you can have a look at the chapter <code>2.6.2 Parameter Expansion</code>.</p>

<p>â€¦</p>

<p>${parameter%[word]}</p>

<p><strong>Remove Smallest Suffix Pattern</strong>. The word shall be expanded to produce a pattern. The parameter expansion shall then result in parameter, with the smallest portion of the suffix matched by the pattern deleted. If present, word shall not begin with an unquoted â€˜%â€™.</p>

<p>${parameter%%[word]}</p>

<p><strong>Remove Largest Suffix Pattern</strong>. The word shall be expanded to produce a pattern. The parameter expansion shall then result in parameter, with the largest portion of the suffix matched by the pattern deleted.</p>

<p>${parameter#[word]}</p>

<p><strong>Remove Smallest Prefix Pattern</strong>. The word shall be expanded to produce a pattern. The parameter expansion shall then result in parameter, with the smallest portion of the prefix matched by the pattern deleted. If present, word shall not begin with an unquoted â€˜#â€™.</p>

<p>${parameter##[word]}</p>

<p><strong>Remove Largest Prefix Pattern</strong>. The word shall be expanded to produce a pattern. The parameter expansion shall then result in parameter, with the largest portion of the prefix matched by the pattern deleted.</p>

<p>â€¦</p>

<p>My question has been solved.</p>

<p>Good luck to you.</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Blog Upgrade from Octopress 2.x to Jekyll 3.x]]></title>
    <link href="http://blog.w3cub.com/blog/2016/05/25/blog-upgrade-from-octopress-2-dot-x-to-jekyll-3-dot-x/"/>
    <updated>2016-05-25T00:06:09+00:00</updated>
    <id>http://blog.w3cub.com/blog/2016/05/25/blog-upgrade-from-octopress-2-dot-x-to-jekyll-3-dot-x</id>
    <content type="html"><![CDATA[<p>Good news, my blog had Upgrade from Octopress 2.x to Jekyll 3.x. It is not difficult to do this, if you follow me step by step.</p>

<p>As you know, Octopress 2.x is based on Jekyll 2.x. so â€œUpgrade from Octopress 2.x to Jekyll 3.xâ€ mean that upgrading Jekyll 2.x to Jekyll 3.x.</p>

<!--more-->

<p><strong>Firstly</strong>, Check out and have a look the offcial upgrade turtuial <a href="https://jekyllrb.com/docs/upgrading/2-to-3/">https://jekyllrb.com/docs/upgrading/2-to-3/</a></p>

<p><strong>Secondly</strong>, upgrade the <code>Gemfile</code> file, <code>gem 'pygments.rb'</code>, <code>gem 'jekyll','~&gt; 3.1.6'</code>, <code>gem 'jekyll-sitemap'</code>,<code>gem 'jekyll-paginate', '~&gt; 1.1'</code>, etc. and than remove the <code>Gemfile.lock</code> file and run command <code>bundle install</code>. If in the gem install process, you catch out the error or some dependencies dependency confliction, upgrading it to the newest version could be ok.</p>

<p><strong>And Then</strong>, Add <code>gems: [jekyll-paginate]</code>  in your <code>_config.yml</code> file and remove <code>Octopress-hooks</code> plugin. if you use the <code>octopress_filters.rb</code>, you need to change the following Codeï¼š</p>

<pre><code>  Jekyll::Hooks.register :page, :pre_render do |page|
    OctopressFilters::pre_filter(page)
  end

  Jekyll::Hooks.register :page, :post_render do |page|
    OctopressFilters::post_render(page)
  end

  Jekyll::Hooks.register :post, :pre_render do |post|
    OctopressFilters::pre_filter(post)
  end

  Jekyll::Hooks.register :post, :post_render do |post|
    OctopressFilters::post_render(post)
  end
</code></pre>

<p>And the <code>sitemap_generator.rb</code> should be upgrade to the newest version.</p>

<p>The above problem is that I encountered during the upgrade process, only for reference. I suggest that when you upgrade the jekyll like me, you should use the the command <code>jekyll build --trace</code> instead of <code>rake preview</code> that you can catch out the error easily.</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[docs w3cub is on]]></title>
    <link href="http://blog.w3cub.com/blog/2015/12/08/docs-w3cub-release/"/>
    <updated>2015-12-08T14:23:26+00:00</updated>
    <id>http://blog.w3cub.com/blog/2015/12/08/docs-w3cub-release</id>
    <content type="html"><![CDATA[<h2 id="preface">Preface</h2>

<p><a href="http://docs.w3cub.com/">docs.w3cub</a> project is based on <a href="https://github.com/Thibaut/devdocs">open source</a>&lt;iframe class="github-btn" src="https://ghbtns.com/github-btn.html?user=Thibaut&amp;repo=devdocs&amp;type=star&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"&gt;&lt;/iframe&gt;. we use jekyll system to rewrite and hosted on Github Pages. This project continued for several months and written in my spare time.</p>

<p>As you know, all pages are static. we think that this would be more fast than using backend router. The most important thing is that Github Pages is free. we also thought about using frondend history router to rewrite this project, but Github Pages donâ€™t support the nginx rule. However we have permission to use 404 page, but useing the 404 page as the frontend router is very crazy idea. So at last we use the jekyll system to generate the static pages. <br />
<!--more--></p>

<p>After subsequent improvement, we will open some jekyll plug-ins and source code.</p>

<h2 id="credits">Credits</h2>

<p>Following credits copy from devdocs.</p>

<table class="table table-bordered table-hover">
  <tbody><tr>
    <th>Documentation
    </th><th>Copyright
    </th><th>License
  </th></tr><tr><td>Angular.js</td><td>Â© 2010-2015 Google, Inc.</td><td><a href="http://creativecommons.org/licenses/by/3.0/">CC BY</a></td></tr><tr><td>Apache HTTP Server</td><td>Â© The Apache Software Foundation</td><td><a href="http://www.apache.org/licenses/LICENSE-2.0">Apache</a></td></tr><tr><td>Backbone.js</td><td>Â© 2010-2015 Jeremy Ashkenas, DocumentCloud</td><td><a href="https://raw.github.com/jashkenas/backbone/master/LICENSE">MIT</a></td></tr><tr><td>Bower</td><td>Â© 2015 Bower contributors</td><td><a href="https://github.com/bower/bower.github.io/blob/b7b94ad38b72e8fb5dafb20c8ce42835a49cc98f/package.json#L20">CC BY</a></td></tr><tr><td>C<br />C++</td><td>Â© cppreference.com</td><td><a href="http://en.cppreference.com/w/Cppreference:Copyright/CC-BY-SA">CC BY-SA</a></td></tr><tr><td>Chai</td><td>Â© 2011-2015 Jake Luer</td><td><a href="https://github.com/chaijs/chai/blob/master/README.md#license">MIT</a></td></tr><tr><td>Clojure</td><td>Â© Rich Hickey</td><td><a href="https://github.com/clojure/clojure/blob/master/epl-v10.html">EPL</a></td></tr><tr><td>CoffeeScript</td><td>Â© 2009-2015 Jeremy Ashkenas</td><td><a href="https://raw.github.com/jashkenas/coffee-script/master/LICENSE">MIT</a></td></tr><tr><td>Cordova</td><td>Â© 2012-2015 The Apache Software Foundation</td><td><a href="https://raw.githubusercontent.com/apache/cordova-docs/master/LICENSE">Apache</a></td></tr><tr><td>CSS<br />DOM<br />HTML<br />JavaScript<br />SVG<br />XPath</td><td>Â© 2005-2015 Mozilla Developer Network and individual contributors</td><td><a href="http://creativecommons.org/licenses/by-sa/2.5/">CC BY-SA</a></td></tr><tr><td>D3.js</td><td>Â© 2015 Michael Bostock</td><td><a href="https://raw.github.com/mbostock/d3/master/LICENSE">BSD</a></td></tr><tr><td>Django</td><td>Â© Django Software Foundation and individual contributors</td><td><a href="https://raw.githubusercontent.com/django/django/master/LICENSE">BSD</a></td></tr><tr><td>Dojo</td><td>Â© 2005-2015 The Dojo Foundation</td><td><a href="http://dojotoolkit.org/license.html">BSD + AFL</a></td></tr><tr><td>Drupal</td><td>Â© 2001-2015 by the original authors<br />Drupal is a registered trademark of Dries Buytaert.</td><td><a href="https://api.drupal.org/api/drupal/LICENSE.txt">GPLv2</a></td></tr><tr><td>Ember.js</td><td>Â© 2015 Yehuda Katz, Tom Dale and Ember.js contributors</td><td><a href="https://raw.github.com/emberjs/ember.js/master/LICENSE">MIT</a></td></tr><tr><td>Elixir</td><td>Â© 2012 Plataformatec</td><td><a href="https://raw.githubusercontent.com/elixir-lang/elixir/master/LICENSE">Apache</a></td></tr><tr><td>Express</td><td>Â© 2009-2015 TJ Holowaychuk</td><td><a href="https://raw.githubusercontent.com/visionmedia/express/master/LICENSE">MIT</a></td></tr><tr><td>Git</td><td>Â© 2005-2015 Linus Torvalds and others</td><td><a href="https://raw.github.com/git/git/master/COPYING">GPLv2</a></td></tr><tr><td>Go</td><td>Â© Google, Inc.</td><td><a href="http://creativecommons.org/licenses/by/3.0/">CC BY</a></td></tr><tr><td>Grunt</td><td>Â© 2014 Grunt Team</td><td><a href="https://raw.githubusercontent.com/gruntjs/gruntjs.com/master/LICENSE">MIT</a></td></tr><tr><td>Haskell</td><td>Â© The University of Glasgow</td><td><a href="http://www.haskell.org/ghc/license">BSD</a></td></tr><tr><td>io.js</td><td>Â© io.js contributors</td><td><a href="https://raw.githubusercontent.com/iojs/io.js/v1.x/LICENSE">MIT</a></td></tr><tr><td>jQuery</td><td>Â© 2009 Packt Publishing<br />Â© 2014 jQuery Foundation</td><td><a href="https://raw.github.com/jquery/api.jquery.com/master/LICENSE-MIT.txt">MIT</a></td></tr><tr><td>jQuery Mobile</td><td>Â© 2014 jQuery Foundation</td><td><a href="https://raw.github.com/jquery/api.jquerymobile.com/master/LICENSE-MIT.txt">MIT</a></td></tr><tr><td>jQuery UI</td><td>Â© 2014 jQuery Foundation</td><td><a href="https://raw.github.com/jquery/api.jqueryui.com/master/LICENSE-MIT.txt">MIT</a></td></tr><tr><td>Knockout.js</td><td>Â© Steven Sanderson, the Knockout.js team, and other contributors</td><td><a href="https://raw.github.com/knockout/knockout/master/LICENSE">MIT</a></td></tr><tr><td>Laravel</td><td>Â© Taylor Otwell</td><td><a href="https://raw.githubusercontent.com/laravel/framework/master/LICENSE.txt">MIT</a></td></tr><tr><td>Less</td><td>Â© 2009-2015 The Core Less Team</td><td><a href="http://creativecommons.org/licenses/by/3.0/">CC BY</a></td></tr><tr><td>Lo-Dash</td><td>Â© 2012-2015 The Dojo Foundation</td><td><a href="https://raw.github.com/lodash/lodash/master/LICENSE.txt">MIT</a></td></tr><tr><td>Lua</td><td>Â© 1994â€“2015 Lua.org, PUC-Rio</td><td><a href="http://www.lua.org/license.html">MIT</a></td></tr><tr><td>Marionette.js</td><td>Â© 2015 Muted Solutions, LLC</td><td><a href="http://mutedsolutions.mit-license.org/">MIT</a></td></tr><tr><td>Markdown</td><td>Â© 2004 John Gruber</td><td><a href="http://daringfireball.net/projects/markdown/license">BSD</a></td></tr><tr><td>Meteor</td><td>Â© 2011-2015 Meteor Development Group</td><td><a href="https://raw.githubusercontent.com/meteor/meteor/master/LICENSE.txt">MIT</a></td></tr><tr><td>Minitest</td><td>Â© Ryan Davis, seattle.rb</td><td><a href="https://raw.githubusercontent.com/seattlerb/minitest/master/README.txt">MIT</a></td></tr><tr><td>Mocha</td><td>Â© 2011-2015 TJ Holowaychuk</td><td><a href="https://raw.githubusercontent.com/mochajs/mocha/master/LICENSE">MIT</a></td></tr><tr><td>Modernizr</td><td>Â© 2009-2014 Modernizr</td><td><a href="http://modernizr.com/license/">MIT</a></td></tr><tr><td>Moment.js</td><td>Â© 2011-2015 Tim Wood, Iskren Chernev, Moment.js contributors</td><td><a href="https://raw.github.com/moment/moment/master/LICENSE">MIT</a></td></tr><tr><td>Mongoose</td><td>Â© 2010 LearnBoost</td><td><a href="https://github.com/LearnBoost/mongoose/blob/master/README.md#license">MIT</a></td></tr><tr><td>nginx</td><td>Â© 2002-2015 Igor Sysoev<br />Â© 2011-2015 Nginx, Inc.</td><td><a href="http://nginx.org/LICENSE">BSD</a></td></tr><tr><td>Node.js</td><td>Â© Joyent, Inc. and other Node contributors<br />Node.js is a trademark of Joyent, Inc.</td><td><a href="https://raw.githubusercontent.com/nodejs/node/master/LICENSE">MIT</a></td></tr><tr><td>Nokogiri</td><td>Â© 2008-2014 2014 Aaron Patterson, Mike Dalessio, Charles Nutter, Sergio Arbeo, Patrick Mahoney, Yoko Harada, Akinori Musha</td><td><a href="https://github.com/sparklemotion/nokogiri/blob/master/README.rdoc#license">MIT</a></td></tr><tr><td>npm</td><td>Â© npm, Inc. and Contributors<br />npm is a trademark of npm, Inc.</td><td><a href="https://raw.githubusercontent.com/npm/npm/master/LICENSE">npm</a></td></tr><tr><td>OpenTSDB</td><td>Â© 2010-2015 The OpenTSDB Authors</td><td><a href="https://raw.githubusercontent.com/OpenTSDB/opentsdb.net/gh-pages/COPYING.LESSER">LGPLv2.1</a></td></tr><tr><td>Phalcon</td><td>Â© 2011-2015 Phalcon Framework Team</td><td><a href="https://docs.phalconphp.com/en/latest/reference/license.html">CC BY</a></td></tr><tr><td>Phaser</td><td>Â© 2015 Richard Davey, Photon Storm Ltd.</td><td><a href="https://raw.githubusercontent.com/photonstorm/phaser/master/license.txt">MIT</a></td></tr><tr><td>Phoenix</td><td>Â© 2014 Chris McCord</td><td><a href="https://raw.githubusercontent.com/phoenixframework/phoenix/master/LICENSE.md">MIT</a></td></tr><tr><td>PHP</td><td>Â© 1997-2015 The PHP Documentation Group</td><td><a href="http://creativecommons.org/licenses/by/3.0/">CC BY</a></td></tr><tr><td>PHPUnit</td><td>Â© 2005-2015 Sebastian Bergmann</td><td><a href="http://creativecommons.org/licenses/by/3.0/">CC BY</a></td></tr><tr><td>PostgreSQL</td><td>Â© 1996-2013 The PostgreSQL Global Development Group<br />Â© 1994 The Regents of the University of California</td><td><a href="http://www.postgresql.org/about/licence/">PostgreSQL</a></td></tr><tr><td>Python</td><td>Â© 1990-2015 Python Software Foundation<br />Python is a trademark of the Python Software Foundation.</td><td><a href="http://docs.python.org/3/license.html">PSFL</a></td></tr><tr><td>Q</td><td>Â© 2009-2015 Kristopher Michael Kowal and contributors</td><td><a href="https://raw.githubusercontent.com/kriskowal/q/v1/LICENSE">MIT</a></td></tr><tr><td>React, React Native, Flow, Relay</td><td>Â© 2013-2015 Facebook Inc.</td><td><a href="https://raw.githubusercontent.com/facebook/react/master/LICENSE-docs">CC BY</a></td></tr><tr><td>Redis</td><td>Â© 2009-2015 Salvatore Sanfilippo</td><td><a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a></td></tr><tr><td>RequireJS</td><td>Â© 2010-2014 The Dojo Foundation</td><td><a href="https://raw.githubusercontent.com/jrburke/requirejs/master/LICENSE">MIT</a></td></tr><tr><td>RethinkDB</td><td>Â© RethinkDB contributors</td><td><a href="https://raw.githubusercontent.com/rethinkdb/docs/master/LICENSE">CC BY-SA</a></td></tr><tr><td>Ruby</td><td>Â© 1993-2015 Yukihiro Matsumoto</td><td><a href="https://www.ruby-lang.org/en/about/license.txt">Ruby</a></td></tr><tr><td>Ruby on Rails</td><td>Â© 2004-2015 David Heinemeier Hansson<br />Rails, Ruby on Rails, and the Rails logo are trademarks of David Heinemeier Hansson.</td><td><a href="https://raw.github.com/rails/rails/master/activerecord/MIT-LICENSE">MIT</a></td></tr><tr><td>Rust</td><td>Â© 2011-2015 The Rust Project Developers</td><td><a href="https://raw.githubusercontent.com/rust-lang/rust/master/LICENSE-MIT">MIT</a></td></tr><tr><td>Sass</td><td>Â© 2006-2015 Hampton Catlin, Nathan Weizenbaum, and Chris Eppstein</td><td><a href="https://raw.github.com/nex3/sass/master/MIT-LICENSE">MIT</a></td></tr><tr><td>Sinon</td><td>Â© 2010-2015 Christian Johansen</td><td><a href="https://raw.githubusercontent.com/cjohansen/Sinon.JS/master/LICENSE">BSD</a></td></tr><tr><td>Socket.io</td><td>Â© 2014-2015 Automattic</td><td><a href="https://raw.githubusercontent.com/Automattic/socket.io/master/LICENSE">MIT</a></td></tr><tr><td>Symfony</td><td>Â© 2004-2015 Fabien Potencier</td><td><a href="http://symfony.com/doc/current/contributing/code/license.html">MIT</a></td></tr><tr><td>Underscore.js</td><td>Â© 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters &amp; Editors</td><td><a href="https://raw.github.com/jashkenas/underscore/master/LICENSE">MIT</a></td></tr><tr><td>Vagrant</td><td>Â© 2010-2015 Mitchell Hashimoto</td><td><a href="https://raw.githubusercontent.com/mitchellh/vagrant/master/LICENSE">MIT</a></td></tr><tr><td>Vue.js</td><td>Â© 2013-2015 Evan You, Vue.js contributors</td><td><a href="https://raw.githubusercontent.com/yyx990803/vue/master/LICENSE">MIT</a></td></tr><tr><td>Webpack</td><td>Â© 2012-2015 Tobias Koppers</td><td><a href="https://raw.githubusercontent.com/webpack/webpack/master/LICENSE">MIT</a></td></tr><tr><td>Yii</td><td>Â© 2008-2015 by Yii Software LLC</td><td><a href="https://raw.github.com/yiisoft/yii/master/LICENSE">BSD</a>
</td></tr></tbody></table>

<p>About devdocs, you can read <a href="https://devdocs.io/about">this</a>.</p>

<h2 id="the-coming-issue">The coming issue</h2>

<p>After improve these static web pages, I would do the app. If you like this, please wait the coming app.</p>

<h2 id="related-links">Related links</h2>

<ul>
  <li>my project <a href="http://docs.w3cub.com/">docs.w3cub</a></li>
  <li>original project <a href="https://devdocs.io/about">devdocs</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢æ­£åˆ™è¡¨è¾¾å¼æ¢ç©¶]]></title>
    <link href="http://blog.w3cub.com/blog/2015/07/15/fuzzy-scoring-regex-mayhem-zh/"/>
    <updated>2015-07-15T14:09:43+00:00</updated>
    <id>http://blog.w3cub.com/blog/2015/07/15/fuzzy-scoring-regex-mayhem-zh</id>
    <content type="html"><![CDATA[<p>Autocompletion is never an entirely solved problem. Can anyone really say what on earth a user typing â€œuniâ€ into a country input field actually intends to select? It could match any of these:</p>

<p>è‡ªåŠ¨å®Œæˆä¸€ç›´éƒ½æ˜¯ä¸€ä¸ªæ²¡å®Œæ²¡äº†çš„é—®é¢˜ã€‚è°èƒ½å‡†ç¡®åœ°è¯´å‡ºå½“ä¸€ä¸ªåœ°çƒäººåœ¨ä¸€ä¸ªå›½å®¶è¾“å…¥æ¡†è¾“å…¥â€œuniâ€æ‰“ç®—é€‰ä»€ä¹ˆï¼Ÿå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼š</p>

<ul>
  <li>Tanzania, [<strong>U</strong>][<strong>n</strong>][<strong>i</strong>]ted Republic of</li>
  <li>[<strong>U</strong>][<strong>n</strong>][<strong>i</strong>]ted Arab Emirates</li>
  <li>[<strong>U</strong>][<strong>n</strong>][<strong>i</strong>]ted Kingdom</li>
  <li>[<strong>U</strong>][<strong>n</strong>][<strong>i</strong>]ted States</li>
  <li>T[<strong>u</strong>][<strong>n</strong>][<strong>i</strong>]sia</li>
</ul>

<p>Of course, itâ€™s probably not the last one, but that right there is a human intuition that we often forget to instil into these UI interactions.</p>

<p>å½“ç„¶ï¼Œè¿™å¯èƒ½ä¸æ˜¯æœ€åä¸€ä¸ªï¼Œä½†äººç±»çš„ç›´è§‰é€šå¸¸ä¼šå¿˜è®°çŒè¾“è¿™äº›UIäº¤äº’ã€‚</p>

<!-- more -->

<p>We can divine what the user <em>probably</em> intends most of the time but itâ€™ll always be a game of heuristics. Most solutions shy away from this game, opting instead to match the query letter-for-letter in each potential value, and this is usually sufficient, but without any other logic not only will â€œlaâ€ match â€œLatviaâ€ but also â€œAngolaâ€. And usually â€œLtviaâ€ will match nothing whatsoever, even though itâ€™s seemingly obvious what the user is trying to type.</p>

<p>æˆ‘ä»¬å¯ä»¥æ¨æ–­ç”¨æˆ·åœ¨è¿™ä¸Šé¢èŠ±è´¹çš„æ—¶é—´ï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸€ä¸ªå¯å‘å¼æ¸¸æˆã€‚å¤§å¤šæ•°è§£å†³æ–¹æ¡ˆéƒ½æ˜¯å°è¯•åŒ¹é…å­—æ¯ä¹‹é—´å¯èƒ½æ½œåœ¨çš„å€¼ï¼Œé€šå¸¸å·²ç»è¶³å¤Ÿäº†ï¼Œâ€œlaâ€ æ²¡æœ‰ä»»ä½•é€»è¾‘ï¼Œä¼šåŒ¹é… â€œLatviaâ€ ä¹Ÿä¼šåŒ¹é… â€œAngolaâ€ã€‚ä½†ç»ä¸ä¼šåŒ¹é… â€œLtviaâ€ï¼Œå°½ç®¡â€œLtviaâ€çœ‹ä¼¼æ˜¯ç”¨æˆ·æƒ³è¦çš„è¾“å…¥ç±»å‹ã€‚</p>

<p>If you try implementing a fuzzy matcher to solve this, the first revelation is that you canâ€™t just boolean-match the query against the data like so many solutions do. You need to score each potential match. Hopefully, in the case of country selection, you end up with a sensible subset of countries that match the query to some reasonable degree. This scoring is necessary so that you know what youâ€™re putting at the top of the list. When typing â€œUâ€, the user expects Ukraine or Uzbekistan sooner than Mauritius or Sudan, for example.</p>

<p>å‡å¦‚ä½ æƒ³ç”¨æ¨¡ç³ŠåŒ¹é…å»è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œä½ ä¸èƒ½åƒå¾€å¸¸é‚£æ ·ç”¨booleanåŒ¹é…å»è¯·æ±‚æŸ¥è¯¢æ•°æ®ã€‚ä½ éœ€è¦è®¡ç®—æ¯ä¸ªå­˜åœ¨åŒ¹é…çš„åˆ†æ•°ã€‚ åœ¨é€‰æ‹©å›½å®¶æƒ…å†µä¸‹ï¼Œä½ æœ€ç»ˆéœ€è¦è¯·æ±‚åŒ¹é…æŸ¥è¯¢ä¸€äº›åˆç¬¦é€»è¾‘çš„åˆç†çš„å›½å®¶å­é›†ã€‚é‚£ä¹ˆè¿™åˆ†æ•°æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æ’åˆ°åˆ—è¡¨çš„é¡¶éƒ¨ã€‚</p>

<p>ï¼ˆè¯‘æ³¨, booleanåŒ¹é… <a href="https://github.com/bevacqua/fuzzysearch">https://github.com/bevacqua/fuzzysearch</a>ï¼‰</p>

<p>Oddly, if you looked at the most common autocompletion widget out there (jQuery UI), it <a href="http://jsfiddle.net/2c11xknm/embedded/result,js,html">doesnâ€™t appear</a> to follow this intuition.</p>

<p>å¥‡æ€ªçš„æ˜¯ï¼Œå‡å¦‚è§è¿‡æœ€å¸¸ç”¨çš„jQuery UI è‡ªåŠ¨å®Œæˆï¼ˆautocompletionï¼‰æ’ä»¶ï¼Œä»–å¹¶æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>

<p>Even the most <a href="http://baymard.com/labs/country-selector">graceful</a> solutions tend to avoid the muddiness of dealing with mistakes like â€œuntied statesâ€ or â€œleichtensteinâ€. Sure, the likeliness of a person having to type the name of a country they arenâ€™t intimately familiar with is probably quite low, but people still make mistakes.</p>

<p>å³ä½¿æ˜¯æœ€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œéƒ½è¶‹å‘äºå¿½è§†æ¨¡ç³Šå¤„ç†é”™è¯¯ï¼Œåƒâ€œuntied statesâ€ ï¼ˆunited statesï¼‰ å’Œ â€œleichtensteinâ€ ï¼ˆliechtenstein ï¼‰ã€‚å½“ç„¶ï¼Œ å°±åƒä¸€ä¸ªäººè¾“å…¥ä¸€ä¸ªå›½å®¶çš„åå­—ï¼Œä»–ä»¬ä¸ç†Ÿæ‚‰è¿™ä¸ªå›½å®¶å¯èƒ½æ€§æ˜¯éå¸¸å¾ˆä½ã€‚ä½†äººä»¬ä»ç„¶ä¼šçŠ¯é”™è¯¯ã€‚</p>

<p>Iâ€™ve been intrigued by this topic for quite a while and itâ€™s why I originally made <a href="https://github.com/padolsey/relevancy.js">relevancy.js</a>. It solves the problem quite well, I think, and it does so in a pretty transparent way, with scores applied for various qualities such as the index of the query within the target string (â€œkingâ€ scores higher than â€œdomâ€ in â€œkingdomâ€, for example), but itâ€™s still a quite a lot of code for such a tiny part of an overall user experience.</p>

<p>æˆ‘ä¸€ç›´è¢«è¿™ä¸ªè¯é¢˜å¸å¼•äº†å¾ˆé•¿æ—¶é—´ï¼Œä¹Ÿæ˜¯æˆ‘å†™ <a href="https://github.com/padolsey/relevancy.js">relevancy.js</a> çš„åŸå› ã€‚å®ƒå¯ä»¥å¾ˆå¥½åœ°å¤„ç†ç±»ä¼¼é—®é¢˜ï¼Œæˆ‘æƒ³ï¼Œä»–çš„åŸç†æ˜¯éå¸¸æ˜¾è€Œæ˜“è§çš„ï¼Œå°±æ˜¯é€šè¿‡åˆ†æ•°å»åŒºåˆ†ä¸åŒå“è´¨ï¼ˆæŠŠåˆ†æ•°åº”ç”¨äºå“è´¨ï¼‰ä¾‹å¦‚ï¼Œç›®æ ‡å­—ç¬¦ä¸²æŸ¥è¯¢çš„ç´¢å¼•(æ­£å¦‚åœ¨æŸ¥è¯¢â€œkingdomâ€ â€œçš„æ—¶å€™ï¼Œkingâ€çš„åˆ†æ•°æ¯” â€œdomâ€é«˜)ã€‚ä½†è¿™è¿˜æ˜¯éœ€è¦ç›¸å½“å¤šçš„ä»£ç å»å®ç°è¿™å°éƒ¨åˆ†ï¼Œç›¸å¯¹äºè¿™æ ·ä¸€ä¸ªæ•´ä½“ç”¨æˆ·ä½“éªŒçš„è€Œè¨€ã€‚</p>

<p>I have once again been playing with this problem (thanks to a certain <a href="https://twitter.com/codepo8/status/572863924887945216">tweet</a>) and have so wanted to come up with something stupefyingly graceful.</p>

<p>æˆ‘åˆå†ä¸€æ¬¡é‡ä¸Šäº†è¿™ä¸ªé—®é¢˜ï¼ˆè°¢è°¢ <a href="https://twitter.com/codepo8/status/572863924887945216">tweet</a> çš„è‚¯å®šï¼‰ï¼Œæˆ‘æƒ³å¯ä»¥å†™çš„æ›´åŠ ä¼˜é›…ã€‚</p>

<p>It all starts with a scratch in back of your mind â€” the one that tells you that your time has come. The <a href="http://xkcd.com/208/">world requires you</a> to use regular expressions.</p>

<p>ä¸€åˆ‡ä»å¤´å¼€å§‹åœ¨ä½ çš„è„‘æµ·é‡Œï¼Œè¿™å‘Šè¯‰ä½ çš„æ—¶é—´åˆ°äº†ã€‚<a href="http://xkcd.com/208/">world requires you</a> ï¼ˆä¸–ç•Œéœ€è¦ä½ ï¼‰ ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>

<p><strong>Warning:</strong> I donâ€™t sincerely recommend doing any of this. Itâ€™s just a bit of fun. Itâ€™s probably an inefficient, unreliable, obscure and ultimately foolish endeavour!</p>

<p>Warningï¼š åˆ«åˆ†å¿ƒï¼Œä¸ç„¶æ•ˆç‡æä½çš„ï¼Œbebebeï½ï½ï½</p>

<h2 id="lets-begin">Letâ€™s begin!</h2>

<p>##æˆ‘ä»¬å…¥æ­£é¢˜ï¼š</p>

<p>A static France might look like this:</p>

<p>é™æ€å­—ç¬¦ä¸²France æ­£åˆ™ï¼š</p>

<pre><code>/^France$/
</code></pre>

<p>A more lenient France might be less sensitive to its case:</p>

<p>ä¸åŒºåˆ†å¤§å°å†™ï¼š</p>

<pre><code>/^france$/i
</code></pre>

<p>We could then allow the characters to be optional too:</p>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å…è®¸å­—ç¬¦æ˜¯å¯é€‰çš„</p>

<pre><code>/^f?r?a?n?c?e?$/i
</code></pre>

<p>This would match â€œfâ€ and â€œfrancâ€ and â€œFaEâ€, etc.</p>

<p>è¿™ä¼šåŒ¹é… â€œfâ€ï¼Œ â€œfrancâ€ å’Œ â€œFaEâ€ç­‰ç­‰ã€‚</p>

<p>Butâ€¦ users make even more grievous mistakes sometimes, and our regular expression should be able to handle those. So letâ€™s add a single character of leniency between each legitimate character, and at the beginning and end of the string:</p>

<p>ä½†â€¦â€¦ ç”¨æˆ·æœ‰æ—¶çŠ¯æ›´ä¸¥é‡çš„é”™è¯¯ï¼Œæˆ‘ä»¬çš„æ­£å¸¸è¡¨è¾¾åº”è¯¥èƒ½å¤Ÿå¤„ç†è¿™äº›é”™è¯¯ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬åœ¨æ¯ä¸€ä¸ªåˆç†çš„å­—æ¯ä¹‹é—´åŠ ä¸Šä¸€ä¸ªå®½å®¹çš„å­—ç¬¦åœ¨æ¯ä¸ªå­—ç¬¦çš„å‰åã€‚</p>

<pre><code>/^.?f?.?r?.?a?.?n?.?c?.?e?.?$/i
</code></pre>

<p>But then this would allow contiguous mistakes like â€œfafafafaâ€. We only want to allow a <em>single</em> incorrect mistake after each successfully entered character. For this we can use groups to force each character to be matched and a lazy quantifier on the mistake character to ensure that legitimate characters get to successfully match.</p>

<p>ä½†å½“è¿™å…è®¸è¿ç»­é”™è¯¯åƒâ€œfafafafaâ€ï¼Œæˆ‘ä»¬åªå…è®¸ä¸€ä¸ªå•ä¸€çš„é”™è¯¯åœ¨æ¯ä¸ªæ­£ç¡®è¾“å…¥å­—ç¬¦ä¹‹åã€‚ä¸ºæ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ†ç»„å¼ºåˆ¶æ¯ä¸ªå­—ç¬¦åŒ¹é…å’Œæ‡’æƒ°åŒ¹é…çš„é”™è¯¯çš„å­—ç¬¦ä¸²ï¼Œç¡®ä¿åˆæ³•å­—ç¬¦å¯ä»¥æˆåŠŸåŒ¹é…ã€‚</p>

<p>So:</p>

<pre><code>/f.?otherStuff/
</code></pre>

<p>Becomes:</p>

<pre><code>/(?:f.??)?otherStuff/
</code></pre>

<p>In English: Try to match <code>f</code> followed by <code>otherStuff</code>. If impossible then try to match any character after <code>f</code> but before <code>otherStuff</code>. (This is why lazy quantifiers (e.g. <code>??</code>) are so useful!)</p>

<p>å°±æ˜¯è¯´ï¼Œå°è¯•åŒ¹é…è·Ÿåœ¨otherStuffä¹‹å‰çš„fã€‚å¦‚æœä¸å¯èƒ½çš„è¯ï¼Œå°è¯•åŒ¹é…ä»»ä½•åœ¨â€œfâ€ ä¹‹åï¼Œåœ¨â€œotherStuffâ€ ä¹‹å‰çš„å­—ç¬¦ã€‚</p>

<p>The entire regex would become:</p>

<p>å®Œæ•´çš„æ­£åˆ™è¡¨è¾¾å¼ä¼šå˜æˆï¼š</p>

<pre><code>/^(?:.(?=f))?(?:f.??)?(?:r.??)?(?:a.??)?(?:n.??)?(?:c.??)?(?:e.??)?$/i
</code></pre>

<p>We should probably capture each individual match (<code>f</code> should be <code>(f)</code>) so that we can analyze the result and score it appropriately.</p>

<p>æˆ‘ä»¬å¯èƒ½éœ€è¦æ•è·æ¯ä¸ªå•ç‹¬çš„åŒ¹é…(<code>f</code> åº”è¯¥æ˜¯<code>(f)</code>) ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åˆ†æç»“æœå¹¶é€‚å½“åœ°è¯„åˆ†ã€‚</p>

<pre><code>var r = /^(?:(f).??)?(?:(r).??)?(?:(a).??)?(?:(n).??)?(?:(c).??)?(?:(e).??)?$/i

'f$R-aN_cEx'.match(r);
// =&gt; ["f$R-aN_cEx", "f", "R", "a", "N", "c", "E"]
</code></pre>

<p>The regular expression, broken down:</p>

<p>æ­£åˆ™è¡¨è¾¾å¼è§£é‡Šï¼š</p>

<pre><code>/
  ^       # Start of string

  (?:     # Non-captured groupï¼ˆéæ•è·ï¼‰
    (f)   # Match and capture 'f' ï¼ˆåŒ¹é…å¹¶æ•è·"f"ï¼‰
    .??   # Followed lazily by any character ï¼ˆæ‡’æƒ°åŒ¹é…è·Ÿéšå­—ç¬¦ï¼‰
  )?      # Entire group is optional ï¼ˆç»„å¯é€‰ï¼‰

  (?:     # Non-captured group
    (r)   # Match and capture 'f'
    .??   # Followed lazily by any character
  )?      # Entire group is optional

  ...     # Etc.

  $       # End of string
/i
</code></pre>

<p><em>A quick note</em>: <em>lazy</em> or <em>lazily</em> in the context of regular expressions simply means that that thing will be intentionally excluded from the first match attempt and will only be used if the subsequent regular expression is unsuccessful without it.</p>

<p>å°ä¾¿ç­¾ï¼šæ­£åˆ™è¡¨è¾¾å¼ä¸­æ‡’æƒ°åŒ¹é…æ˜¯æŒ‡â€¦â€¦</p>

<p>One caveat with the above regex is that it doesnâ€™t allow a mistake to be at the beginning of the string. We could fix this with a lookahead to the effect of â€œallow a mistake here as long as its followed by a non-mistakeâ€ but since â€œnon-mistakeâ€ could effectively be any character in the legitimate string itâ€™s easier to just make allowances for that initial mistake in each group. Additionally, we probably want to capture every single mistake, in addition to legitimate characters. Hereâ€™s our next iteration:</p>

<p>ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒä¸å…è®¸åœ¨å­—ç¬¦ä¸²çš„å¼€å¤´æœ‰é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥ä¿®å¤è¿™ä¸ªå‰ç»é”™è¯¯é€šè¿‡ â€œå…è®¸çŠ¯é”™è¯¯ï¼Œåªè¦å®ƒè·Ÿåœ¨ä¸€ä¸ªéé”™è¯¯åé¢â€ï¼Œ ä½†ç”±äº â€œéé”™è¯¯â€ å¯ä»¥æœ‰æ•ˆåœ°åœ¨åˆæ³•å­—ç¬¦ä¸²ä¸­çš„ä»»ä½•å­—ç¬¦ï¼Œä½¿å¾—å®ƒæ›´å®¹æ˜“åœ¨æ¯ä¸ªç»„ä¸­å‡ºç°æ‰€å…è®¸çš„åˆå§‹é”™è¯¯ã€‚æ­¤å¤–ï¼Œé™¤äº†åˆæ³•çš„å­—ç¬¦ï¼Œæˆ‘ä»¬è¿˜å¯èƒ½è¦æ•æ‰æ¯ä¸€ä¸ªé”™è¯¯ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬çš„å®ç°ï¼š</p>

<pre><code>/
  ^         # Start of string

  (?:       # Non-captured group

    (^.)?   # Captured optional mistake at the beginning of the string
            # ===============================================

    (f)     # Match and capture 'f'
    (.??)   # Followed lazily by any character (captured)
  )?        # Entire group is optional

  ...     # Etc.

  $       # End of string
/i
</code></pre>

<p>The check <code>(^.)?</code> has to be specified in each group, to account for mistakes that donâ€™t involve â€œfâ€, like â€œkranceâ€ or â€œttanceâ€, etc.</p>

<p>æ£€æŸ¥<code>(^.)?</code>å¿…é¡»æ¯ç»„éƒ½æŒ‡å®š, ä»¥ä¾¿è€ƒè™‘é”™è¯¯ä¸æ¶‰åŠåˆ° â€œfâ€, å°±åƒ â€œkranceâ€ å’Œ â€œttanceâ€, ç­‰ç­‰ã€‚</p>

<p>Since weâ€™re aiming to genericize this entire mess, we should create a generator that assembles the regular expression given any piece of text:</p>

<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ˜¯è¦å»å¤„ç†è¿™ä¸€ç±»é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç”Ÿæˆå™¨å»ç»„è£…å°†ç»™å®šçš„æ–‡æœ¬é›†åˆçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>

<pre><code>function makeFuzzyRegex(string) {

  if (!string) { return /^$/; }

  // Escape any potential special characters:
  var cleansed = string.replace(/\W/g, '\\$&amp;');

  return RegExp(
    '^' +
      cleansed.replace(
        // Find every escaped and non-escaped char:
        /(\\?.)/g,
        // Replace with fuzzy character matcher:
        '(?:(^.)?($1)(.??))?'
      ) +
    '$',
    'i'
  );
}

makeFuzzyRegex('omg');
// =&gt; /^(?:(^.)?(o)(.??))?(?:(^.)?(m)(.??))?(?:(^.)?(g)(.??))?$/i
</code></pre>

<p>This regex matched against â€˜_o-m*g!â€™ produces:</p>

<pre><code>[
  // Full match:
  "_o-m*g!",

  // Captures:
  "_",           // Mistake
  "o",           // Legit
  "-",           // Mistake

  undefined,     // Void mistake
  "m",           // Legit
  "*",           // Mistake

  undefined,     // Void mistake
  "g",           // Legit
  "!"            // Mistake
]
</code></pre>

<p>The captures are in groups of three, with every second capture being the legitimate character (case-insensitive), and with every first and third potentially being mistakes.</p>

<p>æ•è·æ˜¯åœ¨ä¸‰ç»„ï¼Œæ¯ç»„æ•è·éƒ½æ˜¯åˆæ³•æ€§ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œå¹¶ä¸æ¯ç»„ç¬¬ä¸€å’Œç¬¬ä¸‰ä¸ªå­—ç¬¦éƒ½å¯èƒ½æ½œåœ¨é”™è¯¯ã€‚</p>

<p>We can then loop through these captures and apply weights as we see fit.</p>

<p>æˆ‘ä»¬å¯ä»¥å¾ªç¯è¿™äº›æ•æ‰å’Œåº”ç”¨æƒé‡ä½œä¸ºæˆ‘ä»¬åˆé€‚çš„åˆ†æ•°ã€‚</p>

<pre><code>var fullMatch = makeFuzzyRegex('omg').exec('_o-m*g!');
var captures = fullMatch.slice(1); // Get captures specifically
var score = 0;

for (var i = 0, l = captures.length; i &lt; l; i += 3) {
  if (captures[i]) score -= 1;
  if (captures[i+1]) score += 10;
  if (captures[i+2]) score -= 1;
}

score; // =&gt; 26
</code></pre>

<p>That scoring is quite arbitrary, but weâ€™ve at least prescribed our wish to score successes more than we punish mistakes (10 vs 1).</p>

<p>è¿™è®¡ç®—æ˜¯ååˆ†éšæ„çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è‡³å°‘æŒ‡å®šæˆ‘ä»¬çš„æ„¿æœ›æ¯”æˆ‘ä»¬æƒ©ç½šçš„é”™è¯¯æ›´æˆåŠŸ(10 vs 1)ã€‚</p>

<p>We can start to play with the heuristics of this if we wrap it all up:</p>

<p>æˆ‘ä»¬æŠŠå®ƒå°è£…èµ·æ¥ï¼Œè®©Taæºœæºœï¼š</p>

<pre><code>function createFuzzyScorer(text) {

  var matcher = makeFuzzyRegex(text);

  return function(query) {
    var match = matcher.exec(query);

    if (!match) return 0;

    var captures = match.slice(1);
    var score = 0;

    for (var i = 0, l = captures.length; i &lt; l; i += 3) {
      if (captures[i]) score -= 1;
      if (captures[i+1]) score += 10;
      if (captures[i+2]) score -= 1;
    }

    return score;
  };

  function makeFuzzyRegex(string) {

    if (!string) { return /^$/; }

    // Escape any potential special characters:
    var cleansed = string.replace(/\W/g, '\\$&amp;');

    return RegExp(
      '^' +
        cleansed.replace(
          // Find every escaped and non-escaped char:
          /(\\?.)/g,
          // Replace with fuzzy character matcher:
          '(?:(^.)?($1)(.??))?'
        ) +
      '$',
      'i'
    );
  }
}
</code></pre>

<p>Our first attempt isnâ€™t too bad:</p>

<p>æˆ‘ä»¬çš„ç¬¬ä¸€æ¬¡å°è¯•å¹¶ä¸å¤ªåï¼š</p>

<pre><code>var score = createFuzzyScorer('omg');

score('omg');     // =&gt; 30
score('xOmg');    // =&gt; 29
score('.o.m.g.'); // =&gt; 26
score('om');      // =&gt; 20
score('og');      // =&gt; 20
score('o');       // =&gt; 10
score('nope');    // =&gt; 0
</code></pre>

<p>These seem like sensible enough scores, generally, but weâ€™re more interested in autocompletion, and so thereâ€™s an obvious predictive element there. If a user types â€˜oâ€™ then that should probably score higher than â€˜gâ€™ if weâ€™re testing against â€˜omgâ€™, but with the above mechanism they both receive a standard 10:</p>

<p>è¿™ä¼¼ä¹æ˜¯å¯æ„ŸçŸ¥çš„è¶³å¤Ÿçš„åˆ†æ•°ï¼Œä¸€èˆ¬ï¼Œä½†æˆ‘ä»¬åœ¨è‡ªåŠ¨å®Œæˆæ›´æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªæ˜æ˜¾çš„é¢„æµ‹å…ƒç´ çš„å­˜åœ¨ã€‚å½“æˆ‘ä»¬æˆ‘ä»¬æµ‹è¯•â€˜omgâ€™æ—¶ï¼Œå¦‚æœç”¨æˆ·é”®å…¥â€oâ€é‚£åº”è¯¥å¾—åˆ†é«˜äºâ€gâ€ï¼Œä½†ä¸Šè¿°æ–¹æ³•éƒ½æ¥å—æ ‡å‡†çš„10ï¼š</p>

<pre><code>var score = createFuzzyScorer('omg');

score('o'); // =&gt; 10
score('g'); // =&gt; 10
</code></pre>

<p>We can fix this by applying a higher weight to matches that appear earlier in the string:</p>

<p>æˆ‘ä»¬å¯ä»¥ç”¨æ›´é«˜çš„æƒé‡æ¥è§£å†³å­—ç¬¦ä¸²ä¸­è¾ƒæ—©å‡ºç°çš„åŒ¹é…é—®é¢˜ï¼š</p>

<pre><code>// The scoring loop:
for (var i = 0, l = captures.length; i &lt; l; i += 3) {
  if (captures[i]) score -= 0.1;
  if (captures[i+1]) score += (l - i) / l; // the magic
  if (captures[i+2]) score -= 0.1;
}
</code></pre>

<p>Now the score given for any singular legitimate match will decrease as the index (<code>i</code>) increases. Here are the results:</p>

<p>ç°åœ¨ä»»ä½•å¥‡å¼‚çš„åˆæ³•çš„åŒ¹é…çš„å¾—åˆ†å°†ä¼šé€’å‡éšç€æŒ‡æ•°ï¼ˆiï¼‰å¢åŠ ã€‚è¿™é‡Œæ˜¯ç»“æœï¼š</p>

<pre><code>var score = createFuzzyScorer('omg');

score('omg');     // =&gt; 1.99
score('xOmg');    // =&gt; 1.90
score('om');      // =&gt; 1.66
score('.o.m.g.'); // =&gt; 1.59
score('og');      // =&gt; 1.33
score('o');       // =&gt; 1.00
score('nope');    // =&gt; 0.00
</code></pre>

<p>This is getting closer to our intuition. The next step would be to try to create a real autocompletion widget. Iâ€™ve done it so I know that weâ€™ll want to make one more change. The problem with our scoring right now is that itâ€™ll award legitimate characters relative to the length of the string. But when comparing scores across multiple subject strings, this approach seems broken.</p>

<p>è¿™æ˜¯è¶Šæ¥è¶Šæ¥è¿‘æˆ‘ä»¬çš„ç›´è§‰ã€‚ä¸‹ä¸€æ­¥å°†åŠªåŠ›åˆ›é€ ä¸€ä¸ªçœŸæ­£çš„è‡ªåŠ¨å®ŒæˆåŠŸèƒ½éƒ¨ä»¶ã€‚æˆ‘å·²ç»è¿™æ ·åšäº†ï¼Œæ‰€ä»¥æˆ‘çŸ¥é“ï¼Œæˆ‘ä»¬å°†è¦åšä¸€ä¸ªæ”¹å˜ã€‚ç°åœ¨æˆ‘ä»¬åˆ†å€¼çš„é—®é¢˜æ˜¯ï¼Œå¥–åŠ±åˆæ³•çš„å­—ç¬¦ç›¸å¯¹äºå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ä½†æ˜¯ï¼Œå½“æ¯”è¾ƒå¤šä¸ªåŒç±»å­—ç¬¦ä¸²çš„åˆ†æ•°æ—¶ï¼Œè¿™ç§æ–¹æ³•ä¼¼ä¹è¢«æ‰“ç ´ã€‚</p>

<pre><code>createFuzzyScorer('RuneScript')('Ru'); // 1.9
createFuzzyScorer('Ruby')('Ru');       // 1.7
</code></pre>

<p>These should both score equally, as â€œRuâ€ is just as likely to become â€œRubyâ€ as it is to become â€œRuneScriptâ€. To achieve this we should only take into account the index, and make the weight of any scoring decision inversely proportional to that index, in this case via an exponential taper (<code>pow(index, -2)</code>).</p>

<p>æ˜¾ç„¶ï¼Œåˆ†æ•°åº”è¯¥ç›¸ç­‰ï¼Œå› ä¸º â€œRuâ€ æ¨æ¼”æˆ â€œRubyâ€ å’Œ â€œRuneScriptâ€ æ˜¯ä¸€æ ·. ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘åˆ°è¯¥æŒ‡æ•°ï¼Œå¹¶ä½¿ä»»ä½•å¾—åˆ†å†³å®šçš„æƒé‡ä¸æŒ‡æ•°æˆåæ¯”ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡æŒ‡æ•°é”¥åº¦ (<code>pow(index, -2)</code>)</p>

<pre><code>// The scoring loop:
for (var i = 0, l = captures.length; i &lt; l; i += 3) {
  var relevancyOfCharacter = Math.pow(i + 1, -2);
  if (captures[i]) score -= relevancyOfCharacter * 0.1;
  if (captures[i+1]) score += relevancyOfCharacter * 1;
  if (captures[i+2]) score -= relevancyOfCharacter * 0.1;
}
</code></pre>

<p><em>(Final version of <code>createFuzzyScorer</code> available <a href="https://gist.github.com/padolsey/a27a32d5859a71403b10">as a gist</a>.)</em></p>

<p><strong><a href="http://jsbin.com/wanetemare/1/edit?js,output">See this demo using programming languages as the dataset</a></strong>. Try intentionally misspelling something (jawascript), or missing out characters (jaascit), or just going a little crazy (jahskt). It works beautifully.</p>

<p><strong><a href="http://jsbin.com/wanetemare/1/edit?js,output">åœ¨æ•°æ®é›†ç”¨ç¼–ç¨‹è¯­è¨€å®ç°æŸ¥çœ‹demo</a></strong>. å°è¯•æ‹¼å†™é”™è¯¯ï¼ˆjawascriptï¼‰ï¼Œæˆ–è€…ä¸¢å¤±å­—æ¯ï¼ˆjaascitï¼‰æˆ–è€…è¾“å…¥ä¸€äº›ç±»ä¼¼çš„ï¼ˆjahsktï¼‰ï¼Œ å®ƒä¾ç„¶å·¥ä½œå¾—å¾ˆæ¼‚äº®ã€‚</p>

<p>To achieve speedy sorting, a fuzzy scorer is created for every single value before the user types anything:</p>

<p>ä¸ºäº†å®ç°å¿«é€Ÿæ’åºï¼Œ æ¯ä¸€ä¸ªå•ä¸€çš„å€¼çš„æ¨¡ç³Šåˆ†æ•°åº”è¯¥åœ¨ç”¨æˆ·è¾“å…¥ä¹‹å‰è¢«åˆ›å»ºï¼š</p>

<pre><code>var data = PROGRAMMING_LANGUAGES.map(function(lang, i) {
  return {
    actualValue: lang,
    score: createFuzzyScorer(lang),
    i: i,
    toString: function() { return lang; }
  };
});
</code></pre>

<p>This means we can iterate through <code>data</code> on every relevant input event, and call the <code>score()</code>method with the current query. We can then bundle this into a <em>filter-&gt;sort-&gt;slice</em> flow to get our list of sensible suggestions:</p>

<p>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥éå†æ¯ä¸ªç›¸å…³çš„è¾“å…¥äº‹ä»¶çš„ data ï¼Œè°ƒç”¨ score() æ–¹æ³•æ¥å®ç°å½“å‰æŸ¥è¯¢ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™å˜æˆä¸€ä¸ª <em>filter-&gt;sort-&gt;slice</em> å¾—å‡ºæˆ‘ä»¬åˆ—å‡ºçš„æœ‰åˆ¤æ–­åŠ›çš„å»ºè®®ï¼š</p>

<pre><code>var sorted = data.filter(function(item) {

  // Get rid of any very unlikely matches (and cache the score!)
  return (item._cachedScore = item.score(query)) &gt;= .5;

}).sort(function(a, b) {

  var as = a._cachedScore;
  var bs = b._cachedScore;

  // Sort by score, and if score is equal, then by original index:
  // (We would typically return 0 in that case but some engines don't stable-sort)
  return as &gt; bs ? -1 : as == bs &amp;&amp; a.i &lt; b.i ? -1 : 1;

}).slice(0, 10); // We only need the top 10...
</code></pre>

<p>And.. weâ€™re done. Itâ€™s never really finished though: youâ€™ll find endless tweaks that can be made to the scorer to make it more believably resemble human-like intuition.</p>

<p>æˆ‘ä»¬åšåˆ°äº†ï¼Œè™½ç„¶å®ƒä»æ¥æ²¡æœ‰çœŸæ­£å®Œæˆï¼Œä½ ä¼šå‘ç°å¾ˆå¤šçš„è°ƒæ•´ï¼Œä½¿å¾—åˆ†æ•°æ›´åŠ äººå·¥æ™ºèƒ½ã€‚</p>

<p>For those wanting to test the resulting country autocompletion interaction: <strong><a href="http://jsbin.com/lejucikiha/1/edit?js,output">See the demo</a></strong>.</p>

<p>å¯¹äºé‚£äº›æƒ³è¦æµ‹è¯•å›½å®¶è‡ªåŠ¨å®Œæˆè¿”å›å€¼äº¤äº’çš„ï¼Œ<strong><a href="http://jsbin.com/lejucikiha/1/edit?js,output">See the demo</a></strong>.</p>

<p>I guess, despite my initial warning, I wouldnâ€™t actually mind using this in production, as long as there were a decent number of unit tests. Iâ€™d probably also assemble the regular expressions on the server and serve them up as literals. Itâ€™s also worth mentioning that almost everything in this post has been exploring the fuzzy-matching of very short strings in small datasets. Even in the case of the country demo, to get more applicable results, I broke up long names into the component parts and then scored against each. E.g.</p>

<p>æˆ‘æƒ³ï¼Œå°½ç®¡æˆ‘æœ€åˆçš„å¿ å‘Šï¼Œæˆ‘ä¸ä»‹æ„ä½¿ç”¨è¿™ä¸ªåœ¨ç”Ÿäº§ï¼Œåªè¦åšä¸€äº›æ•°é‡çš„å•ä½æµ‹è¯•ã€‚æˆ‘å¯èƒ½ä¹Ÿç»„è£…æ­£åˆ™è¡¨è¾¾å¼åœ¨æœåŠ¡å™¨å¹¶ä¸ºæä¾›æœåŠ¡ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå‡ ä¹æ‰€æœ‰çš„è¿™ç¯‡æ–‡ç« éƒ½åœ¨æ¢ç´¢å°æ•°æ®é›†ä¸Šçš„æ¨¡ç³ŠåŒ¹é…ã€‚å³ä½¿åœ¨å›½å®¶è¾“å…¥æ¡ˆä¾‹çš„æ¼”ç¤ºï¼Œä»¥è·å¾—æ›´é€‚ç”¨çš„ç»“æœï¼Œæˆ‘æŠ˜æ–­äº†é•¿çš„åå­—ï¼Œç»„æˆéƒ¨åˆ†ï¼Œç„¶åå¯¹æ¯ä¸€ä¸ªå¾—åˆ†ã€‚ä¾‹å¦‚</p>

<pre><code>// E.g. Macedonia, the Former Yugoslav Republic of:
var scorers = [
  "Macedonia, the Former Yugoslav Republic of",
  "Macedonia",
  "the",
  "former",
  "yugoslav",
  "republic",
  "of"
].map(createFuzzyScorer);
// Etc.
</code></pre>

<p>And this would be terribly inefficient on a larger scale, so with any dataset longer than a list of countries youâ€™re probably best to explore <a href="http://en.wikipedia.org/wiki/Trie">Trie</a>-based approaches to autocompletion.</p>

<p>And with that, Iâ€™ll shut-up and wish you merry regexâ€™ing!</p>

<p>ç„¶è€Œè¿™åœ¨å¤§è§„æ¨¡æ‰«æä¸‹æ˜¯éå¸¸ä½æ•ˆçš„ï¼Œæ‰€ä»¥ä»»ä½•æ•°æ®é›†æ¯”çš„å›½å®¶åå•é•¿çš„ï¼Œä½ å¯èƒ½æœ€å¥½çš„æ¢ç©¶ <a href="http://en.wikipedia.org/wiki/Trie">Trie</a>-based æ–¹æ³• æ¥å¤„ç†è‡ªåŠ¨å®Œæˆã€‚ç„¶åï¼Œæˆ‘ä¼šé—­å˜´ï¼Œ wish you merry regexâ€™ing!</p>

<p>è¯‘è€…æ³¨ï¼š</p>

<p>æ–‡ä¸­åŠå…¶è¯„è®ºæåˆ°çš„èµ„æºï¼š</p>

<p><a href="https://github.com/padolsey/relevancy.js">https://github.com/padolsey/relevancy.js</a></p>

<p><a href="https://github.com/bevacqua/fuzzysearch">https://github.com/bevacqua/fuzzysearch</a></p>

<p><a href="https://github.com/gf3/Levenshtein">https://github.com/gf3/Levenshtein</a></p>

<p>ä½œè€…githubï¼š<a href="https://github.com/padolsey">https://github.com/padolsey</a></p>

<p>è¯‘è€…ï¼šä¸»è¦ç”¨åˆ°æ­£åˆ™æ‡’æƒ°åŒ¹é…å»å®ç°<code>çœŸå€¼</code>çº¿æ€§å›å½’ã€‚you are truly, how much truly you are!</p>

<p>å°±æ˜¯é€šè¿‡åŒ¹é…åº¦åˆ†æ•°è¿›è¡Œæ’åºï¼Œè€Œä¸æ˜¯å•å•çš„boolean å€¼æŒ‡å®šï¼Œå†a-z æ’åºè¾“å‡ºï¼Œ</p>

<p><a href="https://github.com/bevacqua/fuzzysearch">https://github.com/bevacqua/fuzzysearch</a>æ‰€ç”¨çš„æ–¹æ³•ï¼Œä½ åªèƒ½åœ¨true or false ä¹‹é—´é€‰æ‹©ï¼Œè€Œpadolseyæ‰€ç”¨çš„æ–¹æ³•å­—æ ·å¼•å…¥äº†æƒé‡æ¦‚å¿µæ›´åŠ æ™ºèƒ½ï¼Œä½†æ˜¯åœ¨å¤§è§„æ¨¡æ•°æ®ä¸‹æ˜¯éå¸¸ä½æ•ˆçš„ã€‚å¦å¤–åœ¨ä½œè€…çš„åšå®¢è¯„è®ºä¸­ä¹Ÿæåˆ°çš„ <a href="https://github.com/gf3/Levenshtein">https://github.com/gf3/Levenshtein</a>ï¼Œ å¯ä»¥è‡ªè¡Œwikiä¸€ä¸‹ã€‚</p>

<hr />

<p>æœ€åå¦‚æœ‰æ¼è¯‘ï¼Œé”™è¯‘ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rvm help]]></title>
    <link href="http://blog.w3cub.com/blog/2015/06/28/rvm-help/"/>
    <updated>2015-06-28T05:12:54+00:00</updated>
    <id>http://blog.w3cub.com/blog/2015/06/28/rvm-help</id>
    <content type="html"><![CDATA[<p>å¸¸ç”¨å‘½ä»¤ï¼ˆActionï¼‰ï¼š</p>

<pre><code>list        :: show currently installed rubies, interactive output.
install     :: install one or many ruby versions
use         :: setup current shell to use a specific ruby version
</code></pre>

<!-- more -->

<p>è¯¦ç»†å¸®åŠ©æ–‡æ¡£ï¼ˆrvm -hï¼‰ï¼š</p>

<pre><code>= rvm

* https://rvm.io/
* https://github.com/wayneeseguin/rvm/

== DESCRIPTION:

RVM is the Ruby enVironment Manager (rvm).

It manages Ruby application environments and enables switching between them.

== Installation

  curl -L https://get.rvm.io | bash -s stable --autolibs=enabled [--ruby] [--rails] [--trace]

stable     :: Install stable RVM, good for servers.
--ruby     :: Additionally install latest ruby version (MRI).
--rails    :: Install gem rails into default gemset (also installs ruby=).
--trace    :: Print trace of the installation, gist output when you have problems.
--autolibs :: Enable or disable autolibs see: https://rvm.io/rvm/autolibs

More details here: https://rvm.io/rvm/install/

== Usage

  rvm [Flags] [Options] Action [Implementation[,Implementation[,...]]

== Flags

--default         :: with 'rvm use X', sets the default ruby for new shells to X.
--debug           :: Toggle debug mode on for very verbose output.
--disable-binary  :: Install from source instead of using binaries
--trace           :: Toggle trace mode on to see EVERYTHING rvm is doing.
--force           :: Force install, removes old install &amp; source before install.
--summary         :: Used with rubydo to print out a summary of the commands run.
--latest          :: with gemset --dump skips version strings for latest gem.
--gems            :: with uninstall/remove removes gems with the interpreter.
--docs            :: with install, attempt to generate ri after installation.
--reconfigure     :: Force ./configure on install even if Makefile already exists.
--skip-gemsets    :: with install, skip the installation of default gemsets.
--quiet-curl      :: Makes curl silent when fetching data

== Options

-v|--version     :: Emit rvm version loaded for current shell
-l|--level       :: patch level to use with rvm use / install
   --bin         :: path for binaries to be placed (~/.rvm/bin/)
-S               :: Specify a script file to attempt to load and run (rubydo)
-e               :: Execute code from the command line.
--gems           :: Used to set the 'gems_flag', use with 'remove' to remove
                    gems
--archive        :: Used to set the 'archive_flag', use with 'remove' to remove
                    archive
--patch          :: With MRI Rubies you may specify one or more full paths to
                    patches

                    for multiple, specify comma separated:

                      --patch /.../.../a.patch[%prefix],/.../.../.../b.patch

                    'prefix' is an optional argument, which will be bypassed
                    to the '-p' argument of the 'patch' command. It is separated
                    from patch file name with '%' symbol.
-C|--configure   :: custom configure options. If you need to pass several
                    configure options then append them comma separated:

                      -C --...,--...,--...

--nice           :: process niceness (for slow computers, default 0)
--ree-options    :: Options passed directly to ree's './installer' on the
                    command line.
--with-rubies    :: Specifies a string for rvm to attempt to expand for set
                    operations.

== Action

(Note: for most actions, 'rvm help action-name' may provide more information.)

*usage*     :: show this usage information
version     :: show the rvm version installed in rvm_path
use         :: setup current shell to use a specific ruby version
reload      :: reload rvm source itself (useful after changing rvm source)
implode     :: (seppuku) removes the rvm installation completely.

               This means everything in $rvm_path (~/.rvm || /usr/local/rvm).

               This does not touch your profiles. However, this means that you
               must manually clean up your profiles and remove the lines which
               source RVM.
get         :: {head,stable} upgrades rvm to latest head or stable version.

               Check 'rvm help get' for more details.

               (If you experience bugs try this first with head version, then
               ask for help in #rvm on irc.freenode.net and hang around)
reset       :: remove current and stored default &amp; system settings.

               (If you experience odd behavior try this second)
info        :: show the *current* environment information for current ruby
current     :: print the *current* ruby version and the name of any gemset
               being used.
debug       :: show info plus additional information for common issues

install     :: install one or many ruby versions

               See also: https://rvm.io/rubies/installing/
uninstall   :: uninstall one or many ruby versions, leaves their sources
remove      :: uninstall one or many ruby versions and remove their sources
reinstall   :: reinstall ruby and runs gem pristine on all gems,
               make sure to read output, use 'all' for all rubies.

migrate     :: Lets you migrate all gemsets from one ruby to another.
upgrade     :: Lets you upgrade from one version of a ruby to another, including
               migrating your gemsets semi-automatically.

wrapper     :: generates a set of wrapper executables for a given ruby with the
               specified ruby and gemset combination. Used under the hood for
               passenger support and the like.

cleanup     :: Lets you remove stale source folders / archives and other
               miscellaneous data associated with rvm.
repair      :: Lets you repair parts of your environment e.g. wrappers, env
               files and and similar files (e.g. general maintenance).
fix-permissions :: Repairs broken permissions (e.g. by sudo or chef)
osx-ssl-certs :: Helps update certificates for OpenSSL installed by rvm on OSX.
snapshot    :: Lets you backup / restore an rvm installation in a lightweight
               manner.

alias       :: Lets you set shortcut strings for convenience with 'rvm use'.
disk-usage  :: Tells you how much disk space rvm install is using.
tools       :: Provides general information about the ruby environment,
               primarily useful when scripting rvm.
docs        :: Tools to make installing ri and rdoc documentation easier.
rvmrc       :: Tools related to managing rvmrc trust and loading.
patchset    :: Tools related to managing ruby patchsets.

do          :: runs an arbitrary command against specified and/or all rubies
cron        :: Manages setup for using ruby in cron tasks.

gemset      :: gemsets: https://rvm.io/gemsets/

rubygems    :: Switches the installed version of rubygems for the current ruby.

config-get  :: display values for RbConfig::CONFIG variables.
gemdir      :: display the path to the current gem directory (GEM_HOME).


fetch       :: Performs an archive / src fetch only of the selected ruby.
list        :: show currently installed rubies, interactive output.

               https://rvm.io/rubies/list/
autolibs    :: Controls settings for automatically installing dependencies.
pkg         :: Install a dependency package {readline,iconv,zlib,openssl}

               https://rvm.io/packages/
notes       :: Display notes, with operating system specifics.

export      :: Temporarily set an environment variable in the current shell.
unexport    :: Undo changes made to the environment by 'rvm export'.
requirements  :: Installs additional OS specific dependencies/requirements for
                 building various rubies. Usually run by install.
mount       :: Install rubies from external locations.

user        :: Tools for managing RVM mixed mode in multiuser installations.
group       :: Tools for managing groups in multiuser installations.

== Implementation

*ruby*     :: MRI/YARV Ruby (The Gold Standard) {1.8.x, 1.9.x, 2.0.x, 2.1.x, 2.2.x}
jruby      :: JRuby, Ruby interpreter on the Java Virtual Machine.
rbx        :: Rubinius
ree        :: Ruby Enterprise Edition, MRI Ruby with several custom
              patches for performance, stability, and memory.
macruby    :: MacRuby, insanely fast, can make real apps (Mac OS X Only).
maglev     :: GemStone Ruby, awesome persistent ruby object store.
ironruby   :: IronRuby, NOT supported yet. Looking for volunteers to help.
system     :: use the system ruby (eg. pre-rvm state)
default    :: use the default ruby (or the system ruby if a default hasn't been set).

              https://rvm.io/rubies/default/

== Resources:

https://rvm.io/
https://www.pivotaltracker.com/projects/26822

== Contributions:

Any and all contributions offered in any form, past present or future, to the
RVM project are understood to be in complete agreement and acceptance with the
Apache License v2.0.

== LICENSE:

Copyright (c) 2009-2011 Wayne E. Seguin
Copyright (c) 2011-2015 Michal Papis

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

  Action documentation available with 'rvm help action-name':

      alias autolibs cleanup config-get cron current debug disk-usage do docs fetch fix-permissions gemdir gemset gemset/copy get group implode info install list migrate mount notes osx-ssl-certs patchset pkg prepare reinstall remove repair requirements reset rubygems rvmrc rvmrc/to rvmrc/warning snapshot srcdir tools uninstall upgrade use user wrapper 

  Other topics of documentation available with 'rvm help topic':

      alt color upgrade-notes 
  

  For additional information please visit RVM's documentation website:

      https://rvm.io/

  If you still cannot find an answer to your question, find
  'wayneeseguin', 'mpapis', 'richo', 'lemoinem' or 'rys' in #rvm on irc.freenode.net:

      http://webchat.freenode.net/?channels=rvm
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octopress configuration]]></title>
    <link href="http://blog.w3cub.com/blog/2015/06/20/octopress-config/"/>
    <updated>2015-06-20T15:16:31+00:00</updated>
    <id>http://blog.w3cub.com/blog/2015/06/20/octopress-config</id>
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>å‡å¦‚æƒ³çœé’±ï¼Œåªæ˜¯å†™å†™åšå®¢è€Œå·²ã€‚å…å»æœåŠ¡å™¨éº»çƒ¦ã€‚æ¨èä½ ç”¨octopressï¼Œå¯ä»¥è‚¯å®šçš„ï¼Œæ²¡æœ‰wordpress é‚£ä¹ˆå¤šåŠŸèƒ½ã€‚octopress æ˜¯åŸºäº jekyll çš„ é™æ€åŒ–åšå®¢ï¼Œå¯ä»¥åœ¨github pages å’Œ gitcafe ç­‰ä¸Šè¿è¡Œã€‚ä¸‹é¢æˆ‘ä»¬æ¥éƒ¨ç½²ä¸€ä¸‹ æˆ‘ä»¬çš„<code>A blogging framework for hackers.</code> åšå®¢ã€‚</p>

<!--more-->

<hr />
<p>å…ˆçœ‹ä¸€ä¸‹æŠ€æœ¯æ ˆï¼š</p>

<p>octopress -&gt; jekyll -&gt; ruby</p>

<p>Markdown (or Textile), Liquid, HTML &amp; CSS go in. Static sites come out ready for deployment.</p>

<p>Liquid ä¸€ä¸ª rubyæ¨¡æ¿å¼•æ“ï¼ŒMarkdownæ˜¯â€¦â€¦ã€‚</p>

<p>æ‰€ä»¥ å®‰è£…octopressä¹‹å‰å¿…ä¸å¯å°‘çš„æ˜¯å®‰è£…Taçš„ç”Ÿæ€ç¯å¢ƒã€‚</p>

<h2 id="å®‰è£…octopress">å®‰è£…Octopress</h2>

<h3 id="å®‰è£…rvm">å®‰è£…rvm</h3>

<p>æ‰“å¼€<a href="https://rvm.io/">rvm</a>é¦–é¡µï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…å§ã€‚</p>

<pre><code>$ gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3

$ \curl -sSL https://get.rvm.io | bash -s stable

</code></pre>

<p><a href="https://en.wikipedia.org/wiki/Ruby_Version_Manager">rvm wiki</a></p>

<h3 id="å®‰è£…ruby">å®‰è£…Ruby</h3>

<pre><code>$ rvm -h
$ rvm list
$ rvm install 2.2.1
$ rvm use 2.2.1
</code></pre>
<p>æŸäº›æ—¶å€™ä¼šæç¤ºï¼Œè¯·ä½¿ç”¨ â€“bash-login. ä½¿ç”¨å°±OKäº†ã€‚</p>

<p>å®‰è£…å®Œæˆåå¯ä»¥ç”¨ruby â€“versionè¿›è¡ŒéªŒè¯</p>

<h3 id="å®‰è£…octopress-1">å®‰è£…Octopress</h3>
<p>å®‰è£…Rubyå®Œæˆåå°±æŒ‰ç…§å®˜æ–¹æŒ‡å—å®‰è£…Octpress</p>

<pre><code>#clone octopress
$ git clone git://github.com/imathis/octopress.git octopress
$ cd octopress

##å®‰è£…ä¾èµ–
$ gem install bundler
$ bundle install



##å®‰è£…octopressé»˜è®¤ä¸»é¢˜
$ rake install
</code></pre>
<hr />

<p>bundle å‘½ä»¤ æ˜¯ Gemfile æ–‡ä»¶ç”¨çš„ï¼Œå’Œ nodejs é¡¹ç›®çš„ package.json ç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸€é”®å®‰è£…ä¾èµ–åŒ…æ–‡ä»¶ã€‚</p>

<h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>
<p>æ¥ä¸‹æ¥éœ€è¦æŠŠBlogéƒ¨ç½²åˆ°githubä¸Šå»ï¼Œç¬¬ä¸€æ­¥è¦åšçš„æ˜¯å»<a href="https://github.com/new">github</a>åˆ›å»ºä¸€ä¸ª<code>username.github.io</code>çš„repoï¼Œæ¯”å¦‚æˆ‘çš„å°±å«<code>icai.github.io</code>ã€‚</p>

<p>ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶ä¾ç…§æç¤ºå®Œæˆgithubå’ŒOctopressçš„å…³è”</p>

<pre><code>$ rake setup_github_pages
</code></pre>
<hr />

<h2 id="åˆ›å»ºåšå®¢">åˆ›å»ºåšå®¢</h2>

<h3 id="ç”Ÿæˆåšå®¢">ç”Ÿæˆåšå®¢</h3>
<pre><code>$ rake generate
$ rake deploy
</code></pre>

<p>rake å‘½ä»¤ æ˜¯ Rakefile æ–‡ä»¶ç”¨çš„ï¼Œä½ åœ¨å¸¦æœ‰Rakefile ç›®å½•ä¸‹æ‰§è¡Œ rake å‘½ä»¤ï¼Œ<br />
å½“ç„¶ä½ å¯ä»¥ <code>rake -T</code> æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„rake Taskï¼Œ æˆ–è€… rake -h è·å–å¸®åŠ©</p>

<p>æŠŠç”Ÿæˆåçš„ä»£ç ä¸Šä¼ åˆ°github</p>

<pre><code>$ git add .
$ git commit -m 'create blog'
$ git push origin source
</code></pre>
<p>å®Œæˆåç­‰å¾…ä¸€æ®µæ—¶é—´åå°±èƒ½è®¿é—®<code>http://username.github.io</code>çœ‹åˆ°è‡ªå·±çš„åšå®¢äº†</p>

<h3 id="ä¿®æ”¹é…ç½®">ä¿®æ”¹é…ç½®</h3>
<p>é…ç½®æ–‡ä»¶è·¯å¾„ä¸º<code>~/octopress/_config.yml</code></p>

<p>å‚è€ƒï¼š <a href="https://github.com/octopress/octopress">å®˜æ–¹</a></p>

<p>ç¼–è¾‘å®Œæˆå</p>

<pre><code>$ rake generate

$ git add .
$ git commit -m "settings" 
$ git push origin source

$ rake deploy
</code></pre>

<h3 id="å®‰è£…ç¬¬ä¸‰æ–¹ä¸»é¢˜">å®‰è£…ç¬¬ä¸‰æ–¹ä¸»é¢˜</h3>
<p>Octopressæœ‰è®¸å¤šç¬¬ä¸‰æ–¹ä¸»é¢˜å¯ä»¥é€‰æ‹©ï¼Œé¦–å…ˆåœ¨<a href="http://opthemes.com/">è¿™é‡Œ</a>ä¸Šå¯»æ‰¾å–œæ¬¢çš„ä¸»é¢˜ï¼Œç‚¹å‡»è¿›å…¥å¯¹åº”ä¸»é¢˜çš„gitï¼Œä¸€èˆ¬åœ¨readmeä¸Šéƒ½ä¼šæœ‰å®‰è£…æµç¨‹</p>

<pre><code>#è¿™é‡Œä»¥å®‰è£…allenhsuå®šåˆ¶çš„greyshadeä¸»é¢˜ä¸ºä¾‹ï¼ŒåŸä½œè€…æ˜¯shashankmehta
$ git clone git@github.com:allenhsu/greyshade.git .themes/greyshade

#Substitue 'color' with your highlight color
$ echo "\$greyshade: color;" &gt;&gt; sass/custom/_colors.scss 

$ rake "install[greyshade]"
$ rake generate

$ git add .
$ git commit -m "theme" 
$ git push origin source

$ rake deploy
</code></pre>

<h3 id="æ”¯æŒä¸­æ–‡æ ‡ç­¾">æ”¯æŒä¸­æ–‡æ ‡ç­¾</h3>
<p>ç›®å‰ç‰ˆæœ¬çš„Octopressä¼šåœ¨<code>/source/blog/categories</code>ä¸‹åˆ›å»ºä¸€ä¸ª<code>index.markdown</code>æ¥ä½œä¸ºåˆ†ç±»çš„é¦–é¡µï¼Œä½†è¿™ä¸ªé¦–é¡µåœ¨æ ‡ç­¾æœ‰ä¸­æ–‡æ—¶ä¼šå‡ºç°æ— æ³•è·³è½¬çš„æƒ…å†µï¼ŒåŸå› æ˜¯å› ä¸ºåœ¨å‡ºç°ä¸­æ–‡æ ‡ç­¾æ—¶Octopressä¼šæŠŠæ–‡ä»¶çš„è·¯å¾„ä¸­çš„ä¸­æ–‡è½¬æ¢æˆæ‹¼éŸ³ï¼Œè€Œåœ¨Categoryè·³è½¬æ—¶æ˜¯ç›´æ¥å†™äº†ä¸­æ–‡è·¯å¾„ï¼Œç»“æœè‡ªç„¶æ˜¯404ã€‚è§£å†³æ–¹æ³•æ˜¯è‡ªå·±å®ç°ä¸€ä¸ªåˆ†ç±»é¦–é¡µå¹¶å¤„ç†ä¸­æ–‡ã€‚</p>

<p>é¦–å…ˆæŒ‰ç…§<a href="https://kaworu.ch/blog/2013/09/23/categories-page-with-octopress/">è¿™é‡Œ</a>çš„æ–¹æ³•å®ç°<code>index.html</code></p>

<p>å°†<code>plugins/category_list_tag.rb</code>ä¸­çš„</p>

<pre><code>category_url = File.join(category_dir, category.gsub(/_|\P{Word}/, '-').gsub(/-{2,}/, '-').downcase)
</code></pre>

<p>æ›¿æ¢æˆ</p>

<pre><code>category_url = File.join(category_dir, category.to_url.downcase)
</code></pre>
<p>è¿™æ ·ä½ çš„åšå®¢å°±å¯ä»¥æ”¯æŒä¸­æ–‡æ ‡ç­¾çš„è·³è½¬äº†ã€‚</p>

<hr />

<h2 id="å†™åšå®¢">å†™åšå®¢</h2>

<p>ç»è¿‡ä¸Šé¢å‡ éƒ¨åï¼Œåšå®¢å·²ç»æˆåŠŸæ­å»ºï¼Œç°åœ¨å°±å¯ä»¥å¼€å§‹å†™åšæ–‡äº†ã€‚</p>

<h3 id="åˆ›å»ºåšæ–‡">åˆ›å»ºåšæ–‡</h3>
<pre><code>#å¦‚æœç”¨çš„æ˜¯ç»ˆç«¯
$ rake new_post['title']

#å¦‚æœç”¨çš„æ˜¯ZSH
$ rake "new_post[title]"
#æˆ–è€…
$ rake new_post\['title'\]
</code></pre>
<p>ç”Ÿæˆçš„æ–‡ä»¶åœ¨<code>~/source/_posts</code>ç›®å½•ä¸‹</p>

<h3 id="ç¼–è¾‘åšæ–‡">ç¼–è¾‘åšæ–‡</h3>

<pre><code>#...markdownå†™åšæ–‡

$ rake preview #localhost:4000

$ rake generate

$ git add .
$ git commit -m "comment" 
$ git push origin source

$ rake deploy
</code></pre>

<hr />
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>

<ul>
  <li>http://octopress.org/</li>
  <li>https://msching.github.io/blog/2014/04/11/starting/</li>
  <li>https://github.com/msching/msching.github.io</li>
  <li>https://github.com/xiaocong/xiaocong.github.io</li>
  <li>https://help.github.com/articles/using-jekyll-plugins-with-github-pages/</li>
  <li>https://github.com/shashankmehta/greyshade</li>
  <li>https://github.com/imathis/octopress</li>
  <li>http://blog.devtang.com/blog/2012/02/10/setup-blog-based-on-github/</li>
  <li>https://msching.github.io/blog/2014/04/11/starting/</li>
  <li>http://robdodson.me/some-octopress-rake-tips/</li>
  <li>http://jekyllcn.com/docs/templates/</li>
  <li>http://rails-practice.com/content/</li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rake task for octopress]]></title>
    <link href="http://blog.w3cub.com/blog/2015/06/19/rake-task-for-octopress/"/>
    <updated>2015-06-19T15:35:19+00:00</updated>
    <id>http://blog.w3cub.com/blog/2015/06/19/rake-task-for-octopress</id>
    <content type="html"><![CDATA[<p>ç¿»è¯‘æ ·å¼æµ‹è¯•ä¸­ï¼Œæƒ…å½¢çœ‹ä¸åˆ°ä¸¾è¡Œç¨‹åºçœ‹è¿‡å‡ºå”®å§‹ç»ˆå‡ºå¤„äºˆä»¥è‹±ï¼Œä¸Šä¸‹æ‰‹æœºåŒæ ·å§”å‘˜ä¼šåˆ†äº«æ³•ï¼Œé¥­åº—æ–‡ç« æ˜¯ä¸€ç§æ°‘é—´äº‹å®æ¬¢è¿æ‚¨æ£€ã€‚</p>

<p>ä»–çš„ç½‘æ¸¸ç‰©ç†å°±æœ‰æ”¹é©ç¬¬äºŒæç¤ºå°±æœ‰ä¿¡ï¼Œä¸€è„¸ä¸¾æŠ¥ç²¾ç¾å…´è¶£å…·æœ‰æˆ‘å¾ˆè‡ªå·±çš„äº§ï¼Œæ ¼å¼ç¾ä¸½å®åŠ›å­¦ä¹ è¥å…»æ—¥å­è€äººé€‰é¡¹ï¼Œæœ¬æŠ¥è¿‘å¹´æ¥æ•…éšœä½“ç³»æˆé•¿å®½å¸¦æ¸æ¸æ¨å¹¿ä¸‹é¢å±…ç„¶æ—¶å°šä¸­æ–‡ç”»é¢ï¼Œè¯¦ç»†å†…å®¹æ­¦å™¨å¤§å¤šæ•°ç†è§£å¹¿å¤§æˆæƒæ–¹å¼é…’åº—å†™ï¼Œæ²¡æœ‰è¿›å£æ–‡æ˜åæœç”³è¯·æµ™æ±Ÿäº›ä»€ä¹ˆæ’ï¼Œæœ€ä½å¤§å®¶ä»Šåè‡ªä»å„è‡ªè‡ªå·±ä¿±ä¹éƒ¨ï¼Œæ”¶è—æœ¬é¡µä¹é˜Ÿæ³¨é‡è‡ªèº«å‘ã€‚<br />
çºªå¿µä¾›åº”å•†ä¸‹åˆ—åˆåŒé£Ÿç‰©ä¼Ÿå¤§å›ç­”ä¸å¿…æœºåœºæ–¹æ¡ˆæœ¬ä¹¦æŒ‡å®šç‰©å“ï¼Œæƒ³åˆ°å•†å®¶é—¨æ´¾å²—ä½å¢åŠ ç¡®ä¿æŠ•èµ„è€…æ•°ç å¯è§ï¼Œä¸»è¥è®¾ç«‹é€ å‹å…ƒç´ ç®€ä½“ä¸­æ–‡åŸåˆ™å¯¹äºæ—¥å‰æ¶‰åŠç¨¿ä»¶æ˜¯å› ä¸ºå¯ä»¥è¯´ã€‚</p>

<!--more-->
<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Alias ut quo laboriosam dignissimos neque cupiditate nulla, minus accusantium voluptatum quae! Iste, quo asperiores ex tenetur nemo optio quisquam aliquam nisi.</p>

<p>æ— èŠä¸–ç•Œæ¯æœ¬è®ºå›ç¡®å®ä¸‹è½½æ¬¡æ•°è®ºæ–‡æ¿€åŠ¨æ¥¼ä¸Šï¼Œåè°ƒæˆäº†åŠ æ‹¿å¤§å¤§é™†ä¼‘é—²ï¼Œä¸€å£°é¢„æœŸæ¡æ¬¾è¯´ç€æ˜¯ä»€ä¹ˆæ„Ÿè§‰åˆ°ä¸‹ï¼Œå„ä¸ªæ•°å­—æ•ˆç‡å…±å’Œå›½å°šæœªæœ€å¤§å¥–åŠ±ä¸€å¼ æ·±å…¥ç¦å»ºæ¬¢è¿æ‚¨æ—¥éŸ©ç®¡ç†ç³»ï¼Œç‰¹ä»·ç‚¹æ­¤ä¾›æ±‚ä¸€è‚¡ä¿é™©å°è¯•å³ä½¿æˆ‘å¸‚é”€å”®æ•…éšœé€æ­¥ï¼Œæ–°æ‰‹å¹³é™ä½œå‡ºæµè¡Œç®€ç›´é«˜é€Ÿåå¤§å…¶å®æ”¿ç­–æ–°æŠ€æœ¯åˆ†åˆ«é‰´å®šå¿ƒçµç”·å­è¯ï¼Œä¸€å®¶ä¸€ä¸å¤§å¸ˆæ€»ç»ç†ä¼šï¼Œé¢†å…ˆéš¾é“æ€è·¯æ‰‹é‡Œç¬é—´æ–°å‹å¥½äº†å¤„äºå¤©å ‚æœºæ„çŠ¶æ€å¤§é—¨æ­å·å¼ºå¤§éš¾ï¼Œåˆ°æ¥ç»å†åŒ»å­¦æŸç§æš‚æ—¶ã€‚</p>

<p>$ rake -T</p>

<pre><code>	rake clean # æ¸…ç†ç¼“å­˜: .pygments-cache, .gist-cache, .sass-cache
	rake copydot[source,dest] # copy dot files for deployment
	rake deploy # Default deploy task
	rake gen_deploy # ç”Ÿæˆå¹¶éƒ¨ç½²ç½‘ç«™
	rake generate # ç”Ÿæˆ jekyll ç½‘ç«™
	rake install[theme] # åˆå§‹åŒ–octopressï¼Œå¤åˆ¶é»˜è®¤ä¸»é¢˜åˆ°Jekyll's generatorè·¯å¾„ä¸‹
	rake integrate # æŠŠæ‰€æœ‰éšè—çš„postsç§»å›åˆ°postsç›®å½•ï¼Œä»¥å‡†å¤‡ç”Ÿæˆç½‘ç«™
	rake isolate[filename] # Move all other posts than the one currently being worked on to a temporary stash location (stash) so regenerating the site happens much more quickly
	rake list # list tasks
	rake new_page[filename] # Create a new page in source/(filename)/index.markdown
	rake new_post[title] # Begin a new post in source/_posts
	rake preview # preview the site in a web browser
	rake push # â€» deploy public directory to github pages
	rake rsync # Deploy website via rsync
	rake set_root_dir[dir] # Update configurations to support publishing to root or sub directory
	rake setup_github_pages[repo] # Set up _deploy folder and deploy branch for Github Pages deployment
	rake update_source[theme] # Move source to source.old, install source theme updates, replace source/_includes/navigation.html with source.old's navigation
	rake update_style[theme] # Move sass to sass.old, install sass theme updates, replace sass/custom with sass.old/custom
	rake watch # Watch the site and regenerate when it changes
</code></pre>
<!--more-->

<p>test include_code plugin:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Example 2 (github.js)</span> <a href="http://blog.w3cub.com/downloads/code/github.js">download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span></span><span class="kd">var</span> <span class="nx">github</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class="line">  <span class="kd">function</span> <span class="nx">escapeHtml</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div/&gt;&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">html</span><span class="p">();</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">  <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">repos</span><span class="p">){</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">target</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">repos</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="nx">fragment</span> <span class="o">+=</span> <span class="s1">&#39;&lt;li class=&quot;pinned-repo-item&quot;&gt;&lt;div&gt;&lt;a href=&quot;&#39;</span><span class="o">+</span><span class="nx">repos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">html_url</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">repos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;&lt;/a&gt;&lt;/div&gt;&lt;p&gt;&#39;</span><span class="o">+</span><span class="nx">escapeHtml</span><span class="p">(</span><span class="nx">repos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">description</span><span class="o">||</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&lt;/p&gt;&lt;/li&gt;&#39;</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="nx">t</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">fragment</span><span class="p">;</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">  <span class="k">return</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">showRepos</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
</span><span class="line">      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class="line">          <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;https://api.github.com/users/&quot;</span><span class="o">+</span><span class="nx">options</span><span class="p">.</span><span class="nx">user</span><span class="o">+</span><span class="s2">&quot;/repos?sort=&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">sort</span> <span class="o">||</span> <span class="s1">&#39;pushed&#39;</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;&amp;callback=?&quot;</span>
</span><span class="line">        <span class="p">,</span> <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span>
</span><span class="line">        <span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">+</span> <span class="s1">&#39; li.loading&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Error loading feed&quot;</span><span class="p">);</span> <span class="p">}</span>
</span><span class="line">        <span class="p">,</span> <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">          <span class="kd">var</span> <span class="nx">repos</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class="line">          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
</span><span class="line">          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">skip_forks</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">fork</span><span class="p">)</span> <span class="p">{</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
</span><span class="line">            <span class="nx">repos</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">          <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span> <span class="nx">repos</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span> <span class="p">}</span>
</span><span class="line">          <span class="nx">render</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">repos</span><span class="p">);</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">});</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line"><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[svgç”»å¸ƒå®šä½]]></title>
    <link href="http://blog.w3cub.com/blog/2014/07/13/svg-canvas-positioning/"/>
    <updated>2014-07-13T19:55:00+00:00</updated>
    <id>http://blog.w3cub.com/blog/2014/07/13/svg-canvas-positioning</id>
    <content type="html"><![CDATA[<p>// è§’åº¦(angle)è½¬å¼§åº¦(radian)</p>

<pre><code class="language-js">
var radian = angle * Math.PI / 180;
var angle = radian* 180/ Math.PI;
alert(radian/ angle == Math.PI / 180);
</code></pre>
<!-- more -->
<hr />

<p>// Math.atan2()æ˜¯å¼§åº¦åˆ¶</p>

<pre><code class="language-js">var radian = Math.atan2((p1.y-p0.y),(p1.x-p0.x));
</code></pre>

<p>//â€”â€”â€”â€”</p>

<p>//å·²çŸ¥è§’åº¦degree(0,360)ï¼ŒåŠå¾„(raduis)ï¼Œæ±‚åœ†ä¸Šçš„ç‚¹(p1)</p>

<pre><code class="language-js">var radian = angle * Math.PI / 180;
    p1.x = raduis * Math.cos(radian) + p0.x;  
    p1.y = raduis * Math.sin(radian) + p0.y;

function getPointAt(p0, radius, angle) {

    var radian = angle * Math.PI / 180,

        p1 = {};

    p1.x = raduis * Math.cos(radian) + p0.x;  

    p1.y = raduis * Math.sin(radian) + p0.y; 
    return p1; 

}
</code></pre>

<p>//â€”â€”â€”-</p>

<p>//ä¸¤ç‚¹A,B,æ±‚è§’åº¦degree(0,360),Aä¸ºOrigin(p0).</p>

<p>var radian = Math.atan2((p1.y-p0.y),(p1.x-p0.x));</p>

<p>var angle = radian * 180 / Math.PI;</p>

<p>//â€”â€”â€”</p>

<p>//å·²çŸ¥ä¸¤ç‚¹A(p0),B(p1),æ±‚ABè¿çº¿ä¸Šè·ç¦»å…¶ä¸­ä¸€ç‚¹çš„D0 or D1çš„åæ ‡</p>

<p>// â€¦.</p>

<p>éƒ½æ˜¯é«˜ä¸­æ•°å­¦</p>

<hr />

<p>å‚è€ƒï¼š</p>

<p>https://zh.wikipedia.org/wiki/%E6%9E%81%E5%9D%90%E6%A0%87%E7%B3%BB</p>

<p>https://zh.wikipedia.org/wiki/%E7%AC%9B%E5%8D%A1%E5%84%BF%E5%9D%90%E6%A0%87%E7%B3%BB</p>

<p>åº”ç”¨åœºæ™¯ï¼š</p>

<p><a href="https://www.thecn.com/tc129">https://www.thecn.com/tc129</a> ç¤¾äº¤å…³ç³»å›¾</p>

]]></content>
  </entry>
  
</feed>
